/*!
 * TAME [TwinCAT ADS Made Easy] V3.5 alpha
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(g){function l(ap){try{window.console.log(ap)}catch(aq){alert(ap)}}var aa=this,m={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,SumRd:61568,SumWr:61569,SumRdWr:61570},C={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},U=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],h=(typeof g.language==="string")?g.language:"ge",n=(function(){var e={},aq="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ap;for(ap=0;ap<aq.length;ap++){e[ap]=aq.charAt(ap)}return e}()),q=(function(){var e={},aq="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ap;for(ap=0;ap<aq.length;ap++){e[aq.charAt(ap)]=ap}return e}()),a=0,F=[0],Q={},j=false,ao={},f=false,A={},b=0,w=0;if(typeof g.serviceUrl!=="string"){l("TAME library error: Service URL is not a string!");return}if(typeof g.amsNetId!=="string"&&typeof g.configFileUrl!=="string"){l("TAME library error: NetId is not defined and there is no URL for fetching the TPY file!");return}if(g.amsPort===undefined&&typeof g.configFileUrl!=="string"){g.amsPort="801";l("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof g.amsPort==="number"){l("TAME library warning: AMS port number is not a string! Trying to convert it.");g.amsPort=g.amsPort.toString(10)}}if(parseInt(g.amsPort,10)<801||parseInt(g.amsPort,10)>891){l("TAME library error: AMS Port Number ("+parseInt(g.amsPort,10)+") is out of range (801-891)!");return}if(g.dataAlign4===true){a=4}else{if(g.alignment===undefined&&typeof g.configFileUrl!=="string"){a=1}else{if(typeof g.alignment==="string"){a=parseInt(g.alignment,10)}else{if(typeof g.alignment==="number"){a=g.alignment}}}}if(g.syncXmlHttp===true){l('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests are used by default.')}if(typeof g.serviceUser==="string"&&typeof g.servicePassword==="string"){l("TAME library info: Username and password set. Authenticated requests will be used.")}else{g.serviceUser=null;g.servicePassword=null}this.dateNames={weekdShort:TAME.weekdShortNames[h],weekdLong:TAME.weekdLongNames[h],monthsShort:TAME.monthsShortNames[h],monthsLong:TAME.monthsLongNames[h]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;function B(e,ar,aq,au,ax){var at=[],aw=0,av=[],ap=0;if(typeof e==="number"){at[0]=e.toString(10)}else{if(typeof e==="string"){at=e.split(".")}else{l("TAME library error: Can't parse name of object/variable. Name is not a string or number!");l(e);return}}if(aq===undefined){aq=window}aw=at.length-1;while(ap<aw){if(at[ap].charAt(at[ap].length-1)==="]"){av=at[ap].substring(0,at[ap].length-1).split("[");aq=aq[av[0]][av[1]]}else{if(aq[at[ap]]===undefined){aq[at[ap]]=[]}aq=aq[at[ap]]}ap++}if(at[ap].charAt(at[ap].length-1)==="]"){av=at[ap].substring(0,at[ap].length-1).split("[");aq=aq[av[0]];if(ar!==undefined){if(typeof au==="string"){ar=au+ar}if(typeof ax==="string"){ar=ar+ax}aq[av[1]]=ar}return aq[av[1]]}if(ar!==undefined){if(typeof au==="string"){ar=au+ar}if(typeof ax==="string"){ar=ar+ax}aq[at[ap]]=ar}return aq[at[ap]]}function am(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=aa.maxStringLen){return true}l("TAME library error: User defined string length not valid! length: "+e);l("Max. string length: "+aa.maxStringLen);return false}function z(aq){var ap;if(aq.addr){if(typeof aq.addr==="string"&&aq.addr.charAt(0)==="%"){if(aq.addr.charAt(2)==="X"){ap=m[aq.addr.substr(1,2)]}else{ap=m[aq.addr.substr(1,1)]}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(aq);return}}else{if(aq.symbolName){if(typeof aq.symbolName==="string"){try{ap=Q[aq.symbolName].indexGroup}catch(ar){l("TAME library error: Can't get the IndexGroup for this request!");l("TAME library error: Please check the variable name.");l(ar);l(aq);return}}else{l("TAME library error: Varible name should be a string!");l(aq);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(aq);return}}if(isNaN(ap)){l("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");l(aq)}return ap}function k(aw){var at,aq="",av=[],ar,ay,ap,ax,aA,az;if(aw.addr){if(typeof aw.addr==="string"&&aw.addr.charAt(0)==="%"){if(aw.addr.charAt(2)==="X"){aq=aw.addr.substr(3);av=aq.split(".");at=parseInt(av[0],10)*8+parseInt(av[1],10)}else{at=parseInt(aw.addr.substr(3),10);if(typeof aw.addrOffset==="number"){at+=aw.addrOffset}}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(aw);return}}else{if(aw.symbolName){if(typeof aw.symbolName==="string"){try{at=Q[aw.symbolName].indexOffset;if(typeof aw.symbolNameArrIdx==="number"){at+=Q[aw.symbolName].itemSize*(aw.symbolNameArrIdx-Q[aw.symbolName].arrStartIdx)}if(typeof aw.addrOffset==="number"){at+=aw.addrOffset}if(typeof aw.offs==="string"){at+=parseInt(aw.offs,10)/8}else{if(typeof aw.offs==="number"){at+=aw.offs/8}}if(aw.dataTypeNames.length>0){ap=aw.dataTypeNames;ay=Q[aw.symbolName].dataType;for(ar=0;ar<ap.length;ar++){az=ao[ay].subItems[ap[ar]];at+=az.bitOffset/8;if(typeof aw.dataTypeArrIdx[ar]==="number"){at+=az.itemSize*(aw.dataTypeArrIdx[ar]-az.arrStartIdx)}ay=ao[ay].subItems[ap[ar]].dataType}}}catch(au){l("TAME library error: Can't get the IndexOffset for this request!");l("TAME library error: Please check the variable definition (name/offs/subitem).");l(au);l(aw);return}}else{l("TAME library error: Varible name should be a string!");l(aw);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(aw);return}}if(isNaN(at)){l("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");l(aw)}return at}function ak(ay){var ap={},ax,ar;if(typeof ay.name==="string"){ay.name=ay.name.toUpperCase();ax=ay.name.split(".")}if(ax[0]===""){ap.symbolName="."+ax[1]}else{ap.symbolName=ax[0]+"."+ax[1]}if(ap.symbolName.charAt(ap.symbolName.length-1)==="]"){ar=ap.symbolName.substring(0,ap.symbolName.length-1).split("[");ap.symbolName=ar[0];ap.symbolNameArrIdx=parseInt(ar[1],10)}ap.dataTypeNames=ax.slice(2);var at=[],av,aw,aq;if(typeof ay.type==="string"){at=ay.type.split(".");ap.type=at[0];if(at.length>2){at[1]=at.slice(1).join(".");ap.format=at[1]}ap.size=C[ay.type]}if(j&&f&&ap.dataTypeNames.length>0){av=ap.dataTypeNames;aw=Q[ap.symbolName].dataType;ap.dataTypeArrIdx=[];aq=0;do{if(av[aq].charAt(av[aq].length-1)==="]"){ar=av[aq].substring(0,av[aq].length-1).split("[");av[aq]=ar[0];ap.dataTypeArrIdx[aq]=parseInt(ar[1],10)}if(ao[aw].subItems[av[aq]].pointer===true){l("TAME library error: PLC variable "+[av[aq]]+" is a pointer! Can't get the variable value.")}if(aq===av.length-1){break}aw=ao[aw].subItems[av[aq]].dataType;aq++}while(aq<av.length);try{if(ay.type===undefined){ap.type=ao[aw].subItems[av[aq]].type}if(ap.type==="STRING"){ap.stringLength=ao[aw].subItems[av[aq]].stringLength;ap.format=ap.stringLength}else{if(typeof ay.format==="string"){ap.format=ay.format}else{if(typeof ay.decPlaces==="number"){ap.format=ay.decPlaces}else{if(typeof ay.dp==="number"){ap.format=ay.dp}}}}ap.arrayLength=ao[aw].subItems[av[aq]].arrayLength;ap.arrayDataType=ao[aw].subItems[av[aq]].arrayDataType;ap.dataType=ao[aw].subItems[av[aq]].dataType;ap.itemSize=ao[aw].subItems[av[aq]].itemSize;ap.size=ao[aw].subItems[av[aq]].size;ap.bitOffset=ao[aw].subItems[av[aq]].bitOffset;ap.offs=ay.offs;if(ap.dataTypeArrIdx[aq]!==undefined&&ap.type==="ARRAY"){ap.type=ao[aw].subItems[av[aq]].arrayDataType;ap.size=ao[aw].subItems[av[aq]].size}}catch(au){l("TAME library error: A problem occured while reading a data type from the data type table!");l(au);l(ay)}}else{if(j&&typeof ay.name==="string"){try{if(ay.type===undefined){ap.type=Q[ay.name].type}if(ap.type==="STRING"){ap.stringLength=Q[ay.name].stringLength;ap.format=ap.stringLength}else{if(typeof ay.format==="string"){ap.format=ay.format}else{if(typeof ay.decPlaces==="number"){ap.format=ay.decPlaces}else{if(typeof ay.dp==="number"){ap.format=ay.dp}}}}ap.arrayLength=Q[ay.name].arrayLength;ap.arrayDataType=Q[ay.name].arrayDataType;ap.dataType=Q[ay.name].dataType;if(typeof ay.type==="string"){ap.size=C[ay.type]}else{ap.size=Q[ay.name].size}ap.bitOffset=Q[ay.name].bitOffset;ap.offs=ay.offs}catch(au){l("TAME library error: A problem occured while reading a data type from the symbol table!");l(au);l(ay)}}else{l("TAME library error: Could not get the type of the item!");l(ay)}}return ap}function Z(){var aq;if(window.XMLHttpRequest){aq=new window.XMLHttpRequest()}else{try{aq=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(ar){try{aq=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(ap){aq=null;l("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return aq}function v(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){l(e)}}e.send=function(){var ap,aq;if(typeof this.reqDescr.id==="number"&&F[this.reqDescr.id]>0){l("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");F[this.reqDescr.id]++;if(F[this.reqDescr.id]<=aa.maxDropReq){return}F[this.reqDescr.id]=0}if(e.sync===true){aq=false}else{if(this.reqDescr.sync===true){aq=false}else{if(this.reqDescr.sync===false){aq=true}else{if(g.syncXmlHttp===true){aq=false}else{aq=true}}}}this.xmlHttpReq=Z();ap="<?xml version='1.0' encoding='utf-8'?>";ap+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";ap+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";ap+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";ap+="<soap:Body><q1:";ap+=this.method;ap+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";ap+=g.amsNetId;ap+="</netId><nPort xsi:type='xsd:int'>";ap+=g.amsPort;ap+="</nPort>";if(this.indexGroup!==undefined){ap+="<indexGroup xsi:type='xsd:unsignedInt'>";ap+=this.indexGroup;ap+="</indexGroup>"}if(this.indexOffset!==undefined){ap+="<indexOffset xsi:type='xsd:unsignedInt'>";ap+=this.indexOffset;ap+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){ap+="<cbRdLen xsi:type='xsd:int'>";ap+=this.reqDescr.readLength;ap+="</cbRdLen>"}if(this.pData&&this.pData.length>0){ap+="<pData xsi:type='xsd:base64Binary'>";ap+=this.pData;ap+="</pData>"}if(this.pwrData&&this.pwrData.length>0){ap+="<pwrData xsi:type='xsd:base64Binary'>";ap+=this.pwrData;ap+="</pwrData>"}ap+="</q1:";ap+=this.method;ap+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",g.serviceUrl,aq,g.serviceUser,g.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(aq===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){aa.parseResponse(e)}};this.xmlHttpReq.send(ap)}else{this.xmlHttpReq.send(ap);aa.parseResponse(e)}if(typeof this.reqDescr.id==="number"){F[this.reqDescr.id]=1}}};return e}function V(ar,aq,ap,e){var at;if(typeof ar.val==="string"){if(aq==="REAL"||aq==="LREAL"){at=parseFloat(ar.val)}else{at=parseInt(ar.val,10)}}else{if(typeof ar.val==="number"){at=ar.val}else{l("TAME library error: Wrong variable type for a numeric variable in write request!");l("TAME library error: Variable type should be number or string, but is "+typeof ar.val);l(ar);at=0}}if(isNaN(at)){at=0;l("TAME library error: Value of a numeric variable in write request is not a number.");l(ar)}if(aa.useCheckBounds===true){if(aq==="LREAL"){if(!isFinite(at)){l("TAME library warning: Limit for LREAL value exceeded!");l("Upper limit: "+Number.MAX_VALUE);l("Lower limit: "+Number.MIN_VALUE);l("value: "+at);l(ar)}}else{if(aq==="REAL"){if(at>0){if(at<1.175495e-38){l("TAME library warning: Lower limit for positive REAL value exceeded!");l("limit: 1.175495e-38");l("value: "+at);l(ar);at=1.175495e-38}else{if(at>3.402823e+38){l("TAME library warning: Upper limit for positive REAL value exceeded!");l("limit: 3.402823e+38");l("value: "+at);l(ar);at=3.402823e+38}}}else{if(at<0){if(at>-1.175495e-38){l("TAME library warning: Upper limit for negative REAL value exceeded!");l("limit: -1.175495e-38");l("value: "+at);l(ar);at=-1.175495e-38}else{if(at<-3.402823e+38){l("TAME library warning: Lower limit for negative REAL value exceeded!");l("limit: -3.402823e+38");l("value: "+at);l(ar);at=-3.402823e+38}}}}}else{if(at<ap){l("TAME library warning: Lower limit for numeric value exceeded!");l("type: "+aq);l("limit: "+ap);l("value: "+at);l(ar);at=ap}else{if(at>e){l("TAME library warning: Upper limit for numeric value exceeded!");l("type: "+aq);l("limit: "+e);l("value: "+at);l(ar);at=e}}}}}return at}function ai(ar){var e=[],at,ap,aq;if(typeof ar.type==="string"){e=ar.type.split(".");if(e.length>2){e[1]=e.slice(1).join(".")}}else{l("TAME library error: Could not get the type of the item!");l(ar)}return e}function L(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ag(at,ap){var e=[],ar=at.toString(16),aq;while(ar.length<ap*2){ar="0"+ar}for(aq=0;aq<ap;aq++){e[(ap-1)-aq]=((L(ar.charCodeAt(aq*2))*16)+L(ar.charCodeAt((aq*2)+1)))}return e}function s(ap){var at=0,aw=0,au,e,ar,av,aq;e=Math.abs(ap);if(ap!==0){for(aq=128;aq>-127;aq--){ar=e/Math.pow(2,aq);if(ar>=2){break}av=aq;au=ar}av+=127;au=au.toString(2);for(aq=2;aq<25;aq++){at<<=1;if(au.charAt(aq)==="1"){at+=1}}if(au.charAt(25)==="1"){at+=1}aw=av;aw<<=23;aw+=at;if(ap<0){aw+=2147483648}}return aw}function E(av){var aq=0,ax=0,ar={part1:0,part2:0},ay,au,ap,e,aw,at;ay=Math.abs(av);if(av!==0){for(at=1024;at>=-1023;at--){au=ay/Math.pow(2,at);if(au>=2){break}ap=at;aw=au}ap+=1023;aw=aw.toString(2);for(at=2;at<22;at++){aq<<=1;if(aw.charAt(at)==="1"){aq+=1}}if(aw.charAt(at)==="1"){e=true}at++;for(at;at<54;at++){ax<<=1;if(aw.charAt(at)==="1"){ax+=1}}ar.part1=ap;ar.part1<<=20;ar.part1+=aq;if(av<0){ar.part1+=2147483648}ar.part2=ax;if(e===true){ar.part2+=2147483648}}return ar}function M(aq,ap){var e;switch(ap){case"#d":case"#dd":e=aq*86400000;break;case"#h":case"#hh":e=aq*3600000;break;case"#m":case"#mm":e=aq*60000;break;case"#s":case"#ss":e=aq*1000;break;case"#ms":case"#msmsms":e=aq;break;default:e=aq;break}return e}function D(aw,ay){var e=ay.split("#"),av=e.length,ax=/:|\.|-|_/,aq=0,ap=0,at,ar,au,az;for(ar=1;ar<av;ar++){if(ax.test(e[ar])===true){az=true}}if(az!==true){l("TAME library error: No separator ( : . - _ ) for TOD string found!");l("String: "+aw);l("Format: "+ay);return 0}au=aw.split(ax);for(ar=1;ar<av;ar++){switch(e[ar]){case"h":case"hh":at=parseInt(au[ap],10)*3600000;ap++;break;case"m":case"mm":at=parseInt(au[ap],10)*60000;ap++;break;case"s":case"ss":at=parseInt(au[ap],10)*1000;ap++;break;case"ms":case"msmsms":at=parseInt(au[ap],10);ap++;break;default:at=0}aq+=at}return aq}function p(av){var au=n,ar=0,ap="",at,aq,e;while(ar<av.length){at=av[ar++];aq=av[ar++];e=av[ar++];ap=ap+au[at>>2]+au[((at&3)<<4)|(aq>>4)]+(isNaN(aq)?"=":au[(((aq&15)<<2)|(e>>6))])+((isNaN(aq)||isNaN(e))?"=":au[e&63])}return ap}function d(av,at,au,ar){var ax=[],e,aw,ap,aq;if(av.val===undefined){switch(at){case"STRING":av.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":av.val=new Date();break;default:av.val=0;break}l("TAME library warning: Value of a variable in write request is not defined!");l(av)}switch(at){case"BOOL":if(av.val){ax[0]=1}else{ax[0]=0}break;case"BYTE":case"USINT":e=V(av,at,0,255);ax=ag(e,ar);break;case"SINT":e=V(av,at,-128,127);if(e<0){e=e+256}ax=ag(e,ar);break;case"WORD":case"UINT":e=V(av,at,0,65535);ax=ag(e,ar);break;case"INT":case"INT16":e=V(av,at,-32768,32767);if(e<0){e=e+65536}ax=ag(e,ar);break;case"INT1DP":av.val=Math.round(av.val*10);e=V(av,at,-32768,32767);if(e<0){e=e+65536}ax=ag(e,ar);break;case"DWORD":case"UDINT":e=V(av,at,0,4294967295);ax=ag(e,ar);break;case"DINT":e=V(av,at,-2147483648,2147483647);if(e<0){e=e+4294967296}ax=ag(e,ar);break;case"REAL":e=V(av,at);e=s(e);ax=ag(e,ar);break;case"LREAL":e=V(av,at);e=E(e);ax=ag(e.part2,4);ax=ax.concat(ag(e.part1,4));break;case"DATE":if(typeof av.val==="object"){av.val.setHours(0);av.val.setMinutes(0);av.val.setSeconds(0);e=av.val.getTime()/1000-av.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DATE variable in write request is not a date object!");l(av)}ax=ag(e,ar);break;case"DT":case"DATE_AND_TIME":if(typeof av.val==="object"){e=av.val.getTime()/1000-av.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DT variable in write request is not a date object!");l(av)}ax=ag(e,ar);break;case"TOD":case"TIME_OF_DAY":if(typeof av.val==="object"){av.val.setYear(1970);av.val.setMonth(0);av.val.setDate(1);e=av.val.getTime()-av.val.getTimezoneOffset()*60000}else{if(typeof av.val==="string"){if(au===""||au===undefined){au="#hh#:#mm";l("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");l(av)}e=D(av.val,au)}else{l("TAME library error: TOD value in write request is wether a date object nor a string!");l(av)}}ax=ag(e,ar);break;case"STRING":aw=(au===undefined)?C.STRING:parseInt(au,10);if(am(aw)){ap=aw<av.val.length?aw:av.val.length;for(aq=0;aq<ap;aq++){ax[aq]=av.val.charCodeAt(aq)}for(aq;aq<aw;aq++){ax[aq]=0}ax[aq]=0}break;case"TIME":e=parseInt(av.val,10);if(isNaN(e)){l("TAME library warning: Value of a TIME variable in write request is not defined!");l(av);e=0}e=M(e,au);if(e<0){e=0;l("TAME library warning: Lower limit for TIME variable in write request exceeded!)");l("value: "+av.val+au);l(av)}else{if(e>4294967295){e=4294967295;l("TAME library warning: Upper limit for TIME variable in write request exceeded!)");l("value: "+av.val+au);l(av)}}ax=ag(e,ar);break;case"EndStruct":break;default:l("TAME library error: Unknown data type in write request : "+at);break}return ax}function t(ap){var e=ap.toString(16);if((e.length%2)!==0){e="0"+e}return e}function i(ap,e){e=(isNaN(e))?0:e;var aq=ap.toString(10);while(aq.length<e){aq="0"+aq}return aq}function an(av,au){var e=au.split("#"),at=e.length,ap="",ar,aq;for(aq=1;aq<at;aq++){switch(e[aq]){case"D":ar=av.getDate();break;case"DD":ar=av.getDate();ar=i(ar,2);break;case"WD":ar=av.getDay();break;case"WKD":ar=aa.dateNames.weekdShort[av.getDay()];break;case"WEEKDAY":ar=aa.dateNames.weekdLong[av.getDay()];break;case"M":ar=av.getMonth()+1;break;case"MM":ar=av.getMonth()+1;ar=i(ar,2);break;case"MON":ar=aa.dateNames.monthsShort[av.getMonth()];break;case"MONTH":ar=aa.dateNames.monthsLong[av.getMonth()];break;case"YY":ar=av.getYear();while(ar>100){ar-=100}break;case"YYYY":ar=av.getFullYear();break;case"h":ar=av.getHours();break;case"hh":ar=av.getHours();ar=i(ar,2);break;case"m":ar=av.getMinutes();break;case"mm":ar=av.getMinutes();ar=i(ar,2);break;case"s":ar=av.getSeconds();break;case"ss":ar=av.getSeconds();ar=i(ar,2);break;case"ms":ar=av.getMilliseconds();break;case"msmsms":ar=av.getMilliseconds();ar=i(ar,3);break;default:ar=e[aq];break}ap=ap+ar}return ap}function K(av,au){var e=au.split("#"),at=e.length,ap="",ar,aq;for(aq=1;aq<at;aq++){switch(e[aq]){case"d":if(at<=2){ar=av/86400000}else{ar=Math.floor(av/86400000);av=av%86400000}break;case"dd":if(at<=2){ar=av/86400000}else{ar=Math.floor(av/86400000);av=av%86400000}ar=i(ar,2);break;case"h":if(at<=2){ar=av/3600000}else{ar=Math.floor(av/3600000);av=av%3600000}break;case"hh":if(at<=2){ar=av/3600000}else{ar=Math.floor(av/3600000);av=av%3600000}ar=i(ar,2);break;case"m":if(at<=2){ar=av/60000}else{ar=Math.floor(av/60000);av=av%60000}break;case"mm":if(at<=2){ar=av/60000}else{ar=Math.floor(av/60000);av=av%60000}ar=i(ar,2);break;case"s":if(at<=2){ar=av/1000}else{ar=Math.floor(av/1000);av=av%1000}break;case"ss":if(at<=2){ar=av/1000}else{ar=Math.floor(av/1000);av=av%1000}ar=i(ar,2);break;case"ms":ar=av;break;case"msmsms":ar=av;ar=i(ar,3);break;default:ar=e[aq];break}ap=ap+ar}return ap}function T(ap){var e=t(ap.charCodeAt(0));return parseInt(e,16)}function ah(e){var ap=T(e);if(ap>127){ap=ap-256}return ap}function P(ap){var e=t(ap.charCodeAt(1));e+=t(ap.charCodeAt(0));return parseInt(e,16)}function O(e){var ap=P(e);if(ap>32767){ap=ap-65536}return ap}function H(ap){var e=t(ap.charCodeAt(3));e+=t(ap.charCodeAt(2));e+=t(ap.charCodeAt(1));e+=t(ap.charCodeAt(0));return parseInt(e,16)}function R(e){var ap=H(e);if(ap>2147483647){ap=ap-4294967296}return ap}function Y(e,aq){var ap=H(e);if(aq===undefined){return ap}return(K(ap,aq))}function o(e,aq){var ap=new Date(H(e));ap=new Date(ap.getTime()+ap.getTimezoneOffset()*60000);if(aq===undefined){return ap}return(an(ap,aq))}function af(ap,aq){var e=new Date(H(ap)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(aq===undefined){return e}return(an(e,aq))}function r(aq){var at=1,av=0.5,ap=H(aq),e,au,ar;if(ap===0){return 0}e=((ap>>>31)===1)?"-":"+";ap<<=1;au=(ap>>>24)-127;ap<<=8;for(ar=1;ar<=23;ar++){at+=ap<0?av:0;ap<<=1;av/=2}return parseFloat(e+(at*Math.pow(2,au)))}function G(aq){var ap=H(aq.substring(4,8)),au=H(aq.substring(0,4)),at=12,ar=1,aw=0.5,e,av;if(ap===0&&au===0){return 0}e=((ap>>>31)===1)?"-":"+";ap<<=1;av=(ap>>>21)-1023;ap<<=11;while(at<32){ar+=ap<0?aw:0;ap<<=1;aw/=2;at++}if((au>>>31)===1){ar+=aw;au<<=1;aw/=2}while(at<64){ar+=au<0?aw:0;au<<=1;aw/=2;at++}return parseFloat(e+(ar*Math.pow(2,av)))}function ad(e){return e.split(String.fromCharCode(0))[0]}function S(ar){var at=q,av=0,e="",au,aq,ap,az,ay,ax,aw;ar=ar.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{az=at[ar.charAt(av++)];ay=at[ar.charAt(av++)];ax=at[ar.charAt(av++)];aw=at[ar.charAt(av++)];au=(az<<2)|(ay>>4);aq=((ay&15)<<4)|(ax>>2);ap=((ax&3)<<6)|aw;e+=String.fromCharCode(au);if(ax!==64){e+=String.fromCharCode(aq)}if(aw!==64){e+=String.fromCharCode(ap)}}while(av<ar.length);return e}function W(ap,e,ar){var aq;switch(e){case"BOOL":aq=(ap.charCodeAt(0)!="0");break;case"BYTE":case"USINT":aq=T(ap);break;case"SINT":aq=ah(ap);break;case"WORD":case"UINT":aq=P(ap);break;case"INT":case"INT16":aq=O(ap);break;case"INT1DP":aq=((O(ap))/10).toFixed(1);break;case"DWORD":case"UDINT":aq=H(ap);break;case"DINT":aq=R(ap);break;case"REAL":aq=r(ap);if(ar!==undefined){aq=aq.toFixed(parseInt(ar,10))}break;case"LREAL":aq=G(ap);if(ar!==undefined){aq=aq.toFixed(parseInt(ar,10))}break;case"STRING":aq=ad(ap);break;case"TOD":case"TIME_OF_DAY":aq=o(ap,ar);break;case"TIME":aq=Y(ap,ar);break;case"DT":case"DATE":case"DATE_AND_TIME":aq=af(ap,ar);break;case"EndStruct":break;default:l("TAME library error: Unknown data type at parsing read request: "+e);break}return aq}function x(aI){var ap,aA=aI.reqDescr.items,ay=[],aB=0,aF,ar,at,aH,aw,aD,ax,aG,aq,aC,az,au,av;try{ap=aI.xmlHttpReq.responseXML.documentElement;ar=S(ap.getElementsByTagName("ppData")[0].firstChild.data);for(az=0,au=aA.length;az<au;az++){aF=aA[az];ay=ai(aF);aq=ay[0];aC=ay[1];aD=C[aq];switch(aq){case"STRING":if(aC!==undefined){aw=parseInt(aC,10)}aD=(am(aw)?aw:aD)+1;break;case"EndStruct":aD=aF.val;break}ax=aD<a?aD:a;if(aI.reqDescr.seq!==true){av=k(aI.reqDescr);aB=aF.addr-av}else{if(aI.reqDescr.calcAlignment===true&&ax>1&&aq!=="EndStruct"&&aq!=="STRING"&&aB>0){aG=aB%ax;if(aG>0){aB+=ax-aG}}}at=ar.substr(aB,aD);aH=W(at,aq,aC);if(aq!=="EndStruct"){B(aF.jvar,aH,aI.reqDescr.dataObj,aF.prefix,aF.suffix)}if(aI.reqDescr.seq===true){aB+=aD}}}catch(aE){l("TAME library error: Parsing of Read Request failed:"+aE);l(aF);return}}function c(aP){var ap,aD=aP.reqDescr.items,aA=[],aH=0,ar=0,aF=window,aM=0,aL,au,av,aO,aJ,at,aI,aB,ay,aw,aE,aG,az,ax;function aq(){var aQ,e;if(at==="STRING"){if(aI!==undefined){aQ=parseInt(aI,10)}else{if(typeof aC.stringLength==="number"){aQ=aC.stringLength}}aJ=(am(aQ)?aQ:aJ)+1}e=av.substr(ar,aJ);aO=W(e,at,aI);B(aE,aO,aF,aL.prefix,aL.suffix);ar+=aJ}function aN(){var aR,aQ,aV,aU,aS,aT;function e(){var aX,aW;if(a>1&&at!=="STRING"&&at!=="EndStruct"){aX=aJ<a?aJ:a;if(aX>1&&ar>0){aW=ar%aX;if(aW>0){ar+=aX-aW}}if(aX>aM){aM=aX}}}for(aT in aL.def){if(aL.def.hasOwnProperty(aT)){aQ=aL.def[aT].split(".");if(aQ[0]==="ARRAY"){aV=parseInt(aQ[1],10);aU=aQ.length-1;for(aR=0;aR<aV;aR++){at=aQ[2];if(aQ[aU]==="SP"){aE=aT+aR;if(aU>=4){aI=aQ.slice(3,-1).join(".")}}else{aE=aT+"."+aR;if(aU>=3){aI=aQ.slice(3).join(".")}}if(aG!==null){aE=aG+"."+aE}aJ=C[at];e();aq()}}else{if(aG!==null){aE=aG+"."+aT}else{aE=aT}at=aQ[0];aI=aQ.slice(1).join(".");aJ=C[at];e();aq()}}}if(a>1&&aM>1&&at!=="STRING"&&at!=="EndStruct"){if(aM>a){aM=a}aS=ar%aM;if(aS>0){ar+=aM-aS}}}try{ap=aP.xmlHttpReq.responseXML.documentElement;au=S(ap.getElementsByTagName("ppRdData")[0].firstChild.data);for(aB=0,ay=aD.length;aB<ay;aB++){av=au.substr(aH,4);aw=W(av,"DWORD");if(aw!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+aw);l(aD[aB])}aH+=4}for(aB=0;aB<ay;aB++){aL=aD[aB];var aC=ak(aL);at=aC.type;aI=aC.format;ax=aC.size;aG=null;av=au.substr(aH,ax);switch(at){case"ARRAY":aF=B(aL.jvar);ar=0;az=aC.arrayLength;if(aC.arrayDataType==="USER"){for(aG=0;aG<az;aG++){aN()}}else{at=aC.arrayDataType;aJ=C[at];for(aG=0;aG<az;aG++){aE=aG;aq()}}break;case"USER":aF=B(aL.jvar);ar=0;aN();break;default:aF=window;aO=W(av,at,aI);B(aL.jvar,aO,aF,aL.prefix,aL.suffix)}aH+=ax}}catch(aK){l("TAME library error: Parsing of SumReadRequest failed:"+aK);l(aL);return}}function y(aH){var ap,az=aH.reqDescr.items,ax=[],aB=0,aq=0,aA=window,aF,at,au,aG,aD,ar,aC,ay,aw,av;try{ap=aH.xmlHttpReq.responseXML.documentElement;at=S(ap.getElementsByTagName("ppRdData")[0].firstChild.data);for(ay=0,aw=az.length;ay<aw;ay++){au=at.substr(aB,4);av=W(au,"DWORD");if(av!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+av);l(az[ay])}aB+=4}}catch(aE){l("TAME library error: Parsing of SumWriteRequest failed:"+aE);l(aF);return}}function aj(ar){var ap;try{ap=ar.xmlHttpReq.responseXML.documentElement;aa.adsState=parseInt(ap.getElementsByTagName("pAdsState")[0].firstChild.data,10);aa.adsStateTxt=U[aa.adsState];aa.deviceState=parseInt(ap.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(aq){l("TAME library error: Parsing of ADS Read State Request failed:"+aq);return}}function N(av,au,ar){var aq={},at,e;var ap=ak(ar);e=C[au];switch(au){case"STRING":if(am(ar.strlen)){au+="."+ar.strlen;e=ar.strlen}else{if(typeof ap.stringLength==="number"){e=ap.stringLength;au+="."+e}else{l("TAME library error: Could not get the length of the string for this request!");l(ar)}}e++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ar.format==="string"){au+="."+ar.format}break;case"REAL":case"LREAL":if(typeof ar.decPlaces==="number"){au+="."+ar.decPlaces}else{if(typeof ar.dp==="number"){au+="."+ar.dp}}break}aq={addr:ar.addr,symbolName:ap.symbolName,dataTypeNames:ap.dataTypeNames,dataTypeArrIdx:ap.dataTypeArrIdx,symbolNameArrIdx:ap.symbolNameArrIdx,id:ar.id,oc:ar.oc,ocd:ar.ocd,readLength:e,debug:ar.debug,sync:ar.sync,offs:ar.offs,seq:true,items:[{val:ar.val,jvar:ar.jvar,type:au,prefix:ar.prefix,suffix:ar.suffix}]};if(av==="Write"){aa.writeReq(aq)}else{aa.readReq(aq)}}function I(ar,at,aq){var au={},aG={},aA,ap,aI=0,aJ=0,aH=0,aK,e=[],aM,aw,az=0,aB,ax,aL=0,aC=0,aO,ay,aN,aE;var aD=ak(aq);if(ar==="Write"&&typeof aq.val==="object"){aG=aq.val}else{if(typeof aq.jvar==="string"){aG=B(aq.jvar)}else{l("TAME library error: No data object for this "+ar+"-Request defined!")}}if(typeof aq.arrlen==="number"){aA=aq.arrlen}else{if(aD.arrayLength!==undefined){aA=aD.arrayLength}else{l("TAME library error: Can't get the array length for this request!");l(aq)}}if(typeof aq.item==="number"&&!isNaN(aq.item)&&ar==="Write"){aN=true;if(aq.item<0||aq.item>aA-1){l('TAME library error: Wrong value for "item"!');l("item: "+aq.item);l("Last array index: "+(aA-1))}}function av(){var aP;if(typeof aq.def==="string"){aq.def=B(aq.def)}else{if(typeof aq.def!=="object"){l("TAME library error: No structure definition found!")}}for(aP in aq.def){if(aq.def.hasOwnProperty(aP)){e=aq.def[aP].split(".");if(e[0]==="ARRAY"){aM=parseInt(e[1],10);e.shift();e.shift()}else{aM=1}for(aJ=0;aJ<aM;aJ++){if(e[0]==="STRING"){if(typeof e[1]==="string"){aB=parseInt(e[1],10)}ax=(am(aB)?aB:C[e[0]])+1}else{ax=C[e[0]]}if(a>1&&ax>1&&e[0]!=="STRING"&&az>0){aO=az%ax;if(aO>0){az+=ax-aO}}az+=ax}if(a>1&&ax>aL&&e[0]!=="STRING"){aL=ax}}}if(a>1&&aL>1&&e[0]!=="STRING"){if(aL>a){aL=a}aO=az%aL;if(aO>0){aC=aL-aO;az+=aC}}if(aN){ap=az*aq.item;aA=1}au={addr:aq.addr,symbolName:aD.symbolName,dataTypeNames:aD.dataTypeNames,addrOffset:ap,id:aq.id,oc:aq.oc,ocd:aq.ocd,debug:aq.debug,readLength:az*aA,seq:true,calcAlignment:true,dataObj:aG,sync:aq.sync,offs:aq.offs,items:[]};for(aJ=0;aJ<aA;aJ++){for(aP in aq.def){if(aq.def.hasOwnProperty(aP)){e=aq.def[aP].split(".");if(e[0]==="ARRAY"){aM=parseInt(e[1],10);aw=e.length-1;for(aH=0;aH<aM;aH++){if(e[aw]==="SP"){au.items[aI]={jvar:aJ+"."+aP+aH};if(aw===4){au.items[aI].type=e[2]+"."+e[3]}else{au.items[aI].type=e[2]}}else{au.items[aI]={jvar:aJ+"."+aP+"."+aH};if(aw===3){au.items[aI].type=e[2]+"."+e[3]}else{au.items[aI].type=e[2]}}if(ar==="Write"){if(aN){if(e[aw]==="SP"){au.items[aI].val=aG[aq.item][aP+aH]}else{au.items[aI].val=aG[aq.item][aP][aH]}}else{if(e[aw]==="SP"){au.items[aI].val=aG[aJ][aP+aH]}else{au.items[aI].val=aG[aJ][aP][aH]}}}aI++}}else{au.items[aI]={jvar:aJ+"."+aP,type:aq.def[aP]};if(ar==="Write"){if(aN){au.items[aI].val=aG[aq.item][aP]}else{au.items[aI].val=aG[aJ][aP]}}aI++}}}if(a>1){au.items[aI]={type:"EndStruct",val:aC};aI++}}}function aF(){aK=C[at];switch(at){case"STRING":if(am(aq.strlen)){at+="."+aq.strlen;aK=aq.strlen}else{if(typeof aD.stringLength==="number"){aK=aD.stringLength;at+="."+aK}else{l("TAME library error: Could not get the length of the string for this request!");l(aq)}}aK++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof aq.format==="string"){at+="."+aq.format}break;case"REAL":case"LREAL":if(typeof aq.decPlaces==="number"){at+="."+aq.decPlaces}else{if(typeof aq.dp==="number"){at+="."+aq.dp}}break}if(aN){ap=aq.item*aK;aA=1}au={addr:aq.addr,symbolName:aD.symbolName,dataTypeNames:aD.dataTypeNames,dataTypeArrIdx:aD.dataTypeArrIdx,symbolNameArrIdx:aD.symbolNameArrIdx,addrOffset:ap,id:aq.id,oc:aq.oc,ocd:aq.ocd,readLength:aK*aA,debug:aq.debug,seq:true,dataObj:aG,items:[]};for(aJ=0;aJ<aA;aJ++){au.items[aJ]={jvar:aJ,type:at};if(ar==="Write"){if(aN){au.items[aJ].val=aG[aq.item]}else{au.items[aJ].val=aG[aJ]}}}}if(at==="STRUCT"){av()}else{aF()}if(ar==="Write"){aa.writeReq(au)}else{aa.readReq(au)}}function ac(e,ay){var av={},ap={},az=[],at=0,ax,ar,au,aw;var aq=ak(ay);if(e==="Write"&&typeof ay.val==="object"){ap=ay.val}else{if(typeof ay.jvar==="string"){ap=B(ay.jvar)}else{l("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof ay.def==="string"){ay.def=B(ay.def)}else{if(typeof ay.def!=="object"){l("TAME library error: No structure defininition found!")}}av={addr:ay.addr,symbolName:aq.symbolName,dataTypeNames:aq.dataTypeNames,dataTypeArrIdx:aq.dataTypeArrIdx,symbolNameArrIdx:aq.symbolNameArrIdx,id:ay.id,oc:ay.oc,ocd:ay.ocd,debug:ay.debug,seq:true,calcAlignment:true,dataObj:ap,sync:ay.sync,offs:ay.offs,items:[]};for(au in ay.def){if(ay.def.hasOwnProperty(au)){az=ay.def[au].split(".");if(az[0]==="ARRAY"){ar=parseInt(az[1],10);ax=az.length-1;for(aw=0;aw<ar;aw++){if(az[ax]==="SP"){av.items[at]={jvar:au+aw};if(ax===4){av.items[at].type=az[2]+"."+az[3]}else{av.items[at].type=az[2]}}else{av.items[at]={jvar:au+"."+aw};if(ax===3){av.items[at].type=az[2]+"."+az[3]}else{av.items[at].type=az[2]}}if(e==="Write"){if(az[ax]==="SP"){av.items[at].val=ap[au+aw]}else{av.items[at].val=ap[au][aw]}}at++}}else{av.items[at]={jvar:au,type:ay.def[au]};if(e==="Write"){av.items[at].val=ap[au]}at++}}}if(e==="Write"){aa.writeReq(av)}else{aa.readReq(av)}}this.writeReq=function(ar){var au=ar.items,aB={},e=[],ax=[],aE=[],aw,aA,aq,av,ap,aC,ay,aD,at,az;if(typeof ar.name==="string"){ar.name=ar.name.toUpperCase()}for(az=0,aq=au.length;az<aq;az++){aD=au[az];ax=ai(aD);aw=ax[0];aA=ax[1];if(isNaN(C[aw])){l("TAME library error: Could not get the length of the data type: "+aw);l("TAME library error: Probably wrong type definition. Please check the manual.");l(ar);return}av=(C[aw]<a)?C[aw]:a;if(ar.calcAlignment===true&&av>1&&aw!=="STRING"&&aw!=="EndStruct"&&e.length>0){ay=e.length%av;if(ay>0){aC=av-ay;for(at=1;at<=aC;at++){e.push(0)}}}if(aw==="EndStruct"){for(at=1;at<=aD.val;at++){e.push(0)}}else{aE=d(aD,aw,aA,C[aw]);e=e.concat(aE)}}if(e&&e.length>0){e=p(e)}aB={method:"Write",indexGroup:z(ar),indexOffset:k(ar),pData:e,reqDescr:ar};v(aB).send()};this.readReq=function(aq){var az={},ar=aq.items,au=[],aA,ay,at,e,av,aw,aB,ax,ap;if(typeof aq.readLength!=="number"){aq.readLength=0;for(ax=0,e=ar.length;ax<e;ax++){aA=ar[ax];au=ai(aA);at=au[0];ay=au[1];if(isNaN(C[at])){l("TAME library error: Could not get the length of the data type: "+at);l("TAME library error: Probably wrong type definition. Please check the manual.");l(aq);return}if(at==="STRING"){if(typeof ay==="string"){aB=parseInt(ay,10)}aw=(am(aB)?aB:C[at])+1}else{aw=C[at]}if(aq.seq===true){if(aq.calcAlignment===true&&aw>1&&at!=="EndStruct"&&at!=="STRING"&&aq.readLength>0){av=aq.readLength%aw;if(av>0){aq.readLength+=aw-av}}aq.readLength+=aw}else{ap=k(aq);aq.readLength=aw+aA.addr-ap}}}az={method:"Read",indexGroup:z(aq),indexOffset:k(aq),reqDescr:aq};v(az).send()};this.sumReadReq=function(ar){var aA={},au=ar.items,ax=[],aC=[],aD=[],aq=au.length,at={},aw,az,aB,ay,av,e;ar.readLength=aq*4;for(ay=0;ay<aq;ay++){aB=au[ay];var ap=ak(aB);av=ap.size;ar.readLength+=av;at.val=z(ap);aD=d(at,"UDINT",az,4);aC=aC.concat(aD);at.val=k(ap);aD=d(at,"UDINT",az,4);aC=aC.concat(aD);at.val=av;aD=d(at,"UDINT",az,4);aC=aC.concat(aD)}if(aC.length>0){e=p(aC)}aA={method:"ReadWrite",indexGroup:m.SumRd,indexOffset:au.length,pwrData:e,reqDescr:ar};v(aA).send()};this.sumWriteReq=function(ar){var aL={},az=ar.items,av=[],ap=[],ax=[],at=az.length,aI={},aG=0,aq,aD,aF,aw,aE,aK,aC,aB,au,aH,e;function aA(){var aM;aE=C[aq];if(aq==="STRING"){if(aD!==undefined){aM=parseInt(aD,10)}else{if(typeof ay.stringLength==="number"){aM=ay.stringLength}}aD=(am(aM)?aM:aE)}}function aJ(){var aP,aU,aM,aQ,aS,aN,aO=[];function aT(){var aW,aV;if(a>1&&aq!=="STRING"&&aq!=="EndStruct"){aW=aE<a?aE:a;if(aW>1&&aO.length>0){aS=aO.length%aW;if(aS>0){e=aW-aS;for(aV=1;aV<=e;aV++){aO.push(0)}}}if(aW>aG){aG=aW}}}for(aN in aF.def){if(aF.def.hasOwnProperty(aN)){try{aU=aF.def[aN].split(".");if(aU[0]==="ARRAY"){aM=parseInt(aU[1],10);aQ=aU.length-1;for(aP=0;aP<aM;aP++){aq=aU[2];if(aU[aQ]==="SP"){if(aQ>=4){aD=aU.slice(3,-1).join(".")}}else{if(aQ>=3){aD=aU.slice(3).join(".")}}if(aC!==null){if(aU[aQ]==="SP"){aI.val=aF.val[aC][aN+aP]}else{aI.val=aF.val[aC][aN][aP]}}else{aI.val=aF.val[aN][aP]}aA();aT();ax=d(aI,aq,aD,aE);aO=aO.concat(ax)}}else{if(aC!==null){aI.val=aF.val[aC][aN]}else{aI.val=aF.val[aN]}aq=aU[0];aD=aU.slice(1).join(".");aA();aT();ax=d(aI,aq,aD,aE);aO=aO.concat(ax)}}catch(aR){l("TAME library error: Could not set values for a structure in SumWriteReq: "+aR);l(aF)}}}if(a>1&&aG>1&&aU[0]!=="STRING"&&aU[0]!=="EndStruct"){aS=aO.length%aG;if(aS>0){e=aG-aS;for(aB=1;aB<=e;aB++){aO.push(0)}}}ap=ap.concat(aO)}ar.readLength=at*4;for(aw=0;aw<at;aw++){aF=az[aw];var ay=ak(aF);aq=ay.type;aD=ay.format;aE=ay.size;aI.val=z(ay);ax=d(aI,"UDINT",aD,4);ap=ap.concat(ax);aI.val=k(ay);ax=d(aI,"UDINT",aD,4);ap=ap.concat(ax);aI.val=aE;ax=d(aI,"UDINT",aD,4);ap=ap.concat(ax)}for(aw=0;aw<at;aw++){aF=az[aw];ay=ak(aF);aq=ay.type;aD=ay.format;aE=ay.size;aC=null;switch(aq){case"ARRAY":au=parseInt(ay.arrayLength,10);if(au!==aF.val.length){l("TAME library error: Array length in JS differs from the length in the PLC!");l("Length in JS: "+aF.val.length);l("Length in PLC: "+au);l(aF);return}if(ay.arrayDataType==="USER"){for(aC=0;aC<au;aC++){aJ()}}else{aq=ay.arrayDataType;if(aq==="STRING"){aD=ay.stringLength}else{aE=ay.itemSize}for(aC=0;aC<au;aC++){aI.val=aF.val[aC];ax=d(aI,aq,aD,aE);ap=ap.concat(ax)}}break;case"USER":aJ();break;default:if(aq==="STRING"){aD=ay.stringLength}else{aE=ay.size}ax=d(aF,aq,aD,aE);ap=ap.concat(ax)}}if(ap.length>0){aK=p(ap)}aL={method:"ReadWrite",indexGroup:m.SumWr,indexOffset:az.length,pwrData:aK,reqDescr:ar};v(aL).send()};this.readAdsState=function(e){var ap={method:"ReadState",reqDescr:e};v(ap).send()};this.logSymbols=function(){l(Q)};this.logDataTypes=function(){l(ao)};this.getSymbolsAsJSON=function(){var aq;if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{aq=JSON.stringify(Q);return aq}catch(ap){l("TAME library error: Could not convert the Symbol Table to JSON:"+ap)}}};this.setSymbolsFromJSON=function(aq){if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{Q=JSON.parse(aq)}catch(ap){l("TAME library error: Could not create the Symbol Table from JSON:"+ap);return}j=true;l("TAME library info: Symbol Table successfully created from JSON data.")}};this.parseResponse=function(av){var aq,au,ap;if(typeof av.reqDescr.id==="number"){F[av.reqDescr.id]=0}if(av.xmlHttpReq.responseXML===null){l('TAME library error: Request contains no XML data. Object "responseXML" is null.');l('TAME library error: This is the "responseText":');l(av.xmlHttpReq.responseText)}try{aq=av.xmlHttpReq.responseXML.documentElement}catch(at){l("TAME library error: No XML data in server response:"+at);return}try{ap=aq.getElementsByTagName("faultstring")[0].firstChild.data;try{au=aq.getElementsByTagName("errorcode")[0].firstChild.data}catch(at){au="-"}l("TAME library error: Message from server:  "+ap+" ("+au+")");return}catch(ar){au=0}if(typeof aq.normalize==="function"){aq.normalize()}if(av.method==="ReadState"){aj(av)}else{if(av.method==="Read"||av.method==="ReadWrite"){switch(av.indexGroup){case m.UploadInfo:X(av);break;case m.Upload:ae(av);break;case m.SumRd:c(av);break;case m.SumWr:y(av);break;default:x(av)}}}if(typeof av.reqDescr.oc==="function"){if(typeof av.reqDescr.ocd==="number"){window.setTimeout(av.reqDescr.oc,av.reqDescr.ocd)}else{av.reqDescr.oc()}}};this.writeBool=function(e){N("Write","BOOL",e)};this.writeByte=function(e){N("Write","BYTE",e)};this.writeUsint=function(e){N("Write","USINT",e)};this.writeSint=function(e){N("Write","SINT",e)};this.writeWord=function(e){N("Write","WORD",e)};this.writeUint=function(e){N("Write","UINT",e)};this.writeInt=function(e){N("Write","INT",e)};this.writeInt1Dp=function(e){N("Write","INT1DP",e)};this.writeDword=function(e){N("Write","DWORD",e)};this.writeUdint=function(e){N("Write","UDINT",e)};this.writeDint=function(e){N("Write","DINT",e)};this.writeReal=function(e){N("Write","REAL",e)};this.writeLreal=function(e){N("Write","LREAL",e)};this.writeString=function(e){N("Write","STRING",e)};this.writeTime=function(e){N("Write","TIME",e)};this.writeTod=function(e){N("Write","TOD",e)};this.writeDate=function(e){N("Write","DATE",e)};this.writeDt=function(e){N("Write","DT",e)};this.readBool=function(e){N("Read","BOOL",e)};this.readByte=function(e){N("Read","BYTE",e)};this.readUsint=function(e){N("Read","USINT",e)};this.readSint=function(e){N("Read","SINT",e)};this.readWord=function(e){N("Read","WORD",e)};this.readUint=function(e){N("Read","UINT",e)};this.readInt=function(e){N("Read","INT",e)};this.readInt1Dp=function(e){N("Read","INT1DP",e)};this.readDword=function(e){N("Read","DWORD",e)};this.readUdint=function(e){N("Read","UDINT",e)};this.readDint=function(e){N("Read","DINT",e)};this.readReal=function(e){N("Read","REAL",e)};this.readLreal=function(e){N("Read","LREAL",e)};this.readString=function(e){N("Read","STRING",e)};this.readTime=function(e){N("Read","TIME",e)};this.readTod=function(e){N("Read","TOD",e)};this.readDate=function(e){N("Read","DATE",e)};this.readDt=function(e){N("Read","DT",e)};this.writeStruct=function(e){ac("Write",e)};this.readStruct=function(e){ac("Read",e)};this.writeArrayOfBool=function(e){I("Write","BOOL",e)};this.writeArrayOfByte=function(e){I("Write","BYTE",e)};this.writeArrayOfUsint=function(e){I("Write","USINT",e)};this.writeArrayOfSint=function(e){I("Write","SINT",e)};this.writeArrayOfWord=function(e){I("Write","WORD",e)};this.writeArrayOfUint=function(e){I("Write","UINT",e)};this.writeArrayOfInt=function(e){I("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){I("Write","INT1DP",e)};this.writeArrayOfDword=function(e){I("Write","DWORD",e)};this.writeArrayOfUdint=function(e){I("Write","UDINT",e)};this.writeArrayOfDint=function(e){I("Write","DINT",e)};this.writeArrayOfReal=function(e){I("Write","REAL",e)};this.writeArrayOfLreal=function(e){I("Write","LREAL",e)};this.writeArrayOfString=function(e){I("Write","STRING",e)};this.writeArrayOfTime=function(e){I("Write","TIME",e)};this.writeArrayOfTod=function(e){I("Write","TOD",e)};this.writeArrayOfDate=function(e){I("Write","DATE",e)};this.writeArrayOfDt=function(e){I("Write","DT",e)};this.writeArrayOfStruct=function(e){I("Write","STRUCT",e)};this.readArrayOfBool=function(e){I("Read","BOOL",e)};this.readArrayOfByte=function(e){I("Read","BYTE",e)};this.readArrayOfUsint=function(e){I("Read","USINT",e)};this.readArrayOfSint=function(e){I("Read","SINT",e)};this.readArrayOfWord=function(e){I("Read","WORD",e)};this.readArrayOfUint=function(e){I("Read","UINT",e)};this.readArrayOfInt=function(e){I("Read","INT",e)};this.readArrayOfInt1Dp=function(e){I("Read","INT1DP",e)};this.readArrayOfDword=function(e){I("Read","DWORD",e)};this.readArrayOfUdint=function(e){I("Read","UDINT",e)};this.readArrayOfDint=function(e){I("Read","DINT",e)};this.readArrayOfReal=function(e){I("Read","REAL",e)};this.readArrayOfLreal=function(e){I("Read","LREAL",e)};this.readArrayOfString=function(e){I("Read","STRING",e)};this.readArrayOfTime=function(e){I("Read","TIME",e)};this.readArrayOfTod=function(e){I("Read","TOD",e)};this.readArrayOfDate=function(e){I("Read","DATE",e)};this.readArrayOfDt=function(e){I("Read","DT",e)};this.readArrayOfStruct=function(e){I("Read","STRUCT",e)};function ab(){var e={method:"Read",sync:true,indexGroup:m.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};v(e).send()}function X(av){var ap,aq,aw,at,ar;try{ap=av.xmlHttpReq.responseXML.documentElement;aq=S(ap.getElementsByTagName("ppData")[0].firstChild.data);aw=aq.substr(0,4);b=W(aw,"DWORD");aw=aq.substr(4,4);w=W(aw,"DWORD")}catch(au){l("TAME library error: Parsing of UploadInfo failed:"+au);return}ar={method:"Read",sync:true,indexGroup:m.Upload,indexOffset:0,reqDescr:{readLength:w}};v(ar).send()}function ae(aH){var ap,az=0,aE=4,aB=8,ax=12,au=30,at,av,aG,ay,aA,aq,aF,aw,ar,aD;try{ap=aH.xmlHttpReq.responseXML.documentElement;at=S(ap.getElementsByTagName("ppData")[0].firstChild.data);for(ay=0;ay<b;ay++){av=at.substr(az,4);aA=W(av,"DWORD");aq=at.substring(az+au,(az+aA)).split(String.fromCharCode(0));name=aq[0].toUpperCase();Q[name]={typeString:aq[1],indexGroup:W(at.substr(az+aE,4),"DWORD"),indexOffset:W(at.substr(az+aB,4),"DWORD"),size:W(at.substr(az+ax,4),"DWORD")};aF=aq[1].split(" ");if(aF[0]==="ARRAY"){Q[name].type=aF[0];aw=aF[1].substring(1,aF[1].length-1);aw=aw.split("..");Q[name].arrStartIdx=parseInt(aw[0],10);aw=parseInt(aw[1],10)-parseInt(aw[0],10)+1;Q[name].arrayLength=aw;ar=aF[3].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);Q[name].fullType=aF[0]+"."+aw+"."+ar[0]+"."+ar[1];Q[name].stringLength=parseInt(ar[1],10)}else{Q[name].fullType=aF[0]+"."+aw+"."+ar[0]}Q[name].itemSize=Q[name].size/aw;Q[name].arrayDataType="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ar[0]===aD){Q[name].arrayDataType=ar[0]}}}if(Q[name].arrayDataType==="USER"){Q[name].dataType=ar[0]}}else{ar=aF[0].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);Q[name].fullType=ar[0]+"."+ar[1];Q[name].stringLength=parseInt(ar[1],10)}else{Q[name].fullType=ar[0]}Q[name].type="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ar[0]===aD){Q[name].type=ar[0]}}}if(Q[name].type==="USER"){Q[name].dataType=ar[0]}}az+=aA}j=true;l("TAME library info: End of fetching the symbols.");l("TAME library info: Symbol table ready.")}catch(aC){l("TAME library error: Parsing of uploaded symbol information failed:"+aC);return}}function J(){var ax=Z(),aw=[],aB,aH,ay,aF,au,ap,aD,av;ax.open("GET",g.configFileUrl,false);ax.setRequestHeader("Content-Type","text/xml");ax.send(null);l("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aB=(new DOMParser()).parseFromString(ax.responseText,"text/xml")}catch(aC){l("TAME library error: Creating a DOM object from TPY failed:"+aC);return}}else{l("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(true){try{A={netId:aB.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:aB.getElementsByTagName("Port")[0].childNodes[0].nodeValue}}catch(aC){l("TAME library error: An error occured while reading service information from the TPY file:");l(aC)}}av=aB.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(av==="2"){A.alignment=parseInt(aB.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(av==="3"){A.alignment=8}else{l("TAME library error: Could not determine the TwinCAT version.")}}if(true){try{ay=aB.getElementsByTagName("Symbols")[0];aw=ay.getElementsByTagName("Symbol");for(var aA=0;aA<aw.length;aA++){aH=aw[aA].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();Q[aH]={typeString:aw[aA].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(aw[aA].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(aw[aA].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(aw[aA].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};Q[aH].size=(Q[aH].bitSize>=8)?Q[aH].bitSize/8:Q[aH].bitSize;aF=Q[aH].typeString.split(" ");if(aF[0]==="ARRAY"){Q[aH].type=aF[0];au=aF[1].substring(1,aF[1].length-1);au=au.split("..");Q[aH].arrStartIdx=parseInt(au[0],10);au=parseInt(au[1],10)-parseInt(au[0],10)+1;Q[aH].arrayLength=au;ap=aF[3].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);Q[aH].fullType=aF[0]+"."+au+"."+ap[0]+"."+ap[1];Q[aH].stringLength=parseInt(ap[1],10)}else{Q[aH].fullType=aF[0]+"."+au+"."+ap[0]}Q[aH].itemSize=Q[aH].size/au;Q[aH].arrayDataType="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ap[0]===aD){Q[aH].arrayDataType=ap[0]}}}if(Q[aH].arrayDataType==="USER"){Q[aH].dataType=ap[0]}}else{ap=aF[0].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);Q[aH].fullType=ap[0]+"."+ap[1];Q[aH].stringLength=parseInt(ap[1],10)}else{Q[aH].fullType=ap[0]}Q[aH].type="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ap[0]===aD){Q[aH].type=ap[0]}}}if(Q[aH].type==="USER"){Q[aH].dataType=ap[0]}}}j=true;l("TAME library info: Symbol table ready.")}catch(aC){l("TAME library error: An error occured while parsing the symbol file:");l(aC)}}var at,aE,aq,ar,aG;if(true){try{at=aB.getElementsByTagName("DataTypes")[0];aE=at.getElementsByTagName("DataType");for(var aA=0;aA<aE.length;aA++){aG=aE[aA].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aH=aG.split(" ")[0];if(aH==="ARRAY"){ao[aG]={bitSize:parseInt(aE[aA].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};ao[aG].size=ao[aG].bitSize/8}}for(var aA=0;aA<aE.length;aA++){aG=aE[aA].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aH=aG.split(" ")[0];if(aH!=="ARRAY"){ao[aH]={bitSize:parseInt(aE[aA].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};ao[aH].size=ao[aH].bitSize/8;aq=aE[aA].getElementsByTagName("SubItem");for(var az=0;az<aq.length;az++){ar=aq[az].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ao[aH].subItems[ar]={typeString:aq[az].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:aq[az].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(aq[az].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(aq[az].getElementsByTagName("BitOffs")[0]!==undefined){ao[aH].subItems[ar].bitOffset=parseInt(aq[az].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}ao[aH].subItems[ar].size=(ao[aH].subItems[ar].bitSize>=8)?ao[aH].subItems[ar].bitSize/8:ao[aH].subItems[ar].bitSize;aF=ao[aH].subItems[ar].typeString.split(" ");if(aF[0]==="ARRAY"){ao[aH].subItems[ar].type=aF[0];au=aF[1].substring(1,aF[1].length-1);au=au.split("..");ao[aH].subItems[ar].arrStartIdx=parseInt(au[0],10);au=parseInt(au[1],10)-parseInt(au[0],10)+1;ao[aH].subItems[ar].arrayLength=au;ap=aF[3].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);ao[aH].subItems[ar].fullType=aF[0]+"."+au+"."+ap[0]+"."+ap[1];ao[aH].subItems[ar].stringLength=parseInt(ap[1],10)}else{ao[aH].subItems[ar].fullType=aF[0]+"."+au+"."+ap[0]}ao[aH].subItems[ar].bitSize=ao[ao[aH].subItems[ar].typeString].bitSize;ao[aH].subItems[ar].size=ao[ao[aH].subItems[ar].typeString].size;ao[aH].subItems[ar].itemSize=ao[aH].subItems[ar].size/au;ao[aH].subItems[ar].arrayDataType="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ap[0]===aD){ao[aH].subItems[ar].arrayDataType=ap[0]}}}if(ao[aH].subItems[ar].arrayDataType==="USER"){ao[aH].subItems[ar].dataType=ap[0]}}else{ap=aF[0].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);ao[aH].subItems[ar].fullType=ap[0]+"."+ap[1];ao[aH].subItems[ar].stringLength=parseInt(ap[1],10)}else{ao[aH].subItems[ar].fullType=ap[0]}ao[aH].subItems[ar].type="USER";for(aD in C){if(C.hasOwnProperty(aD)){if(ap[0]===aD){ao[aH].subItems[ar].type=ap[0]}}}if(ao[aH].subItems[ar].type==="USER"){ao[aH].subItems[ar].dataType=ap[0]}}}}}f=true;l("TAME library info: End of reading the data types from the TPY file.")}catch(aC){l("TAME library error: An error occured while creating the data type information:");l(aC)}}}function u(){if(typeof g.amsNetId!=="string"){g.amsNetId=A.netId;l("TAME library info: NetId from TPY file is used: "+g.amsNetId)}if(typeof g.amsPort!=="string"){g.amsPort=A.port;l("TAME library info: AMS port number from TPY file is used: "+g.amsPort)}if(a===0){a=A.alignment;l("TAME library info: Alignment from TPY file is used and set to: "+a)}else{l("TAME library info: Data alignment manually set to: "+a)}if(a!==1&&a!==4&&a!==8){l("TAME library warning: The value for the alignment should be 1, 4 or 8.")}}if(g.dontFetchSymbols===true){l("TAME library info: Reading of the UploadInfo deactivated. Symbol Table could not be created.")}else{if(typeof g.configFileUrl=="string"){l("TAME library info: Fetching the TPY file from the webserver.");J()}else{l("TAME library info: Start fetching the symbols from PLC.");try{ab()}catch(al){l("TAME library error: Could'nt fetch the symbol information from the PLC:"+al);return}}u()}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};