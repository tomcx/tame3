/*!
 * TAME [TwinCAT ADS Made Easy] V3.5 alpha
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(g){function l(an){try{window.console.log(an)}catch(ao){alert(an)}}var Y=this,m={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,SumRd:61568,SumWr:61569,SumRdWr:61570},A={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},S=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],h=(typeof g.language==="string")?g.language:"ge",n=(function(){var e={},ao="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",an;for(an=0;an<ao.length;an++){e[an]=ao.charAt(an)}return e}()),q=(function(){var e={},ao="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",an;for(an=0;an<ao.length;an++){e[ao.charAt(an)]=an}return e}()),a=1,E=[0],O={},j=false,am={},f=false,b=0,v=0;if(typeof g.serviceUrl!=="string"){l("TAME library error: Service URL is not a string!");return}if(typeof g.amsNetId!=="string"){l("TAME library error: NetId is not a string!");return}if(g.amsPort===undefined){g.amsPort="801";l("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof g.amsPort==="number"){l("TAME library warning: AMS port number is not a string! Trying to convert it.");g.amsPort=g.amsPort.toString(10)}}if(parseInt(g.amsPort,10)<801||parseInt(g.amsPort,10)>891){l("TAME library error: AMS Port Number ("+parseInt(g.amsPort,10)+") is out of range (801-891)!");return}if(g.dataAlign4===true){a=4}else{if(g.alignment===undefined){a=1}else{if(typeof g.alignment==="string"){a=parseInt(g.alignment,10)}else{if(typeof g.alignment==="number"){a=g.alignment}}}}l("TAME library info: Data alignment set to: "+a);if(a!==1&&a!==4&&a!==8){l("TAME library warning: The value for the alignment should be 1, 4 or 8.")}if(g.syncXmlHttp===true){l('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests are used by default.')}if(typeof g.serviceUser==="string"&&typeof g.servicePassword==="string"){l("TAME library info: Username and password set. Authenticated requests will be used.")}else{g.serviceUser=null;g.servicePassword=null}this.dateNames={weekdShort:TAME.weekdShortNames[h],weekdLong:TAME.weekdLongNames[h],monthsShort:TAME.monthsShortNames[h],monthsLong:TAME.monthsLongNames[h]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;function z(e,ap,ao,ar,av){var aq=[],au=0,at=[],an=0;if(typeof e==="number"){aq[0]=e.toString(10)}else{if(typeof e==="string"){aq=e.split(".")}else{l("TAME library error: Can't parse name of object/variable. Name is not a string or number!");l(e);return}}if(ao===undefined){ao=window}au=aq.length-1;while(an<au){if(aq[an].charAt(aq[an].length-1)==="]"){at=aq[an].substring(0,aq[an].length-1).split("[");ao=ao[at[0]][at[1]]}else{if(ao[aq[an]]===undefined){ao[aq[an]]=[]}ao=ao[aq[an]]}an++}if(aq[an].charAt(aq[an].length-1)==="]"){at=aq[an].substring(0,aq[an].length-1).split("[");ao=ao[at[0]];if(ap!==undefined){if(typeof ar==="string"){ap=ar+ap}if(typeof av==="string"){ap=ap+av}ao[at[1]]=ap}return ao[at[1]]}if(ap!==undefined){if(typeof ar==="string"){ap=ar+ap}if(typeof av==="string"){ap=ap+av}ao[aq[an]]=ap}return ao[aq[an]]}function ak(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=Y.maxStringLen){return true}l("TAME library error: User defined string length not valid! length: "+e);l("Max. string length: "+Y.maxStringLen);return false}function y(ao){var an;if(ao.addr){if(typeof ao.addr==="string"&&ao.addr.charAt(0)==="%"){if(ao.addr.charAt(2)==="X"){an=m[ao.addr.substr(1,2)]}else{an=m[ao.addr.substr(1,1)]}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(ao);return}}else{if(ao.symbolName){if(typeof ao.symbolName==="string"){try{an=O[ao.symbolName].indexGroup}catch(ap){l("TAME library error: Can't get the IndexGroup for this request!");l("TAME library error: Please check the variable name.");l(ap);l(ao);return}}else{l("TAME library error: Varible name should be a string!");l(ao);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(ao);return}}if(isNaN(an)){l("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");l(ao)}return an}function k(au){var aq,ao="",at=[],ap,aw,an,av,ay,ax;if(au.addr){if(typeof au.addr==="string"&&au.addr.charAt(0)==="%"){if(au.addr.charAt(2)==="X"){ao=au.addr.substr(3);at=ao.split(".");aq=parseInt(at[0],10)*8+parseInt(at[1],10)}else{aq=parseInt(au.addr.substr(3),10);if(typeof au.addrOffset==="number"){aq+=au.addrOffset}}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(au);return}}else{if(au.symbolName){if(typeof au.symbolName==="string"){try{aq=O[au.symbolName].indexOffset;if(typeof au.addrOffset==="number"){aq+=au.addrOffset}if(typeof au.offs==="string"){aq+=parseInt(au.offs,10)/8}else{if(typeof au.offs==="number"){aq+=au.offs/8}}if(au.arrDataName.length>0){an=au.arrDataName;aw=O[au.symbolName].dataType;for(ap=0;ap<an.length;ap++){l("req: "+an[ap]);l("1: "+aq);ax=am[aw].subItems[an[ap]];aq+=ax.bitOffset/8;l("2: "+aq);if(typeof au.arrIdx[ap+1]==="number"){aq+=ax.itemSize*au.arrIdx[ap+1]}l("3: "+aq);aw=am[aw].subItems[an[ap]].dataType}}}catch(ar){l("TAME library error: Can't get the IndexOffset for this request!");l("TAME library error: Please check the variable definition (name/offs/subitem).");l(ar);l(au);return}}else{l("TAME library error: Varible name should be a string!");l(au);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(au);return}}if(isNaN(aq)){l("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");l(au)}return aq}function ai(aw){var an={},av,ap;if(typeof aw.name==="string"){aw.name=aw.name.toUpperCase();av=aw.name.split(".")}l(aw.name);if(av[0]===""){an.symbolName="."+av[1]}else{an.symbolName=av[0]+"."+av[1]}an.arrDataName=av.slice(2);l(an.arrDataName);var aq=[],at,au,ao;if(typeof aw.type==="string"){aq=aw.type.split(".");an.type=aq[0];if(aq.length>2){aq[1]=aq.slice(1).join(".");an.format=aq[1]}an.size=A[aw.type]}if(j&&f&&an.arrDataName.length>0){at=an.arrDataName;au=O[an.symbolName].dataType;l(au);an.arrIdx=[];ao=0;do{if(at[ao].charAt(at[ao].length-1)==="]"){l("yuhu");ap=at[ao].substring(0,at[ao].length-1).split("[");at[ao]=ap[0];an.arrIdx[ao+1]=parseInt(ap[1],10)}if(ao===at.length-1){break}au=am[au].subItems[at[ao]].dataType;l(au);l(at[ao]);ao++}while(ao<at.length);l(au);l(at[ao]);l(am[au].subItems[at[ao]]);try{if(aw.type===undefined){an.type=am[au].subItems[at[ao]].type}if(an.type==="STRING"){an.stringLength=am[au].subItems[at[ao]].stringLength;an.format=an.stringLength}else{if(typeof aw.format==="string"){an.format=aw.format}else{if(typeof aw.decPlaces==="number"){an.format=aw.decPlaces}else{if(typeof aw.dp==="number"){an.format=aw.dp}}}}an.arrayLength=am[au].subItems[at[ao]].arrayLength;an.arrayLength=am[au].subItems[at[ao]].arrayLength;an.arrayDataType=am[au].subItems[at[ao]].arrayDataType;an.dataType=am[au].subItems[at[ao]].dataType;an.itemSize=am[au].subItems[at[ao]].itemSize;an.size=am[au].subItems[at[ao]].size;an.bitOffset=am[au].subItems[at[ao]].bitOffset;an.offs=aw.offs;l(ao+","+an.arrIdx[ao+1]);if(an.arrIdx[ao+1]!==undefined&&an.type==="ARRAY"){an.type=am[au].subItems[at[ao]].arrayDataType;an.size=am[au].subItems[at[ao]].size}}catch(ar){l("TAME library error: A problem occured while reading a data type from the data type table!");l(ar);l(aw)}}else{if(j&&typeof aw.name==="string"){try{if(aw.type===undefined){an.type=O[aw.name].type}if(an.type==="STRING"){an.stringLength=O[aw.name].stringLength;an.format=an.stringLength}else{if(typeof aw.format==="string"){an.format=aw.format}else{if(typeof aw.decPlaces==="number"){an.format=aw.decPlaces}else{if(typeof aw.dp==="number"){an.format=aw.dp}}}}an.arrayLength=O[aw.name].arrayLength;an.arrayDataType=O[aw.name].arrayDataType;an.dataType=O[aw.name].dataType;if(typeof aw.type==="string"){an.size=A[aw.type]}else{an.size=O[aw.name].size}an.bitOffset=O[aw.name].bitOffset;an.offs=aw.offs}catch(ar){l("TAME library error: A problem occured while reading a data type from the symbol table!");l(ar);l(aw)}}else{l("TAME library error: Could not get the type of the item!");l(aw)}}l(an);return an}function X(){var ao;if(window.XMLHttpRequest){ao=new window.XMLHttpRequest()}else{try{ao=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(ap){try{ao=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(an){ao=null;l("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return ao}function u(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){l(e)}}e.send=function(){var an,ao;if(typeof this.reqDescr.id==="number"&&E[this.reqDescr.id]>0){l("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");E[this.reqDescr.id]++;if(E[this.reqDescr.id]<=Y.maxDropReq){return}E[this.reqDescr.id]=0}if(e.sync===true){ao=false}else{if(this.reqDescr.sync===true){ao=false}else{if(this.reqDescr.sync===false){ao=true}else{if(g.syncXmlHttp===true){ao=false}else{ao=true}}}}this.xmlHttpReq=X();an="<?xml version='1.0' encoding='utf-8'?>";an+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";an+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";an+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";an+="<soap:Body><q1:";an+=this.method;an+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";an+=g.amsNetId;an+="</netId><nPort xsi:type='xsd:int'>";an+=g.amsPort;an+="</nPort>";if(this.indexGroup!==undefined){an+="<indexGroup xsi:type='xsd:unsignedInt'>";an+=this.indexGroup;an+="</indexGroup>"}if(this.indexOffset!==undefined){an+="<indexOffset xsi:type='xsd:unsignedInt'>";an+=this.indexOffset;an+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){an+="<cbRdLen xsi:type='xsd:int'>";an+=this.reqDescr.readLength;an+="</cbRdLen>"}if(this.pData&&this.pData.length>0){an+="<pData xsi:type='xsd:base64Binary'>";an+=this.pData;an+="</pData>"}if(this.pwrData&&this.pwrData.length>0){an+="<pwrData xsi:type='xsd:base64Binary'>";an+=this.pwrData;an+="</pwrData>"}an+="</q1:";an+=this.method;an+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",g.serviceUrl,ao,g.serviceUser,g.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(ao===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){Y.parseResponse(e)}};this.xmlHttpReq.send(an)}else{this.xmlHttpReq.send(an);Y.parseResponse(e)}if(typeof this.reqDescr.id==="number"){E[this.reqDescr.id]=1}}};return e}function T(ap,ao,an,e){var aq;if(typeof ap.val==="string"){if(ao==="REAL"||ao==="LREAL"){aq=parseFloat(ap.val)}else{aq=parseInt(ap.val,10)}}else{if(typeof ap.val==="number"){aq=ap.val}else{l("TAME library error: Wrong variable type for a numeric variable in write request!");l("TAME library error: Variable type should be number or string, but is "+typeof ap.val);l(ap);aq=0}}if(isNaN(aq)){aq=0;l("TAME library error: Value of a numeric variable in write request is not a number.");l(ap)}if(Y.useCheckBounds===true){if(ao==="LREAL"){if(!isFinite(aq)){l("TAME library warning: Limit for LREAL value exceeded!");l("Upper limit: "+Number.MAX_VALUE);l("Lower limit: "+Number.MIN_VALUE);l("value: "+aq);l(ap)}}else{if(ao==="REAL"){if(aq>0){if(aq<1.175495e-38){l("TAME library warning: Lower limit for positive REAL value exceeded!");l("limit: 1.175495e-38");l("value: "+aq);l(ap);aq=1.175495e-38}else{if(aq>3.402823e+38){l("TAME library warning: Upper limit for positive REAL value exceeded!");l("limit: 3.402823e+38");l("value: "+aq);l(ap);aq=3.402823e+38}}}else{if(aq<0){if(aq>-1.175495e-38){l("TAME library warning: Upper limit for negative REAL value exceeded!");l("limit: -1.175495e-38");l("value: "+aq);l(ap);aq=-1.175495e-38}else{if(aq<-3.402823e+38){l("TAME library warning: Lower limit for negative REAL value exceeded!");l("limit: -3.402823e+38");l("value: "+aq);l(ap);aq=-3.402823e+38}}}}}else{if(aq<an){l("TAME library warning: Lower limit for numeric value exceeded!");l("type: "+ao);l("limit: "+an);l("value: "+aq);l(ap);aq=an}else{if(aq>e){l("TAME library warning: Upper limit for numeric value exceeded!");l("type: "+ao);l("limit: "+e);l("value: "+aq);l(ap);aq=e}}}}}return aq}function ag(ap){var e=[],aq,an,ao;if(typeof ap.type==="string"){e=ap.type.split(".");if(e.length>2){e[1]=e.slice(1).join(".")}}else{l("TAME library error: Could not get the type of the item!");l(ap)}return e}function J(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ae(aq,an){var e=[],ap=aq.toString(16),ao;while(ap.length<an*2){ap="0"+ap}for(ao=0;ao<an;ao++){e[(an-1)-ao]=((J(ap.charCodeAt(ao*2))*16)+J(ap.charCodeAt((ao*2)+1)))}return e}function s(an){var aq=0,au=0,ar,e,ap,at,ao;e=Math.abs(an);if(an!==0){for(ao=128;ao>-127;ao--){ap=e/Math.pow(2,ao);if(ap>=2){break}at=ao;ar=ap}at+=127;ar=ar.toString(2);for(ao=2;ao<25;ao++){aq<<=1;if(ar.charAt(ao)==="1"){aq+=1}}if(ar.charAt(25)==="1"){aq+=1}au=at;au<<=23;au+=aq;if(an<0){au+=2147483648}}return au}function D(at){var ao=0,av=0,ap={part1:0,part2:0},aw,ar,an,e,au,aq;aw=Math.abs(at);if(at!==0){for(aq=1024;aq>=-1023;aq--){ar=aw/Math.pow(2,aq);if(ar>=2){break}an=aq;au=ar}an+=1023;au=au.toString(2);for(aq=2;aq<22;aq++){ao<<=1;if(au.charAt(aq)==="1"){ao+=1}}if(au.charAt(aq)==="1"){e=true}aq++;for(aq;aq<54;aq++){av<<=1;if(au.charAt(aq)==="1"){av+=1}}ap.part1=an;ap.part1<<=20;ap.part1+=ao;if(at<0){ap.part1+=2147483648}ap.part2=av;if(e===true){ap.part2+=2147483648}}return ap}function K(ao,an){var e;switch(an){case"#d":case"#dd":e=ao*86400000;break;case"#h":case"#hh":e=ao*3600000;break;case"#m":case"#mm":e=ao*60000;break;case"#s":case"#ss":e=ao*1000;break;case"#ms":case"#msmsms":e=ao;break;default:e=ao;break}return e}function B(au,aw){var e=aw.split("#"),at=e.length,av=/:|\.|-|_/,ao=0,an=0,aq,ap,ar,ax;for(ap=1;ap<at;ap++){if(av.test(e[ap])===true){ax=true}}if(ax!==true){l("TAME library error: No separator ( : . - _ ) for TOD string found!");l("String: "+au);l("Format: "+aw);return 0}ar=au.split(av);for(ap=1;ap<at;ap++){switch(e[ap]){case"h":case"hh":aq=parseInt(ar[an],10)*3600000;an++;break;case"m":case"mm":aq=parseInt(ar[an],10)*60000;an++;break;case"s":case"ss":aq=parseInt(ar[an],10)*1000;an++;break;case"ms":case"msmsms":aq=parseInt(ar[an],10);an++;break;default:aq=0}ao+=aq}return ao}function p(at){var ar=n,ap=0,an="",aq,ao,e;while(ap<at.length){aq=at[ap++];ao=at[ap++];e=at[ap++];an=an+ar[aq>>2]+ar[((aq&3)<<4)|(ao>>4)]+(isNaN(ao)?"=":ar[(((ao&15)<<2)|(e>>6))])+((isNaN(ao)||isNaN(e))?"=":ar[e&63])}return an}function d(at,aq,ar,ap){var av=[],e,au,an,ao;if(at.val===undefined){switch(aq){case"STRING":at.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":at.val=new Date();break;default:at.val=0;break}l("TAME library warning: Value of a variable in write request is not defined!");l(at)}switch(aq){case"BOOL":if(at.val){av[0]=1}else{av[0]=0}break;case"BYTE":case"USINT":e=T(at,aq,0,255);av=ae(e,ap);break;case"SINT":e=T(at,aq,-128,127);if(e<0){e=e+256}av=ae(e,ap);break;case"WORD":case"UINT":e=T(at,aq,0,65535);av=ae(e,ap);break;case"INT":case"INT16":e=T(at,aq,-32768,32767);if(e<0){e=e+65536}av=ae(e,ap);break;case"INT1DP":at.val=Math.round(at.val*10);e=T(at,aq,-32768,32767);if(e<0){e=e+65536}av=ae(e,ap);break;case"DWORD":case"UDINT":e=T(at,aq,0,4294967295);av=ae(e,ap);break;case"DINT":e=T(at,aq,-2147483648,2147483647);if(e<0){e=e+4294967296}av=ae(e,ap);break;case"REAL":e=T(at,aq);e=s(e);av=ae(e,ap);break;case"LREAL":e=T(at,aq);e=D(e);av=ae(e.part2,4);av=av.concat(ae(e.part1,4));break;case"DATE":if(typeof at.val==="object"){at.val.setHours(0);at.val.setMinutes(0);at.val.setSeconds(0);e=at.val.getTime()/1000-at.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DATE variable in write request is not a date object!");l(at)}av=ae(e,ap);break;case"DT":case"DATE_AND_TIME":if(typeof at.val==="object"){e=at.val.getTime()/1000-at.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DT variable in write request is not a date object!");l(at)}av=ae(e,ap);break;case"TOD":case"TIME_OF_DAY":if(typeof at.val==="object"){at.val.setYear(1970);at.val.setMonth(0);at.val.setDate(1);e=at.val.getTime()-at.val.getTimezoneOffset()*60000}else{if(typeof at.val==="string"){if(ar===""||ar===undefined){ar="#hh#:#mm";l("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");l(at)}e=B(at.val,ar)}else{l("TAME library error: TOD value in write request is wether a date object nor a string!");l(at)}}av=ae(e,ap);break;case"STRING":au=(ar===undefined)?A.STRING:parseInt(ar,10);if(ak(au)){an=au<at.val.length?au:at.val.length;for(ao=0;ao<an;ao++){av[ao]=at.val.charCodeAt(ao)}for(ao;ao<au;ao++){av[ao]=0}av[ao]=0}break;case"TIME":e=parseInt(at.val,10);if(isNaN(e)){l("TAME library warning: Value of a TIME variable in write request is not defined!");l(at);e=0}e=K(e,ar);if(e<0){e=0;l("TAME library warning: Lower limit for TIME variable in write request exceeded!)");l("value: "+at.val+ar);l(at)}else{if(e>4294967295){e=4294967295;l("TAME library warning: Upper limit for TIME variable in write request exceeded!)");l("value: "+at.val+ar);l(at)}}av=ae(e,ap);break;case"EndStruct":break;default:l("TAME library error: Unknown data type in write request : "+aq);break}return av}function t(an){var e=an.toString(16);if((e.length%2)!==0){e="0"+e}return e}function i(an,e){e=(isNaN(e))?0:e;var ao=an.toString(10);while(ao.length<e){ao="0"+ao}return ao}function al(at,ar){var e=ar.split("#"),aq=e.length,an="",ap,ao;for(ao=1;ao<aq;ao++){switch(e[ao]){case"D":ap=at.getDate();break;case"DD":ap=at.getDate();ap=i(ap,2);break;case"WD":ap=at.getDay();break;case"WKD":ap=Y.dateNames.weekdShort[at.getDay()];break;case"WEEKDAY":ap=Y.dateNames.weekdLong[at.getDay()];break;case"M":ap=at.getMonth()+1;break;case"MM":ap=at.getMonth()+1;ap=i(ap,2);break;case"MON":ap=Y.dateNames.monthsShort[at.getMonth()];break;case"MONTH":ap=Y.dateNames.monthsLong[at.getMonth()];break;case"YY":ap=at.getYear();while(ap>100){ap-=100}break;case"YYYY":ap=at.getFullYear();break;case"h":ap=at.getHours();break;case"hh":ap=at.getHours();ap=i(ap,2);break;case"m":ap=at.getMinutes();break;case"mm":ap=at.getMinutes();ap=i(ap,2);break;case"s":ap=at.getSeconds();break;case"ss":ap=at.getSeconds();ap=i(ap,2);break;case"ms":ap=at.getMilliseconds();break;case"msmsms":ap=at.getMilliseconds();ap=i(ap,3);break;default:ap=e[ao];break}an=an+ap}return an}function I(at,ar){var e=ar.split("#"),aq=e.length,an="",ap,ao;for(ao=1;ao<aq;ao++){switch(e[ao]){case"d":if(aq<=2){ap=at/86400000}else{ap=Math.floor(at/86400000);at=at%86400000}break;case"dd":if(aq<=2){ap=at/86400000}else{ap=Math.floor(at/86400000);at=at%86400000}ap=i(ap,2);break;case"h":if(aq<=2){ap=at/3600000}else{ap=Math.floor(at/3600000);at=at%3600000}break;case"hh":if(aq<=2){ap=at/3600000}else{ap=Math.floor(at/3600000);at=at%3600000}ap=i(ap,2);break;case"m":if(aq<=2){ap=at/60000}else{ap=Math.floor(at/60000);at=at%60000}break;case"mm":if(aq<=2){ap=at/60000}else{ap=Math.floor(at/60000);at=at%60000}ap=i(ap,2);break;case"s":if(aq<=2){ap=at/1000}else{ap=Math.floor(at/1000);at=at%1000}break;case"ss":if(aq<=2){ap=at/1000}else{ap=Math.floor(at/1000);at=at%1000}ap=i(ap,2);break;case"ms":ap=at;break;case"msmsms":ap=at;ap=i(ap,3);break;default:ap=e[ao];break}an=an+ap}return an}function R(an){var e=t(an.charCodeAt(0));return parseInt(e,16)}function af(e){var an=R(e);if(an>127){an=an-256}return an}function N(an){var e=t(an.charCodeAt(1));e+=t(an.charCodeAt(0));return parseInt(e,16)}function M(e){var an=N(e);if(an>32767){an=an-65536}return an}function G(an){var e=t(an.charCodeAt(3));e+=t(an.charCodeAt(2));e+=t(an.charCodeAt(1));e+=t(an.charCodeAt(0));return parseInt(e,16)}function P(e){var an=G(e);if(an>2147483647){an=an-4294967296}return an}function W(e,ao){var an=G(e);if(ao===undefined){return an}return(I(an,ao))}function o(e,ao){var an=new Date(G(e));an=new Date(an.getTime()+an.getTimezoneOffset()*60000);if(ao===undefined){return an}return(al(an,ao))}function ad(an,ao){var e=new Date(G(an)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(ao===undefined){return e}return(al(e,ao))}function r(ao){var aq=1,at=0.5,an=G(ao),e,ar,ap;if(an===0){return 0}e=((an>>>31)===1)?"-":"+";an<<=1;ar=(an>>>24)-127;an<<=8;for(ap=1;ap<=23;ap++){aq+=an<0?at:0;an<<=1;at/=2}return parseFloat(e+(aq*Math.pow(2,ar)))}function F(ao){var an=G(ao.substring(4,8)),ar=G(ao.substring(0,4)),aq=12,ap=1,au=0.5,e,at;if(an===0&&ar===0){return 0}e=((an>>>31)===1)?"-":"+";an<<=1;at=(an>>>21)-1023;an<<=11;while(aq<32){ap+=an<0?au:0;an<<=1;au/=2;aq++}if((ar>>>31)===1){ap+=au;ar<<=1;au/=2}while(aq<64){ap+=ar<0?au:0;ar<<=1;au/=2;aq++}return parseFloat(e+(ap*Math.pow(2,at)))}function ab(e){return e.split(String.fromCharCode(0))[0]}function Q(ap){var aq=q,at=0,e="",ar,ao,an,ax,aw,av,au;ap=ap.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{ax=aq[ap.charAt(at++)];aw=aq[ap.charAt(at++)];av=aq[ap.charAt(at++)];au=aq[ap.charAt(at++)];ar=(ax<<2)|(aw>>4);ao=((aw&15)<<4)|(av>>2);an=((av&3)<<6)|au;e+=String.fromCharCode(ar);if(av!==64){e+=String.fromCharCode(ao)}if(au!==64){e+=String.fromCharCode(an)}}while(at<ap.length);return e}function U(an,e,ap){var ao;switch(e){case"BOOL":ao=(an.charCodeAt(0)!="0");break;case"BYTE":case"USINT":ao=R(an);break;case"SINT":ao=af(an);break;case"WORD":case"UINT":ao=N(an);break;case"INT":case"INT16":ao=M(an);break;case"INT1DP":ao=((M(an))/10).toFixed(1);break;case"DWORD":case"UDINT":ao=G(an);break;case"DINT":ao=P(an);break;case"REAL":ao=r(an);if(ap!==undefined){ao=ao.toFixed(parseInt(ap,10))}break;case"LREAL":ao=F(an);if(ap!==undefined){ao=ao.toFixed(parseInt(ap,10))}break;case"STRING":ao=ab(an);break;case"TOD":case"TIME_OF_DAY":ao=o(an,ap);break;case"TIME":ao=W(an,ap);break;case"DT":case"DATE":case"DATE_AND_TIME":ao=ad(an,ap);break;case"EndStruct":break;default:l("TAME library error: Unknown data type at parsing read request: "+e);break}return ao}function w(aG){var an,ay=aG.reqDescr.items,aw=[],az=0,aD,ap,aq,aF,au,aB,av,aE,ao,aA,ax,ar,at;try{an=aG.xmlHttpReq.responseXML.documentElement;ap=Q(an.getElementsByTagName("ppData")[0].firstChild.data);for(ax=0,ar=ay.length;ax<ar;ax++){aD=ay[ax];aw=ag(aD);ao=aw[0];aA=aw[1];aB=A[ao];switch(ao){case"STRING":if(aA!==undefined){au=parseInt(aA,10)}aB=(ak(au)?au:aB)+1;break;case"EndStruct":aB=aD.val;break}av=aB<a?aB:a;if(aG.reqDescr.seq!==true){at=k(aG.reqDescr);az=aD.addr-at}else{if(aG.reqDescr.calcAlignment===true&&av>1&&ao!=="EndStruct"&&ao!=="STRING"&&az>0){aE=az%av;if(aE>0){az+=av-aE}}}aq=ap.substr(az,aB);aF=U(aq,ao,aA);if(ao!=="EndStruct"){z(aD.jvar,aF,aG.reqDescr.dataObj,aD.prefix,aD.suffix)}if(aG.reqDescr.seq===true){az+=aB}}}catch(aC){l("TAME library error: Parsing of Read Request failed:"+aC);l(aD);return}}function c(aN){var an,aB=aN.reqDescr.items,ay=[],aF=0,ap=0,aD=window,aK=0,aJ,ar,at,aM,aH,aq,aG,az,aw,au,aC,aE,ax,av;function ao(){var aO,e;if(aq==="STRING"){if(aG!==undefined){aO=parseInt(aG,10)}else{if(typeof aA.stringLength==="number"){aO=aA.stringLength}}aH=(ak(aO)?aO:aH)+1}e=at.substr(ap,aH);aM=U(e,aq,aG);z(aC,aM,aD,aJ.prefix,aJ.suffix);ap+=aH}function aL(){var aP,aO,aT,aS,aQ,aR;function e(){var aV,aU;if(a>1&&aq!=="STRING"&&aq!=="EndStruct"){aV=aH<a?aH:a;if(aV>1&&ap>0){aU=ap%aV;if(aU>0){ap+=aV-aU}}if(aV>aK){aK=aV}}}for(aR in aJ.def){if(aJ.def.hasOwnProperty(aR)){aO=aJ.def[aR].split(".");if(aO[0]==="ARRAY"){aT=parseInt(aO[1],10);aS=aO.length-1;for(aP=0;aP<aT;aP++){aq=aO[2];if(aO[aS]==="SP"){aC=aR+aP;if(aS>=4){aG=aO.slice(3,-1).join(".")}}else{aC=aR+"."+aP;if(aS>=3){aG=aO.slice(3).join(".")}}if(aE!==null){aC=aE+"."+aC}aH=A[aq];e();ao()}}else{if(aE!==null){aC=aE+"."+aR}else{aC=aR}aq=aO[0];aG=aO.slice(1).join(".");aH=A[aq];e();ao()}}}if(a>1&&aK>1&&aq!=="STRING"&&aq!=="EndStruct"){if(aK>a){aK=a}aQ=ap%aK;if(aQ>0){ap+=aK-aQ}}}try{an=aN.xmlHttpReq.responseXML.documentElement;ar=Q(an.getElementsByTagName("ppRdData")[0].firstChild.data);for(az=0,aw=aB.length;az<aw;az++){at=ar.substr(aF,4);au=U(at,"DWORD");if(au!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+au);l(aB[az])}aF+=4}for(az=0;az<aw;az++){aJ=aB[az];var aA=ai(aJ);l("p: "+aA.type);aq=aA.type;aG=aA.format;av=aA.size;aE=null;at=ar.substr(aF,av);switch(aq){case"ARRAY":aD=z(aJ.jvar);ap=0;ax=aA.arrayLength;if(aA.arrayDataType==="USER"){for(aE=0;aE<ax;aE++){aL()}}else{aq=aA.arrayDataType;aH=A[aq];for(aE=0;aE<ax;aE++){aC=aE;ao()}}break;case"USER":aD=z(aJ.jvar);ap=0;aL();break;default:aD=window;aM=U(at,aq,aG);z(aJ.jvar,aM,aD,aJ.prefix,aJ.suffix)}aF+=av}}catch(aI){l("TAME library error: Parsing of SumReadRequest failed:"+aI);l(aJ);return}}function x(aF){var an,ax=aF.reqDescr.items,av=[],az=0,ao=0,ay=window,aD,aq,ar,aE,aB,ap,aA,aw,au,at;try{an=aF.xmlHttpReq.responseXML.documentElement;aq=Q(an.getElementsByTagName("ppRdData")[0].firstChild.data);for(aw=0,au=ax.length;aw<au;aw++){ar=aq.substr(az,4);at=U(ar,"DWORD");if(at!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+at);l(ax[aw])}az+=4}}catch(aC){l("TAME library error: Parsing of SumWriteRequest failed:"+aC);l(aD);return}}function ah(ap){var an;try{an=ap.xmlHttpReq.responseXML.documentElement;Y.adsState=parseInt(an.getElementsByTagName("pAdsState")[0].firstChild.data,10);Y.adsStateTxt=S[Y.adsState];Y.deviceState=parseInt(an.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(ao){l("TAME library error: Parsing of ADS Read State Request failed:"+ao);return}}function L(at,ar,ap){var ao={},aq,e;var an=ai(ap);e=A[ar];switch(ar){case"STRING":if(ak(ap.strlen)){ar+="."+ap.strlen;e=ap.strlen}else{if(typeof an.stringLength==="number"){e=an.stringLength;ar+="."+e}else{l("TAME library error: Could not get the length of the string for this request!");l(ap)}}e++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ap.format==="string"){ar+="."+ap.format}break;case"REAL":case"LREAL":if(typeof ap.decPlaces==="number"){ar+="."+ap.decPlaces}else{if(typeof ap.dp==="number"){ar+="."+ap.dp}}break}ao={addr:ap.addr,symbolName:an.symbolName,arrDataName:an.arrDataName,id:ap.id,oc:ap.oc,ocd:ap.ocd,readLength:e,debug:ap.debug,sync:ap.sync,offs:ap.offs,seq:true,items:[{val:ap.val,jvar:ap.jvar,type:ar,prefix:ap.prefix,suffix:ap.suffix}]};if(at==="Write"){Y.writeReq(ao)}else{Y.readReq(ao)}}function H(ap,aq,ao){var ar={},aE={},ay,an,aG=0,aH=0,aF=0,aI,e=[],aK,au,ax=0,az,av,aJ=0,aA=0,aM,aw,aL,aC;var aB=ai(ao);if(ap==="Write"&&typeof ao.val==="object"){aE=ao.val}else{if(typeof ao.jvar==="string"){aE=z(ao.jvar)}else{l("TAME library error: No data object for this "+ap+"-Request defined!")}}if(typeof ao.arrlen==="number"){ay=ao.arrlen}else{if(aB.arrayLength!==undefined){ay=aB.arrayLength}else{l("TAME library error: Can't get the array length for this request!");l(ao)}}if(typeof ao.item==="number"&&!isNaN(ao.item)&&ap==="Write"){aL=true;if(ao.item<0||ao.item>ay-1){l('TAME library error: Wrong value for "item"!');l("item: "+ao.item);l("Last array index: "+(ay-1))}}function at(){var aN;if(typeof ao.def==="string"){ao.def=z(ao.def)}else{if(typeof ao.def!=="object"){l("TAME library error: No structure definition found!")}}for(aN in ao.def){if(ao.def.hasOwnProperty(aN)){e=ao.def[aN].split(".");if(e[0]==="ARRAY"){aK=parseInt(e[1],10);e.shift();e.shift()}else{aK=1}for(aH=0;aH<aK;aH++){if(e[0]==="STRING"){if(typeof e[1]==="string"){az=parseInt(e[1],10)}av=(ak(az)?az:A[e[0]])+1}else{av=A[e[0]]}if(a>1&&av>1&&e[0]!=="STRING"&&ax>0){aM=ax%av;if(aM>0){ax+=av-aM}}ax+=av}if(a>1&&av>aJ&&e[0]!=="STRING"){aJ=av}}}if(a>1&&aJ>1&&e[0]!=="STRING"){if(aJ>a){aJ=a}aM=ax%aJ;if(aM>0){aA=aJ-aM;ax+=aA}}if(aL){an=ax*ao.item;ay=1}ar={addr:ao.addr,symbolName:aB.symbolName,arrDataName:aB.arrDataName,addrOffset:an,id:ao.id,oc:ao.oc,ocd:ao.ocd,debug:ao.debug,readLength:ax*ay,seq:true,calcAlignment:true,dataObj:aE,sync:ao.sync,offs:ao.offs,items:[]};for(aH=0;aH<ay;aH++){for(aN in ao.def){if(ao.def.hasOwnProperty(aN)){e=ao.def[aN].split(".");if(e[0]==="ARRAY"){aK=parseInt(e[1],10);au=e.length-1;for(aF=0;aF<aK;aF++){if(e[au]==="SP"){ar.items[aG]={jvar:aH+"."+aN+aF};if(au===4){ar.items[aG].type=e[2]+"."+e[3]}else{ar.items[aG].type=e[2]}}else{ar.items[aG]={jvar:aH+"."+aN+"."+aF};if(au===3){ar.items[aG].type=e[2]+"."+e[3]}else{ar.items[aG].type=e[2]}}if(ap==="Write"){if(aL){if(e[au]==="SP"){ar.items[aG].val=aE[ao.item][aN+aF]}else{ar.items[aG].val=aE[ao.item][aN][aF]}}else{if(e[au]==="SP"){ar.items[aG].val=aE[aH][aN+aF]}else{ar.items[aG].val=aE[aH][aN][aF]}}}aG++}}else{ar.items[aG]={jvar:aH+"."+aN,type:ao.def[aN]};if(ap==="Write"){if(aL){ar.items[aG].val=aE[ao.item][aN]}else{ar.items[aG].val=aE[aH][aN]}}aG++}}}if(a>1){ar.items[aG]={type:"EndStruct",val:aA};aG++}}}function aD(){aI=A[aq];switch(aq){case"STRING":if(ak(ao.strlen)){aq+="."+ao.strlen;aI=ao.strlen}else{if(typeof aB.stringLength==="number"){aI=aB.stringLength;aq+="."+aI}else{l("TAME library error: Could not get the length of the string for this request!");l(ao)}}aI++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ao.format==="string"){aq+="."+ao.format}break;case"REAL":case"LREAL":if(typeof ao.decPlaces==="number"){aq+="."+ao.decPlaces}else{if(typeof ao.dp==="number"){aq+="."+ao.dp}}break}if(aL){an=ao.item*aI;ay=1}ar={addr:ao.addr,symbolName:aB.symbolName,arrDataName:aB.arrDataName,addrOffset:an,id:ao.id,oc:ao.oc,ocd:ao.ocd,readLength:aI*ay,debug:ao.debug,seq:true,dataObj:aE,items:[]};for(aH=0;aH<ay;aH++){ar.items[aH]={jvar:aH,type:aq};if(ap==="Write"){if(aL){ar.items[aH].val=aE[ao.item]}else{ar.items[aH].val=aE[aH]}}}}if(aq==="STRUCT"){at()}else{aD()}if(ap==="Write"){Y.writeReq(ar)}else{Y.readReq(ar)}}function aa(e,aw){var at={},an={},ax=[],aq=0,av,ap,ar,au;var ao=ai(aw);if(e==="Write"&&typeof aw.val==="object"){an=aw.val}else{if(typeof aw.jvar==="string"){an=z(aw.jvar)}else{l("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof aw.def==="string"){aw.def=z(aw.def)}else{if(typeof aw.def!=="object"){l("TAME library error: No structure defininition found!")}}at={addr:aw.addr,symbolName:ao.symbolName,arrDataName:ao.arrDataName,id:aw.id,oc:aw.oc,ocd:aw.ocd,debug:aw.debug,seq:true,calcAlignment:true,dataObj:an,sync:aw.sync,offs:aw.offs,items:[]};for(ar in aw.def){if(aw.def.hasOwnProperty(ar)){ax=aw.def[ar].split(".");if(ax[0]==="ARRAY"){ap=parseInt(ax[1],10);av=ax.length-1;for(au=0;au<ap;au++){if(ax[av]==="SP"){at.items[aq]={jvar:ar+au};if(av===4){at.items[aq].type=ax[2]+"."+ax[3]}else{at.items[aq].type=ax[2]}}else{at.items[aq]={jvar:ar+"."+au};if(av===3){at.items[aq].type=ax[2]+"."+ax[3]}else{at.items[aq].type=ax[2]}}if(e==="Write"){if(ax[av]==="SP"){at.items[aq].val=an[ar+au]}else{at.items[aq].val=an[ar][au]}}aq++}}else{at.items[aq]={jvar:ar,type:aw.def[ar]};if(e==="Write"){at.items[aq].val=an[ar]}aq++}}}if(e==="Write"){Y.writeReq(at)}else{Y.readReq(at)}}this.writeReq=function(ap){var ar=ap.items,az={},e=[],av=[],aC=[],au,ay,ao,at,an,aA,aw,aB,aq,ax;if(typeof ap.name==="string"){ap.name=ap.name.toUpperCase()}for(ax=0,ao=ar.length;ax<ao;ax++){aB=ar[ax];av=ag(aB);au=av[0];ay=av[1];if(isNaN(A[au])){l("TAME library error: Could not get the length of the data type: "+au);l("TAME library error: Probably wrong type definition. Please check the manual.");l(ap);return}at=(A[au]<a)?A[au]:a;if(ap.calcAlignment===true&&at>1&&au!=="STRING"&&au!=="EndStruct"&&e.length>0){aw=e.length%at;if(aw>0){aA=at-aw;for(aq=1;aq<=aA;aq++){e.push(0)}}}if(au==="EndStruct"){for(aq=1;aq<=aB.val;aq++){e.push(0)}}else{aC=d(aB,au,ay,A[au]);e=e.concat(aC)}}if(e&&e.length>0){e=p(e)}az={method:"Write",indexGroup:y(ap),indexOffset:k(ap),pData:e,reqDescr:ap};u(az).send()};this.readReq=function(ao){var ax={},ap=ao.items,ar=[],ay,aw,aq,e,at,au,az,av,an;if(typeof ao.readLength!=="number"){ao.readLength=0;for(av=0,e=ap.length;av<e;av++){ay=ap[av];ar=ag(ay);aq=ar[0];aw=ar[1];if(isNaN(A[aq])){l("TAME library error: Could not get the length of the data type: "+aq);l("TAME library error: Probably wrong type definition. Please check the manual.");l(ao);return}if(aq==="STRING"){if(typeof aw==="string"){az=parseInt(aw,10)}au=(ak(az)?az:A[aq])+1}else{au=A[aq]}if(ao.seq===true){if(ao.calcAlignment===true&&au>1&&aq!=="EndStruct"&&aq!=="STRING"&&ao.readLength>0){at=ao.readLength%au;if(at>0){ao.readLength+=au-at}}ao.readLength+=au}else{an=k(ao);ao.readLength=au+ay.addr-an}}}ax={method:"Read",indexGroup:y(ao),indexOffset:k(ao),reqDescr:ao};u(ax).send()};this.sumReadReq=function(ap){var ay={},ar=ap.items,av=[],aA=[],aB=[],ao=ar.length,aq={},au,ax,az,aw,at,e;ap.readLength=ao*4;for(aw=0;aw<ao;aw++){az=ar[aw];var an=ai(az);at=an.size;ap.readLength+=at;aq.val=y(an);aB=d(aq,"UDINT",ax,4);aA=aA.concat(aB);aq.val=k(an);aB=d(aq,"UDINT",ax,4);aA=aA.concat(aB);aq.val=at;aB=d(aq,"UDINT",ax,4);aA=aA.concat(aB)}if(aA.length>0){e=p(aA)}ay={method:"ReadWrite",indexGroup:m.SumRd,indexOffset:ar.length,pwrData:e,reqDescr:ap};u(ay).send()};this.sumWriteReq=function(ap){var aJ={},ax=ap.items,at=[],an=[],av=[],aq=ax.length,aG={},aE=0,ao,aB,aD,au,aC,aI,aA,az,ar,aF,e;function ay(){var aK;aC=A[ao];if(ao==="STRING"){if(aB!==undefined){aK=parseInt(aB,10)}else{if(typeof aw.stringLength==="number"){aK=aw.stringLength}}aB=(ak(aK)?aK:aC)}}function aH(){var aN,aS,aK,aO,aQ,aL,aM=[];function aR(){var aU,aT;if(a>1&&ao!=="STRING"&&ao!=="EndStruct"){aU=aC<a?aC:a;if(aU>1&&aM.length>0){aQ=aM.length%aU;if(aQ>0){e=aU-aQ;for(aT=1;aT<=e;aT++){aM.push(0)}}}if(aU>aE){aE=aU}}}for(aL in aD.def){if(aD.def.hasOwnProperty(aL)){try{aS=aD.def[aL].split(".");if(aS[0]==="ARRAY"){aK=parseInt(aS[1],10);aO=aS.length-1;for(aN=0;aN<aK;aN++){ao=aS[2];if(aS[aO]==="SP"){if(aO>=4){aB=aS.slice(3,-1).join(".")}}else{if(aO>=3){aB=aS.slice(3).join(".")}}if(aA!==null){if(aS[aO]==="SP"){aG.val=aD.val[aA][aL+aN]}else{aG.val=aD.val[aA][aL][aN]}}else{aG.val=aD.val[aL][aN]}ay();aR();av=d(aG,ao,aB,aC);aM=aM.concat(av)}}else{if(aA!==null){aG.val=aD.val[aA][aL]}else{aG.val=aD.val[aL]}ao=aS[0];aB=aS.slice(1).join(".");ay();aR();av=d(aG,ao,aB,aC);aM=aM.concat(av)}}catch(aP){l("TAME library error: Could not set values for a structure in SumWriteReq: "+aP);l(aD)}}}if(a>1&&aE>1&&aS[0]!=="STRING"&&aS[0]!=="EndStruct"){aQ=aM.length%aE;if(aQ>0){e=aE-aQ;for(az=1;az<=e;az++){aM.push(0)}}}an=an.concat(aM)}ap.readLength=aq*4;for(au=0;au<aq;au++){aD=ax[au];var aw=ai(aD);ao=aw.type;aB=aw.format;aC=aw.size;aG.val=y(aw);av=d(aG,"UDINT",aB,4);an=an.concat(av);aG.val=k(aw);av=d(aG,"UDINT",aB,4);an=an.concat(av);aG.val=aC;av=d(aG,"UDINT",aB,4);an=an.concat(av)}for(au=0;au<aq;au++){aD=ax[au];aw=ai(aD);ao=aw.type;aB=aw.format;aC=aw.size;aA=null;switch(ao){case"ARRAY":ar=parseInt(aw.arrayLength,10);if(ar!==aD.val.length){l("TAME library error: Array length in JS differs from the length in the PLC!");l("Length in JS: "+aD.val.length);l("Length in PLC: "+ar);l(aD);return}if(aw.arrayDataType==="USER"){for(aA=0;aA<ar;aA++){aH()}}else{ao=aw.arrayDataType;if(ao==="STRING"){aB=aw.stringLength}else{aC=aw.itemSize}for(aA=0;aA<ar;aA++){aG.val=aD.val[aA];av=d(aG,ao,aB,aC);an=an.concat(av)}}break;case"USER":aH();break;default:if(ao==="STRING"){aB=aw.stringLength}else{aC=aw.size}av=d(aD,ao,aB,aC);an=an.concat(av)}}if(an.length>0){aI=p(an)}aJ={method:"ReadWrite",indexGroup:m.SumWr,indexOffset:ax.length,pwrData:aI,reqDescr:ap};u(aJ).send()};this.readAdsState=function(e){var an={method:"ReadState",reqDescr:e};u(an).send()};this.logSymbols=function(){l(O)};this.logDataTypes=function(){l(am)};this.getSymbolsAsJSON=function(){var ao;if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{ao=JSON.stringify(O);return ao}catch(an){l("TAME library error: Could not convert the Symbol Table to JSON:"+an)}}};this.setSymbolsFromJSON=function(ao){if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{O=JSON.parse(ao)}catch(an){l("TAME library error: Could not create the Symbol Table from JSON:"+an);return}j=true;l("TAME library info: Symbol Table successfully created from JSON data.")}};this.parseResponse=function(at){var ao,ar,an;if(typeof at.reqDescr.id==="number"){E[at.reqDescr.id]=0}if(at.xmlHttpReq.responseXML===null){l('TAME library error: Request contains no XML data. Object "responseXML" is null.');l('TAME library error: This is the "responseText":');l(at.xmlHttpReq.responseText)}try{ao=at.xmlHttpReq.responseXML.documentElement}catch(aq){l("TAME library error: No XML data in server response:"+aq);return}try{an=ao.getElementsByTagName("faultstring")[0].firstChild.data;try{ar=ao.getElementsByTagName("errorcode")[0].firstChild.data}catch(aq){ar="-"}l("TAME library error: Message from server:  "+an+" ("+ar+")");return}catch(ap){ar=0}if(typeof ao.normalize==="function"){ao.normalize()}if(at.method==="ReadState"){ah(at)}else{if(at.method==="Read"||at.method==="ReadWrite"){switch(at.indexGroup){case m.UploadInfo:V(at);break;case m.Upload:ac(at);break;case m.SumRd:c(at);break;case m.SumWr:x(at);break;default:w(at)}}}if(typeof at.reqDescr.oc==="function"){if(typeof at.reqDescr.ocd==="number"){window.setTimeout(at.reqDescr.oc,at.reqDescr.ocd)}else{at.reqDescr.oc()}}};this.writeBool=function(e){L("Write","BOOL",e)};this.writeByte=function(e){L("Write","BYTE",e)};this.writeUsint=function(e){L("Write","USINT",e)};this.writeSint=function(e){L("Write","SINT",e)};this.writeWord=function(e){L("Write","WORD",e)};this.writeUint=function(e){L("Write","UINT",e)};this.writeInt=function(e){L("Write","INT",e)};this.writeInt1Dp=function(e){L("Write","INT1DP",e)};this.writeDword=function(e){L("Write","DWORD",e)};this.writeUdint=function(e){L("Write","UDINT",e)};this.writeDint=function(e){L("Write","DINT",e)};this.writeReal=function(e){L("Write","REAL",e)};this.writeLreal=function(e){L("Write","LREAL",e)};this.writeString=function(e){L("Write","STRING",e)};this.writeTime=function(e){L("Write","TIME",e)};this.writeTod=function(e){L("Write","TOD",e)};this.writeDate=function(e){L("Write","DATE",e)};this.writeDt=function(e){L("Write","DT",e)};this.readBool=function(e){L("Read","BOOL",e)};this.readByte=function(e){L("Read","BYTE",e)};this.readUsint=function(e){L("Read","USINT",e)};this.readSint=function(e){L("Read","SINT",e)};this.readWord=function(e){L("Read","WORD",e)};this.readUint=function(e){L("Read","UINT",e)};this.readInt=function(e){L("Read","INT",e)};this.readInt1Dp=function(e){L("Read","INT1DP",e)};this.readDword=function(e){L("Read","DWORD",e)};this.readUdint=function(e){L("Read","UDINT",e)};this.readDint=function(e){L("Read","DINT",e)};this.readReal=function(e){L("Read","REAL",e)};this.readLreal=function(e){L("Read","LREAL",e)};this.readString=function(e){L("Read","STRING",e)};this.readTime=function(e){L("Read","TIME",e)};this.readTod=function(e){L("Read","TOD",e)};this.readDate=function(e){L("Read","DATE",e)};this.readDt=function(e){L("Read","DT",e)};this.writeStruct=function(e){aa("Write",e)};this.readStruct=function(e){aa("Read",e)};this.writeArrayOfBool=function(e){H("Write","BOOL",e)};this.writeArrayOfByte=function(e){H("Write","BYTE",e)};this.writeArrayOfUsint=function(e){H("Write","USINT",e)};this.writeArrayOfSint=function(e){H("Write","SINT",e)};this.writeArrayOfWord=function(e){H("Write","WORD",e)};this.writeArrayOfUint=function(e){H("Write","UINT",e)};this.writeArrayOfInt=function(e){H("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){H("Write","INT1DP",e)};this.writeArrayOfDword=function(e){H("Write","DWORD",e)};this.writeArrayOfUdint=function(e){H("Write","UDINT",e)};this.writeArrayOfDint=function(e){H("Write","DINT",e)};this.writeArrayOfReal=function(e){H("Write","REAL",e)};this.writeArrayOfLreal=function(e){H("Write","LREAL",e)};this.writeArrayOfString=function(e){H("Write","STRING",e)};this.writeArrayOfTime=function(e){H("Write","TIME",e)};this.writeArrayOfTod=function(e){H("Write","TOD",e)};this.writeArrayOfDate=function(e){H("Write","DATE",e)};this.writeArrayOfDt=function(e){H("Write","DT",e)};this.writeArrayOfStruct=function(e){H("Write","STRUCT",e)};this.readArrayOfBool=function(e){H("Read","BOOL",e)};this.readArrayOfByte=function(e){H("Read","BYTE",e)};this.readArrayOfUsint=function(e){H("Read","USINT",e)};this.readArrayOfSint=function(e){H("Read","SINT",e)};this.readArrayOfWord=function(e){H("Read","WORD",e)};this.readArrayOfUint=function(e){H("Read","UINT",e)};this.readArrayOfInt=function(e){H("Read","INT",e)};this.readArrayOfInt1Dp=function(e){H("Read","INT1DP",e)};this.readArrayOfDword=function(e){H("Read","DWORD",e)};this.readArrayOfUdint=function(e){H("Read","UDINT",e)};this.readArrayOfDint=function(e){H("Read","DINT",e)};this.readArrayOfReal=function(e){H("Read","REAL",e)};this.readArrayOfLreal=function(e){H("Read","LREAL",e)};this.readArrayOfString=function(e){H("Read","STRING",e)};this.readArrayOfTime=function(e){H("Read","TIME",e)};this.readArrayOfTod=function(e){H("Read","TOD",e)};this.readArrayOfDate=function(e){H("Read","DATE",e)};this.readArrayOfDt=function(e){H("Read","DT",e)};this.readArrayOfStruct=function(e){H("Read","STRUCT",e)};function Z(){var e={method:"Read",sync:true,indexGroup:m.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};u(e).send()}function V(at){var an,ao,au,aq,ap;try{an=at.xmlHttpReq.responseXML.documentElement;ao=Q(an.getElementsByTagName("ppData")[0].firstChild.data);au=ao.substr(0,4);b=U(au,"DWORD");au=ao.substr(4,4);v=U(au,"DWORD")}catch(ar){l("TAME library error: Parsing of UploadInfo failed:"+ar);return}ap={method:"Read",sync:true,indexGroup:m.Upload,indexOffset:0,reqDescr:{readLength:v}};u(ap).send()}function ac(aF){var an,ax=0,aC=4,az=8,av=12,ar=30,aq,at,aE,aw,ay,ao,aD,au,ap,aB;try{an=aF.xmlHttpReq.responseXML.documentElement;aq=Q(an.getElementsByTagName("ppData")[0].firstChild.data);for(aw=0;aw<b;aw++){at=aq.substr(ax,4);ay=U(at,"DWORD");ao=aq.substring(ax+ar,(ax+ay)).split(String.fromCharCode(0));name=ao[0].toUpperCase();O[name]={typeString:ao[1],indexGroup:U(aq.substr(ax+aC,4),"DWORD"),indexOffset:U(aq.substr(ax+az,4),"DWORD"),size:U(aq.substr(ax+av,4),"DWORD")};aD=ao[1].split(" ");if(aD[0]==="ARRAY"){O[name].type=aD[0];au=aD[1].substring(1,aD[1].length-1);au=au.split("..");au=parseInt(au[1],10)-parseInt(au[0],10)+1;O[name].arrayLength=au;ap=aD[3].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);O[name].fullType=aD[0]+"."+au+"."+ap[0]+"."+ap[1];O[name].stringLength=parseInt(ap[1],10)}else{O[name].fullType=aD[0]+"."+au+"."+ap[0]}O[name].itemSize=O[name].size/au;O[name].arrayDataType="USER";for(aB in A){if(A.hasOwnProperty(aB)){if(ap[0]===aB){O[name].arrayDataType=ap[0]}}}if(O[name].arrayDataType==="USER"){O[name].dataType=ap[0]}}else{ap=aD[0].split("(");if(ap[1]!==undefined){ap[1]=ap[1].substr(0,ap[1].length-1);O[name].fullType=ap[0]+"."+ap[1];O[name].stringLength=parseInt(ap[1],10)}else{O[name].fullType=ap[0]}O[name].type="USER";for(aB in A){if(A.hasOwnProperty(aB)){if(ap[0]===aB){O[name].type=ap[0]}}}if(O[name].type==="USER"){O[name].dataType=ap[0]}}ax+=ay}j=true;l("TAME library info: End of fetching the symbols.");l("TAME library info: Symbol table ready.")}catch(aA){l("TAME library error: Parsing of uploaded symbol information failed:"+aA);return}}function C(){var aq=X(),aE=[],aC,ao,aD,ay,av,aB,ap;aq.open("GET",g.symFileUrl,false);aq.setRequestHeader("Content-Type","text/xml");aq.send(null);l("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aC=(new DOMParser()).parseFromString(aq.responseText,"text/xml")}catch(az){l("TAME library error: Creating a DOM object from TPY failed:"+az);return}}else{l("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(true){}if(true){try{aD=aC.getElementsByTagName("Symbols")[0];aE=aD.getElementsByTagName("Symbol");for(var ax=0;ax<aE.length;ax++){ao=aE[ax].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();O[ao]={typeString:aE[ax].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(aE[ax].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(aE[ax].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(aE[ax].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};O[ao].size=(O[ao].bitSize>=8)?O[ao].bitSize/8:O[ao].bitSize;ay=O[ao].typeString.split(" ");if(ay[0]==="ARRAY"){O[ao].type=ay[0];av=ay[1].substring(1,ay[1].length-1);av=av.split("..");av=parseInt(av[1],10)-parseInt(av[0],10)+1;O[ao].arrayLength=av;aB=ay[3].split("(");if(aB[1]!==undefined){aB[1]=aB[1].substr(0,aB[1].length-1);O[ao].fullType=ay[0]+"."+av+"."+aB[0]+"."+aB[1];O[ao].stringLength=parseInt(aB[1],10)}else{O[ao].fullType=ay[0]+"."+av+"."+aB[0]}O[ao].itemSize=O[ao].size/av;O[ao].arrayDataType="USER";for(ap in A){if(A.hasOwnProperty(ap)){if(aB[0]===ap){O[ao].arrayDataType=aB[0]}}}if(O[ao].arrayDataType==="USER"){O[ao].dataType=aB[0]}}else{aB=ay[0].split("(");if(aB[1]!==undefined){aB[1]=aB[1].substr(0,aB[1].length-1);O[ao].fullType=aB[0]+"."+aB[1];O[ao].stringLength=parseInt(aB[1],10)}else{O[ao].fullType=aB[0]}O[ao].type="USER";for(ap in A){if(A.hasOwnProperty(ap)){if(aB[0]===ap){O[ao].type=aB[0]}}}if(O[ao].type==="USER"){O[ao].dataType=aB[0]}}}j=true;l("TAME library info: Symbol table ready.")}catch(az){l("TAME library error: An error occured while parsing the symbol file:");l(az)}}var an,au,aA,aw,ar;if(true){try{an=aC.getElementsByTagName("DataTypes")[0];au=an.getElementsByTagName("DataType");for(var ax=0;ax<au.length;ax++){ar=au[ax].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ao=ar.split(" ")[0];if(ao==="ARRAY"){am[ar]={bitSize:parseInt(au[ax].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};am[ar].size=am[ar].bitSize/8}}for(var ax=0;ax<au.length;ax++){ar=au[ax].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ao=ar.split(" ")[0];if(ao!=="ARRAY"){am[ao]={bitSize:parseInt(au[ax].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};am[ao].size=am[ao].bitSize/8;aA=au[ax].getElementsByTagName("SubItem");for(var at=0;at<aA.length;at++){aw=aA[at].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();am[ao].subItems[aw]={typeString:aA[at].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),bitSize:parseInt(aA[at].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(aA[at].getElementsByTagName("BitOffs")[0]!==undefined){am[ao].subItems[aw].bitOffset=parseInt(aA[at].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}am[ao].subItems[aw].size=(am[ao].subItems[aw].bitSize>=8)?am[ao].subItems[aw].bitSize/8:am[ao].subItems[aw].bitSize;ay=am[ao].subItems[aw].typeString.split(" ");if(ay[0]==="ARRAY"){am[ao].subItems[aw].type=ay[0];av=ay[1].substring(1,ay[1].length-1);av=av.split("..");av=parseInt(av[1],10)-parseInt(av[0],10)+1;am[ao].subItems[aw].arrayLength=av;aB=ay[3].split("(");if(aB[1]!==undefined){aB[1]=aB[1].substr(0,aB[1].length-1);am[ao].subItems[aw].fullType=ay[0]+"."+av+"."+aB[0]+"."+aB[1];am[ao].subItems[aw].stringLength=parseInt(aB[1],10)}else{am[ao].subItems[aw].fullType=ay[0]+"."+av+"."+aB[0]}am[ao].subItems[aw].bitSize=am[am[ao].subItems[aw].typeString].bitSize;am[ao].subItems[aw].size=am[am[ao].subItems[aw].typeString].size;am[ao].subItems[aw].itemSize=am[ao].subItems[aw].size/av;am[ao].subItems[aw].arrayDataType="USER";for(ap in A){if(A.hasOwnProperty(ap)){if(aB[0]===ap){am[ao].subItems[aw].arrayDataType=aB[0]}}}if(am[ao].subItems[aw].arrayDataType==="USER"){am[ao].subItems[aw].dataType=aB[0]}}else{aB=ay[0].split("(");if(aB[1]!==undefined){aB[1]=aB[1].substr(0,aB[1].length-1);am[ao].subItems[aw].fullType=aB[0]+"."+aB[1];am[ao].subItems[aw].stringLength=parseInt(aB[1],10)}else{am[ao].subItems[aw].fullType=aB[0]}am[ao].subItems[aw].type="USER";for(ap in A){if(A.hasOwnProperty(ap)){if(aB[0]===ap){am[ao].subItems[aw].type=aB[0]}}}if(am[ao].subItems[aw].type==="USER"){am[ao].subItems[aw].dataType=aB[0]}}}}}f=true;l("TAME library info: End of reading the data types from the TPY file.")}catch(az){l("TAME library error: An error occured while creating the data type information:");l(az)}}}if(g.dontFetchSymbols===true){l("TAME library info: Reading of the UploadInfo deactivated. Symbol Table could not be created.")}else{if(typeof g.symFileUrl=="string"){l("TAME library info: Fetching the TPY file from the webserver.");C()}else{l("TAME library info: Start fetching the symbols from PLC.");try{Z()}catch(aj){l("TAME library error: Could'nt fetch the symbol information from the PLC:"+aj);return}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};