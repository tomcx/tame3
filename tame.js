/*!
 * TAME [TwinCAT ADS Made Easy] V3.5 alpha
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(g){function l(am){try{window.console.log(am)}catch(an){alert(am)}}var Y=this,m={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,SumRd:61568,SumWr:61569,SumRdWr:61570},A={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},S=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],h=(typeof g.language==="string")?g.language:"ge",n=(function(){var e={},an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",am;for(am=0;am<an.length;am++){e[am]=an.charAt(am)}return e}()),q=(function(){var e={},an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",am;for(am=0;am<an.length;am++){e[an.charAt(am)]=am}return e}()),a=1,E=[0],O={},i=false,al={},f=false,b=0,v=0;if(typeof g.serviceUrl!=="string"){l("TAME library error: Service URL is not a string!");return}if(typeof g.amsNetId!=="string"){l("TAME library error: NetId is not a string!");return}if(g.amsPort===undefined){g.amsPort="801";l("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof g.amsPort==="number"){l("TAME library warning: AMS port number is not a string! Trying to convert it.");g.amsPort=g.amsPort.toString(10)}}if(parseInt(g.amsPort,10)<801||parseInt(g.amsPort,10)>891){l("TAME library error: AMS Port Number ("+parseInt(g.amsPort,10)+") is out of range (801-891)!");return}if(g.dataAlign4===true){a=4}else{if(g.alignment===undefined){a=1}else{if(typeof g.alignment==="string"){a=parseInt(g.alignment,10)}else{if(typeof g.alignment==="number"){a=g.alignment}}}}l("TAME library info: Data alignment set to: "+a);if(a!==1&&a!==4&&a!==8){l("TAME library warning: The value for the alignment should be 1, 4 or 8.")}if(g.syncXmlHttp===true){l('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests are used by default.')}if(typeof g.serviceUser==="string"&&typeof g.servicePassword==="string"){l("TAME library info: Username and password set. Authenticated requests will be used.")}else{g.serviceUser=null;g.servicePassword=null}this.dateNames={weekdShort:TAME.weekdShortNames[h],weekdLong:TAME.weekdLongNames[h],monthsShort:TAME.monthsShortNames[h],monthsLong:TAME.monthsLongNames[h]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;function z(e,ao,an,aq,au){var ap=[],at=0,ar=[],am=0;if(typeof e==="number"){ap[0]=e.toString(10)}else{if(typeof e==="string"){ap=e.split(".")}else{l("TAME library error: Can't parse name of object/variable. Name is not a string or number!");l(e);return}}if(an===undefined){an=window}at=ap.length-1;while(am<at){if(ap[am].charAt(ap[am].length-1)==="]"){ar=ap[am].substring(0,ap[am].length-1).split("[");an=an[ar[0]][ar[1]]}else{if(an[ap[am]]===undefined){an[ap[am]]=[]}an=an[ap[am]]}am++}if(ap[am].charAt(ap[am].length-1)==="]"){ar=ap[am].substring(0,ap[am].length-1).split("[");an=an[ar[0]];if(ao!==undefined){if(typeof aq==="string"){ao=aq+ao}if(typeof au==="string"){ao=ao+au}an[ar[1]]=ao}return an[ar[1]]}if(ao!==undefined){if(typeof aq==="string"){ao=aq+ao}if(typeof au==="string"){ao=ao+au}an[ap[am]]=ao}return an[ap[am]]}function aj(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=Y.maxStringLen){return true}l("TAME library error: User defined string length not valid! length: "+e);l("Max. string length: "+Y.maxStringLen);return false}function y(an){var am;if(an.addr){if(typeof an.addr==="string"&&an.addr.charAt(0)==="%"){if(an.addr.charAt(2)==="X"){am=m[an.addr.substr(1,2)]}else{am=m[an.addr.substr(1,1)]}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(an);return}}else{if(an.name){if(typeof an.name==="string"){try{am=O[an.name].indexGroup}catch(ao){l("TAME library error: Can't get the IndexGroup for this request!");l("TAME library error: Please check the variable name.");l(ao);l(an);return}}else{l("TAME library error: Varible name should be a string!");l(an);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(an);return}}if(isNaN(am)){l("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");l(an)}return am}function k(aq){var au,ao="",ar=[],ap;if(aq.addr){if(typeof aq.addr==="string"&&aq.addr.charAt(0)==="%"){if(aq.addr.charAt(2)==="X"){ao=aq.addr.substr(3);ar=ao.split(".");au=parseInt(ar[0],10)*8+parseInt(ar[1],10)}else{au=parseInt(aq.addr.substr(3),10);if(typeof aq.addrOffset==="number"){au+=aq.addrOffset}}}else{l('TAME library error: Wrong address definition, should be a string and start with "%"!');l(aq);return}}else{if(aq.name){if(typeof aq.name==="string"){try{au=O[aq.name].indexOffset;if(typeof aq.addrOffset==="number"){au+=aq.addrOffset}if(typeof aq.offs==="string"){au+=parseInt(aq.offs,10)/8}else{if(typeof aq.offs==="number"){au+=aq.offs/8}}var an,am,ap;if(typeof aq.subitem==="string"){l(aq.subitem);aq.subitem=aq.subitem.toUpperCase();l(aq.subitem);an=O[aq.name].dataType;l(an);am=aq.subitem.split(".");l(am);l(au);for(ap=0;ap<am.length;ap++){if(typeof al[an].subItems[am[ap]].bitOffset==="number"){au+=al[an].subItems[am[ap]].bitOffset;l(al[an].subItems[am[ap]].bitOffset)}l(au);if(al[an].type!==undefined){dateType=al[an].type}l(an)}}}catch(at){l("TAME library error: Can't get the IndexOffset for this request!");l("TAME library error: Please check the variable definition (name/offs/subitem).");l(at);l(aq);return}}else{l("TAME library error: Varible name should be a string!");l(aq);return}}else{l("TAME library error: Neither a name nor an address for the variable/request defined!");l(aq);return}}if(isNaN(au)){l("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");l(aq)}return au}function X(){var an;if(window.XMLHttpRequest){an=new window.XMLHttpRequest()}else{try{an=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(ao){try{an=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(am){an=null;l("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return an}function u(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){l(e)}}e.send=function(){var am,an;if(typeof this.reqDescr.id==="number"&&E[this.reqDescr.id]>0){l("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");E[this.reqDescr.id]++;if(E[this.reqDescr.id]<=Y.maxDropReq){return}E[this.reqDescr.id]=0}if(e.sync===true){an=false}else{if(this.reqDescr.sync===true){an=false}else{if(this.reqDescr.sync===false){an=true}else{if(g.syncXmlHttp===true){an=false}else{an=true}}}}this.xmlHttpReq=X();am="<?xml version='1.0' encoding='utf-8'?>";am+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";am+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";am+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";am+="<soap:Body><q1:";am+=this.method;am+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";am+=g.amsNetId;am+="</netId><nPort xsi:type='xsd:int'>";am+=g.amsPort;am+="</nPort>";if(this.indexGroup!==undefined){am+="<indexGroup xsi:type='xsd:unsignedInt'>";am+=this.indexGroup;am+="</indexGroup>"}if(this.indexOffset!==undefined){am+="<indexOffset xsi:type='xsd:unsignedInt'>";am+=this.indexOffset;am+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){am+="<cbRdLen xsi:type='xsd:int'>";am+=this.reqDescr.readLength;am+="</cbRdLen>"}if(this.pData&&this.pData.length>0){am+="<pData xsi:type='xsd:base64Binary'>";am+=this.pData;am+="</pData>"}if(this.pwrData&&this.pwrData.length>0){am+="<pwrData xsi:type='xsd:base64Binary'>";am+=this.pwrData;am+="</pwrData>"}am+="</q1:";am+=this.method;am+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",g.serviceUrl,an,g.serviceUser,g.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(an===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){Y.parseResponse(e)}};this.xmlHttpReq.send(am)}else{this.xmlHttpReq.send(am);Y.parseResponse(e)}if(typeof this.reqDescr.id==="number"){E[this.reqDescr.id]=1}}};return e}function T(ao,an,am,e){var ap;if(typeof ao.val==="string"){if(an==="REAL"||an==="LREAL"){ap=parseFloat(ao.val)}else{ap=parseInt(ao.val,10)}}else{if(typeof ao.val==="number"){ap=ao.val}else{l("TAME library error: Wrong variable type for a numeric variable in write request!");l("TAME library error: Variable type should be number or string, but is "+typeof ao.val);l(ao);ap=0}}if(isNaN(ap)){ap=0;l("TAME library error: Value of a numeric variable in write request is not a number.");l(ao)}if(Y.useCheckBounds===true){if(an==="LREAL"){if(!isFinite(ap)){l("TAME library warning: Limit for LREAL value exceeded!");l("Upper limit: "+Number.MAX_VALUE);l("Lower limit: "+Number.MIN_VALUE);l("value: "+ap);l(ao)}}else{if(an==="REAL"){if(ap>0){if(ap<1.175495e-38){l("TAME library warning: Lower limit for positive REAL value exceeded!");l("limit: 1.175495e-38");l("value: "+ap);l(ao);ap=1.175495e-38}else{if(ap>3.402823e+38){l("TAME library warning: Upper limit for positive REAL value exceeded!");l("limit: 3.402823e+38");l("value: "+ap);l(ao);ap=3.402823e+38}}}else{if(ap<0){if(ap>-1.175495e-38){l("TAME library warning: Upper limit for negative REAL value exceeded!");l("limit: -1.175495e-38");l("value: "+ap);l(ao);ap=-1.175495e-38}else{if(ap<-3.402823e+38){l("TAME library warning: Lower limit for negative REAL value exceeded!");l("limit: -3.402823e+38");l("value: "+ap);l(ao);ap=-3.402823e+38}}}}}else{if(ap<am){l("TAME library warning: Lower limit for numeric value exceeded!");l("type: "+an);l("limit: "+am);l("value: "+ap);l(ao);ap=am}else{if(ap>e){l("TAME library warning: Upper limit for numeric value exceeded!");l("type: "+an);l("limit: "+e);l("value: "+ap);l(ao);ap=e}}}}}return ap}function ag(an){var am=[];if(typeof an.type==="string"){am=an.type.split(".");if(am.length>2){am[1]=am.slice(1).join(".")}}else{if(i&&typeof an.name==="string"){try{am[0]=O[an.name].type;if(am[0]==="STRING"){am[1]=O[an.name].stringLength}else{if(typeof an.format==="string"){am[1]=an.format}else{if(typeof an.decPlaces==="number"){am[1]=an.decPlaces}else{if(typeof an.dp==="number"){am[1]=an.dp}}}}}catch(ao){l("TAME library error: A problem occured while reading a data type from the symbol table!");l(ao);l(an)}}else{l("TAME library error: Could not get the type of the item!");l(an)}}return am}function J(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ae(ap,am){var e=[],ao=ap.toString(16),an;while(ao.length<am*2){ao="0"+ao}for(an=0;an<am;an++){e[(am-1)-an]=((J(ao.charCodeAt(an*2))*16)+J(ao.charCodeAt((an*2)+1)))}return e}function s(am){var ap=0,at=0,aq,e,ao,ar,an;e=Math.abs(am);if(am!==0){for(an=128;an>-127;an--){ao=e/Math.pow(2,an);if(ao>=2){break}ar=an;aq=ao}ar+=127;aq=aq.toString(2);for(an=2;an<25;an++){ap<<=1;if(aq.charAt(an)==="1"){ap+=1}}if(aq.charAt(25)==="1"){ap+=1}at=ar;at<<=23;at+=ap;if(am<0){at+=2147483648}}return at}function D(ar){var an=0,au=0,ao={part1:0,part2:0},av,aq,am,e,at,ap;av=Math.abs(ar);if(ar!==0){for(ap=1024;ap>=-1023;ap--){aq=av/Math.pow(2,ap);if(aq>=2){break}am=ap;at=aq}am+=1023;at=at.toString(2);for(ap=2;ap<22;ap++){an<<=1;if(at.charAt(ap)==="1"){an+=1}}if(at.charAt(ap)==="1"){e=true}ap++;for(ap;ap<54;ap++){au<<=1;if(at.charAt(ap)==="1"){au+=1}}ao.part1=am;ao.part1<<=20;ao.part1+=an;if(ar<0){ao.part1+=2147483648}ao.part2=au;if(e===true){ao.part2+=2147483648}}return ao}function K(an,am){var e;switch(am){case"#d":case"#dd":e=an*86400000;break;case"#h":case"#hh":e=an*3600000;break;case"#m":case"#mm":e=an*60000;break;case"#s":case"#ss":e=an*1000;break;case"#ms":case"#msmsms":e=an;break;default:e=an;break}return e}function B(at,av){var e=av.split("#"),ar=e.length,au=/:|\.|-|_/,an=0,am=0,ap,ao,aq,aw;for(ao=1;ao<ar;ao++){if(au.test(e[ao])===true){aw=true}}if(aw!==true){l("TAME library error: No separator ( : . - _ ) for TOD string found!");l("String: "+at);l("Format: "+av);return 0}aq=at.split(au);for(ao=1;ao<ar;ao++){switch(e[ao]){case"h":case"hh":ap=parseInt(aq[am],10)*3600000;am++;break;case"m":case"mm":ap=parseInt(aq[am],10)*60000;am++;break;case"s":case"ss":ap=parseInt(aq[am],10)*1000;am++;break;case"ms":case"msmsms":ap=parseInt(aq[am],10);am++;break;default:ap=0}an+=ap}return an}function p(ar){var aq=n,ao=0,am="",ap,an,e;while(ao<ar.length){ap=ar[ao++];an=ar[ao++];e=ar[ao++];am=am+aq[ap>>2]+aq[((ap&3)<<4)|(an>>4)]+(isNaN(an)?"=":aq[(((an&15)<<2)|(e>>6))])+((isNaN(an)||isNaN(e))?"=":aq[e&63])}return am}function d(ar,ap,aq,ao){var au=[],e,at,am,an;if(ar.val===undefined){switch(ap){case"STRING":ar.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":ar.val=new Date();break;default:ar.val=0;break}l("TAME library warning: Value of a variable in write request is not defined!");l(ar)}switch(ap){case"BOOL":if(ar.val){au[0]=1}else{au[0]=0}break;case"BYTE":case"USINT":e=T(ar,ap,0,255);au=ae(e,ao);break;case"SINT":e=T(ar,ap,-128,127);if(e<0){e=e+256}au=ae(e,ao);break;case"WORD":case"UINT":e=T(ar,ap,0,65535);au=ae(e,ao);break;case"INT":case"INT16":e=T(ar,ap,-32768,32767);if(e<0){e=e+65536}au=ae(e,ao);break;case"INT1DP":ar.val=Math.round(ar.val*10);e=T(ar,ap,-32768,32767);if(e<0){e=e+65536}au=ae(e,ao);break;case"DWORD":case"UDINT":e=T(ar,ap,0,4294967295);au=ae(e,ao);break;case"DINT":e=T(ar,ap,-2147483648,2147483647);if(e<0){e=e+4294967296}au=ae(e,ao);break;case"REAL":e=T(ar,ap);e=s(e);au=ae(e,ao);break;case"LREAL":e=T(ar,ap);e=D(e);au=ae(e.part2,4);au=au.concat(ae(e.part1,4));break;case"DATE":if(typeof ar.val==="object"){ar.val.setHours(0);ar.val.setMinutes(0);ar.val.setSeconds(0);e=ar.val.getTime()/1000-ar.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DATE variable in write request is not a date object!");l(ar)}au=ae(e,ao);break;case"DT":case"DATE_AND_TIME":if(typeof ar.val==="object"){e=ar.val.getTime()/1000-ar.val.getTimezoneOffset()*60}else{l("TAME library error: Value of a DT variable in write request is not a date object!");l(ar)}au=ae(e,ao);break;case"TOD":case"TIME_OF_DAY":if(typeof ar.val==="object"){ar.val.setYear(1970);ar.val.setMonth(0);ar.val.setDate(1);e=ar.val.getTime()-ar.val.getTimezoneOffset()*60000}else{if(typeof ar.val==="string"){if(aq===""||aq===undefined){aq="#hh#:#mm";l("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");l(ar)}e=B(ar.val,aq)}else{l("TAME library error: TOD value in write request is wether a date object nor a string!");l(ar)}}au=ae(e,ao);break;case"STRING":at=(aq===undefined)?A.STRING:parseInt(aq,10);if(aj(at)){am=at<ar.val.length?at:ar.val.length;for(an=0;an<am;an++){au[an]=ar.val.charCodeAt(an)}for(an;an<at;an++){au[an]=0}au[an]=0}break;case"TIME":e=parseInt(ar.val,10);if(isNaN(e)){l("TAME library warning: Value of a TIME variable in write request is not defined!");l(ar);e=0}e=K(e,aq);if(e<0){e=0;l("TAME library warning: Lower limit for TIME variable in write request exceeded!)");l("value: "+ar.val+aq);l(ar)}else{if(e>4294967295){e=4294967295;l("TAME library warning: Upper limit for TIME variable in write request exceeded!)");l("value: "+ar.val+aq);l(ar)}}au=ae(e,ao);break;case"EndStruct":break;default:l("TAME library error: Unknown data type in write request : "+ap);break}return au}function t(am){var e=am.toString(16);if((e.length%2)!==0){e="0"+e}return e}function j(am,e){e=(isNaN(e))?0:e;var an=am.toString(10);while(an.length<e){an="0"+an}return an}function ak(ar,aq){var e=aq.split("#"),ap=e.length,am="",ao,an;for(an=1;an<ap;an++){switch(e[an]){case"D":ao=ar.getDate();break;case"DD":ao=ar.getDate();ao=j(ao,2);break;case"WD":ao=ar.getDay();break;case"WKD":ao=Y.dateNames.weekdShort[ar.getDay()];break;case"WEEKDAY":ao=Y.dateNames.weekdLong[ar.getDay()];break;case"M":ao=ar.getMonth()+1;break;case"MM":ao=ar.getMonth()+1;ao=j(ao,2);break;case"MON":ao=Y.dateNames.monthsShort[ar.getMonth()];break;case"MONTH":ao=Y.dateNames.monthsLong[ar.getMonth()];break;case"YY":ao=ar.getYear();while(ao>100){ao-=100}break;case"YYYY":ao=ar.getFullYear();break;case"h":ao=ar.getHours();break;case"hh":ao=ar.getHours();ao=j(ao,2);break;case"m":ao=ar.getMinutes();break;case"mm":ao=ar.getMinutes();ao=j(ao,2);break;case"s":ao=ar.getSeconds();break;case"ss":ao=ar.getSeconds();ao=j(ao,2);break;case"ms":ao=ar.getMilliseconds();break;case"msmsms":ao=ar.getMilliseconds();ao=j(ao,3);break;default:ao=e[an];break}am=am+ao}return am}function I(ar,aq){var e=aq.split("#"),ap=e.length,am="",ao,an;for(an=1;an<ap;an++){switch(e[an]){case"d":if(ap<=2){ao=ar/86400000}else{ao=Math.floor(ar/86400000);ar=ar%86400000}break;case"dd":if(ap<=2){ao=ar/86400000}else{ao=Math.floor(ar/86400000);ar=ar%86400000}ao=j(ao,2);break;case"h":if(ap<=2){ao=ar/3600000}else{ao=Math.floor(ar/3600000);ar=ar%3600000}break;case"hh":if(ap<=2){ao=ar/3600000}else{ao=Math.floor(ar/3600000);ar=ar%3600000}ao=j(ao,2);break;case"m":if(ap<=2){ao=ar/60000}else{ao=Math.floor(ar/60000);ar=ar%60000}break;case"mm":if(ap<=2){ao=ar/60000}else{ao=Math.floor(ar/60000);ar=ar%60000}ao=j(ao,2);break;case"s":if(ap<=2){ao=ar/1000}else{ao=Math.floor(ar/1000);ar=ar%1000}break;case"ss":if(ap<=2){ao=ar/1000}else{ao=Math.floor(ar/1000);ar=ar%1000}ao=j(ao,2);break;case"ms":ao=ar;break;case"msmsms":ao=ar;ao=j(ao,3);break;default:ao=e[an];break}am=am+ao}return am}function R(am){var e=t(am.charCodeAt(0));return parseInt(e,16)}function af(e){var am=R(e);if(am>127){am=am-256}return am}function N(am){var e=t(am.charCodeAt(1));e+=t(am.charCodeAt(0));return parseInt(e,16)}function M(e){var am=N(e);if(am>32767){am=am-65536}return am}function G(am){var e=t(am.charCodeAt(3));e+=t(am.charCodeAt(2));e+=t(am.charCodeAt(1));e+=t(am.charCodeAt(0));return parseInt(e,16)}function P(e){var am=G(e);if(am>2147483647){am=am-4294967296}return am}function W(e,an){var am=G(e);if(an===undefined){return am}return(I(am,an))}function o(e,an){var am=new Date(G(e));am=new Date(am.getTime()+am.getTimezoneOffset()*60000);if(an===undefined){return am}return(ak(am,an))}function ad(am,an){var e=new Date(G(am)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(an===undefined){return e}return(ak(e,an))}function r(an){var ap=1,ar=0.5,am=G(an),e,aq,ao;if(am===0){return 0}e=((am>>>31)===1)?"-":"+";am<<=1;aq=(am>>>24)-127;am<<=8;for(ao=1;ao<=23;ao++){ap+=am<0?ar:0;am<<=1;ar/=2}return parseFloat(e+(ap*Math.pow(2,aq)))}function F(an){var am=G(an.substring(4,8)),aq=G(an.substring(0,4)),ap=12,ao=1,at=0.5,e,ar;if(am===0&&aq===0){return 0}e=((am>>>31)===1)?"-":"+";am<<=1;ar=(am>>>21)-1023;am<<=11;while(ap<32){ao+=am<0?at:0;am<<=1;at/=2;ap++}if((aq>>>31)===1){ao+=at;aq<<=1;at/=2}while(ap<64){ao+=aq<0?at:0;aq<<=1;at/=2;ap++}return parseFloat(e+(ao*Math.pow(2,ar)))}function ab(e){return e.split(String.fromCharCode(0))[0]}function Q(ao){var ap=q,ar=0,e="",aq,an,am,aw,av,au,at;ao=ao.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aw=ap[ao.charAt(ar++)];av=ap[ao.charAt(ar++)];au=ap[ao.charAt(ar++)];at=ap[ao.charAt(ar++)];aq=(aw<<2)|(av>>4);an=((av&15)<<4)|(au>>2);am=((au&3)<<6)|at;e+=String.fromCharCode(aq);if(au!==64){e+=String.fromCharCode(an)}if(at!==64){e+=String.fromCharCode(am)}}while(ar<ao.length);return e}function U(am,e,ao){var an;switch(e){case"BOOL":an=(am.charCodeAt(0)!="0");break;case"BYTE":case"USINT":an=R(am);break;case"SINT":an=af(am);break;case"WORD":case"UINT":an=N(am);break;case"INT":case"INT16":an=M(am);break;case"INT1DP":an=((M(am))/10).toFixed(1);break;case"DWORD":case"UDINT":an=G(am);break;case"DINT":an=P(am);break;case"REAL":an=r(am);if(ao!==undefined){an=an.toFixed(parseInt(ao,10))}break;case"LREAL":an=F(am);if(ao!==undefined){an=an.toFixed(parseInt(ao,10))}break;case"STRING":an=ab(am);break;case"TOD":case"TIME_OF_DAY":an=o(am,ao);break;case"TIME":an=W(am,ao);break;case"DT":case"DATE":case"DATE_AND_TIME":an=ad(am,ao);break;case"EndStruct":break;default:l("TAME library error: Unknown data type at parsing read request: "+e);break}return an}function w(aF){var am,ax=aF.reqDescr.items,av=[],ay=0,aC,ao,ap,aE,at,aA,au,aD,an,az,aw,aq,ar;try{am=aF.xmlHttpReq.responseXML.documentElement;ao=Q(am.getElementsByTagName("ppData")[0].firstChild.data);for(aw=0,aq=ax.length;aw<aq;aw++){aC=ax[aw];av=ag(aC);an=av[0];az=av[1];aA=A[an];switch(an){case"STRING":if(az!==undefined){at=parseInt(az,10)}aA=(aj(at)?at:aA)+1;break;case"EndStruct":aA=aC.val;break}au=aA<a?aA:a;if(aF.reqDescr.seq!==true){ar=k(aF.reqDescr);ay=aC.addr-ar}else{if(aF.reqDescr.calcAlignment===true&&au>1&&an!=="EndStruct"&&an!=="STRING"&&ay>0){aD=ay%au;if(aD>0){ay+=au-aD}}}ap=ao.substr(ay,aA);aE=U(ap,an,az);if(an!=="EndStruct"){z(aC.jvar,aE,aF.reqDescr.dataObj,aC.prefix,aC.suffix)}if(aF.reqDescr.seq===true){ay+=aA}}}catch(aB){l("TAME library error: Parsing of Read Request failed:"+aB);l(aC);return}}function c(aL){var am,az=aL.reqDescr.items,ax=[],aD=0,ao=0,aB=window,aI=0,aH,aq,ar,aK,aF,ap,aE,ay,av,at,aA,aC,aw,au;function an(){var aM,e;if(ap==="STRING"){if(aE!==undefined){aM=parseInt(aE,10)}else{if(typeof O[aH.name].stringLength==="number"){aM=O[aH.name].stringLength}}aF=(aj(aM)?aM:aF)+1}e=ar.substr(ao,aF);aK=U(e,ap,aE);z(aA,aK,aB,aH.prefix,aH.suffix);ao+=aF}function aJ(){var aN,aM,aR,aQ,aO,aP;function e(){var aT,aS;if(a>1&&ap!=="STRING"&&ap!=="EndStruct"){aT=aF<a?aF:a;if(aT>1&&ao>0){aS=ao%aT;if(aS>0){ao+=aT-aS}}if(aT>aI){aI=aT}}}for(aP in aH.def){if(aH.def.hasOwnProperty(aP)){aM=aH.def[aP].split(".");if(aM[0]==="ARRAY"){aR=parseInt(aM[1],10);aQ=aM.length-1;for(aN=0;aN<aR;aN++){ap=aM[2];if(aM[aQ]==="SP"){aA=aP+aN;if(aQ>=4){aE=aM.slice(3,-1).join(".")}}else{aA=aP+"."+aN;if(aQ>=3){aE=aM.slice(3).join(".")}}if(aC!==null){aA=aC+"."+aA}aF=A[ap];e();an()}}else{if(aC!==null){aA=aC+"."+aP}else{aA=aP}ap=aM[0];aE=aM.slice(1).join(".");aF=A[ap];e();an()}}}if(a>1&&aI>1&&ap!=="STRING"&&ap!=="EndStruct"){if(aI>a){aI=a}aO=ao%aI;if(aO>0){ao+=aI-aO}}}try{am=aL.xmlHttpReq.responseXML.documentElement;aq=Q(am.getElementsByTagName("ppRdData")[0].firstChild.data);for(ay=0,av=az.length;ay<av;ay++){ar=aq.substr(aD,4);at=U(ar,"DWORD");if(at!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+at);l(az[ay])}aD+=4}for(ay=0;ay<av;ay++){aH=az[ay];ax=ag(aH);ap=ax[0];aE=ax[1];au=O[aH.name].size;aC=null;ar=aq.substr(aD,au);switch(ap){case"ARRAY":aB=z(aH.jvar);ao=0;aw=O[aH.name].arrayLength;if(O[aH.name].arrayDataType==="USER"){for(aC=0;aC<aw;aC++){aJ()}}else{ap=O[aH.name].arrayDataType;aF=A[ap];for(aC=0;aC<aw;aC++){aA=aC;an()}}break;case"USER":aB=z(aH.jvar);ao=0;aJ();break;default:aB=window;aK=U(ar,ap,aE);z(aH.jvar,aK,aB,aH.prefix,aH.suffix)}aD+=au}}catch(aG){l("TAME library error: Parsing of SumReadRequest failed:"+aG);l(aH);return}}function x(aE){var am,aw=aE.reqDescr.items,au=[],ay=0,an=0,ax=window,aC,ap,aq,aD,aA,ao,az,av,at,ar;try{am=aE.xmlHttpReq.responseXML.documentElement;ap=Q(am.getElementsByTagName("ppRdData")[0].firstChild.data);for(av=0,at=aw.length;av<at;av++){aq=ap.substr(ay,4);ar=U(aq,"DWORD");if(ar!==0){l("TAME library error: ADS sub command error while processing a SumReadRequest!");l("Error code: "+ar);l(aw[av])}ay+=4}}catch(aB){l("TAME library error: Parsing of SumWriteRequest failed:"+aB);l(aC);return}}function ah(ao){var am;try{am=ao.xmlHttpReq.responseXML.documentElement;Y.adsState=parseInt(am.getElementsByTagName("pAdsState")[0].firstChild.data,10);Y.adsStateTxt=S[Y.adsState];Y.deviceState=parseInt(am.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(an){l("TAME library error: Parsing of ADS Read State Request failed:"+an);return}}function L(at,aq,ao){var an={},ap,am;am=A[aq];if(typeof ao.name==="string"){ao.name=ao.name.toUpperCase()}switch(aq){case"STRING":if(aj(ao.strlen)){aq+="."+ao.strlen;am=ao.strlen}else{if(i===true){try{am=O[ao.name].stringLength;aq+="."+am}catch(ar){l("TAME library error: A problem occured while reading the string length from the symbol table!");l(ar)}}}am++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ao.format==="string"){aq+="."+ao.format}break;case"REAL":case"LREAL":if(typeof ao.decPlaces==="number"){aq+="."+ao.decPlaces}else{if(typeof ao.dp==="number"){aq+="."+ao.dp}}break}an={addr:ao.addr,name:ao.name,id:ao.id,oc:ao.oc,ocd:ao.ocd,readLength:am,debug:ao.debug,sync:ao.sync,offs:ao.offs,seq:true,items:[{val:ao.val,jvar:ao.jvar,type:aq,prefix:ao.prefix,suffix:ao.suffix}]};if(at==="Write"){Y.writeReq(an)}else{Y.readReq(an)}}function H(ap,aq,ao){var ar={},aD={},ay,an,aF=0,aG=0,aE=0,aH,am=[],aK,au,ax=0,az,av,aJ=0,aA=0,aM,aw,aL,aB;if(typeof ao.name==="string"){ao.name=ao.name.toUpperCase()}if(ap==="Write"&&typeof ao.val==="object"){aD=ao.val}else{if(typeof ao.jvar==="string"){aD=z(ao.jvar)}else{l("TAME library error: No data object for this "+ap+"-Request defined!")}}if(typeof ao.arrlen==="number"){ay=ao.arrlen}else{if(i===true){try{ay=O[ao.name].arrayLength}catch(aI){l("TAME library error: A proble occured while reading the array length from the symbol table!");l(aI)}}else{l("TAME library error: Can't get the array length for this request!")}}if(typeof ao.item==="number"&&!isNaN(ao.item)&&ap==="Write"){aL=true;if(ao.item<0||ao.item>ay-1){l('TAME library error: Wrong value for "item"!');l("item: "+ao.item);l("Last array index: "+(ay-1))}}function at(){var e;if(typeof ao.def==="string"){ao.def=z(ao.def)}else{if(typeof ao.def!=="object"){l("TAME library error: No structure definition found!")}}for(e in ao.def){if(ao.def.hasOwnProperty(e)){am=ao.def[e].split(".");if(am[0]==="ARRAY"){aK=parseInt(am[1],10);am.shift();am.shift()}else{aK=1}for(aG=0;aG<aK;aG++){if(am[0]==="STRING"){if(typeof am[1]==="string"){az=parseInt(am[1],10)}av=(aj(az)?az:A[am[0]])+1}else{av=A[am[0]]}if(a>1&&av>1&&am[0]!=="STRING"&&ax>0){aM=ax%av;if(aM>0){ax+=av-aM}}ax+=av}if(a>1&&av>aJ&&am[0]!=="STRING"){aJ=av}}}if(a>1&&aJ>1&&am[0]!=="STRING"){if(aJ>a){aJ=a}aM=ax%aJ;if(aM>0){aA=aJ-aM;ax+=aA}}if(aL){an=ax*ao.item;ay=1}ar={addr:ao.addr,name:ao.name,addrOffset:an,id:ao.id,oc:ao.oc,ocd:ao.ocd,debug:ao.debug,readLength:ax*ay,seq:true,calcAlignment:true,dataObj:aD,sync:ao.sync,offs:ao.offs,items:[]};for(aG=0;aG<ay;aG++){for(e in ao.def){if(ao.def.hasOwnProperty(e)){am=ao.def[e].split(".");if(am[0]==="ARRAY"){aK=parseInt(am[1],10);au=am.length-1;for(aE=0;aE<aK;aE++){if(am[au]==="SP"){ar.items[aF]={jvar:aG+"."+e+aE};if(au===4){ar.items[aF].type=am[2]+"."+am[3]}else{ar.items[aF].type=am[2]}}else{ar.items[aF]={jvar:aG+"."+e+"."+aE};if(au===3){ar.items[aF].type=am[2]+"."+am[3]}else{ar.items[aF].type=am[2]}}if(ap==="Write"){if(aL){if(am[au]==="SP"){ar.items[aF].val=aD[ao.item][e+aE]}else{ar.items[aF].val=aD[ao.item][e][aE]}}else{if(am[au]==="SP"){ar.items[aF].val=aD[aG][e+aE]}else{ar.items[aF].val=aD[aG][e][aE]}}}aF++}}else{ar.items[aF]={jvar:aG+"."+e,type:ao.def[e]};if(ap==="Write"){if(aL){ar.items[aF].val=aD[ao.item][e]}else{ar.items[aF].val=aD[aG][e]}}aF++}}}if(a>1){ar.items[aF]={type:"EndStruct",val:aA};aF++}}}function aC(){aH=A[aq];switch(aq){case"STRING":if(aj(ao.strlen)){aq+="."+ao.strlen;aH=ao.strlen}else{if(i===true){aH=O[ao.name].stringLength;aq+="."+aH}}aH++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ao.format==="string"){aq+="."+ao.format}break;case"REAL":case"LREAL":if(typeof ao.decPlaces==="number"){aq+="."+ao.decPlaces}else{if(typeof ao.dp==="number"){aq+="."+ao.dp}}break}if(aL){an=ao.item*aH;ay=1}ar={addr:ao.addr,name:ao.name,addrOffset:an,id:ao.id,oc:ao.oc,ocd:ao.ocd,readLength:aH*ay,debug:ao.debug,seq:true,dataObj:aD,items:[]};for(aG=0;aG<ay;aG++){ar.items[aG]={jvar:aG,type:aq};if(ap==="Write"){if(aL){ar.items[aG].val=aD[ao.item]}else{ar.items[aG].val=aD[aG]}}}}if(aq==="STRUCT"){at()}else{aC()}if(ap==="Write"){Y.writeReq(ar)}else{Y.readReq(ar)}}function aa(e,au){var aq={},am={},av=[],ao=0,at,an,ap,ar;if(typeof au.name==="string"){au.name=au.name.toUpperCase()}if(e==="Write"&&typeof au.val==="object"){am=au.val}else{if(typeof au.jvar==="string"){am=z(au.jvar)}else{l("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof au.def==="string"){au.def=z(au.def)}else{if(typeof au.def!=="object"){l("TAME library error: No structure defininition found!")}}aq={addr:au.addr,name:au.name,id:au.id,oc:au.oc,ocd:au.ocd,debug:au.debug,seq:true,calcAlignment:true,dataObj:am,sync:au.sync,offs:au.offs,items:[]};for(ap in au.def){if(au.def.hasOwnProperty(ap)){av=au.def[ap].split(".");if(av[0]==="ARRAY"){an=parseInt(av[1],10);at=av.length-1;for(ar=0;ar<an;ar++){if(av[at]==="SP"){aq.items[ao]={jvar:ap+ar};if(at===4){aq.items[ao].type=av[2]+"."+av[3]}else{aq.items[ao].type=av[2]}}else{aq.items[ao]={jvar:ap+"."+ar};if(at===3){aq.items[ao].type=av[2]+"."+av[3]}else{aq.items[ao].type=av[2]}}if(e==="Write"){if(av[at]==="SP"){aq.items[ao].val=am[ap+ar]}else{aq.items[ao].val=am[ap][ar]}}ao++}}else{aq.items[ao]={jvar:ap,type:au.def[ap]};if(e==="Write"){aq.items[ao].val=am[ap]}ao++}}}if(e==="Write"){Y.writeReq(aq)}else{Y.readReq(aq)}}this.writeReq=function(ao){var aq=ao.items,ay={},e=[],au=[],aB=[],at,ax,an,ar,am,az,av,aA,ap,aw;if(typeof ao.name==="string"){ao.name=ao.name.toUpperCase()}for(aw=0,an=aq.length;aw<an;aw++){aA=aq[aw];au=ag(aA);at=au[0];ax=au[1];if(isNaN(A[at])){l("TAME library error: Could not get the length of the data type: "+at);l("TAME library error: Probably wrong type definition. Please check the manual.");l(ao);return}ar=(A[at]<a)?A[at]:a;if(ao.calcAlignment===true&&ar>1&&at!=="STRING"&&at!=="EndStruct"&&e.length>0){av=e.length%ar;if(av>0){az=ar-av;for(ap=1;ap<=az;ap++){e.push(0)}}}if(at==="EndStruct"){for(ap=1;ap<=aA.val;ap++){e.push(0)}}else{aB=d(aA,at,ax,A[at]);e=e.concat(aB)}}if(e&&e.length>0){e=p(e)}ay={method:"Write",indexGroup:y(ao),indexOffset:k(ao),pData:e,reqDescr:ao};u(ay).send()};this.readReq=function(an){var aw={},ao=an.items,aq=[],ax,av,ap,e,ar,at,ay,au,am;if(typeof an.name==="string"){an.name=an.name.toUpperCase()}if(typeof an.readLength!=="number"){an.readLength=0;for(au=0,e=ao.length;au<e;au++){ax=ao[au];aq=ag(ax);ap=aq[0];av=aq[1];if(isNaN(A[ap])){l("TAME library error: Could not get the length of the data type: "+ap);l("TAME library error: Probably wrong type definition. Please check the manual.");l(an);return}if(ap==="STRING"){if(typeof av==="string"){ay=parseInt(av,10)}at=(aj(ay)?ay:A[ap])+1}else{at=A[ap]}if(an.seq===true){if(an.calcAlignment===true&&at>1&&ap!=="EndStruct"&&ap!=="STRING"&&an.readLength>0){ar=an.readLength%at;if(ar>0){an.readLength+=at-ar}}an.readLength+=at}else{am=k(an);an.readLength=at+ax.addr-am}}}aw={method:"Read",indexGroup:y(an),indexOffset:k(an),reqDescr:an};u(aw).send()};this.sumReadReq=function(an){var aw={},ap=an.items,at=[],ay=[],az=[],am=ap.length,ao={},ar,av,ax,au,aq,e;an.readLength=am*4;for(au=0;au<am;au++){ax=ap[au];if(typeof ax.name==="string"){ax.name=ax.name.toUpperCase()}at=ag(ax);ar=at[0];av=at[1];aq=O[ax.name].size;an.readLength+=aq;ao.val=y(ax);az=d(ao,"UDINT",av,4);ay=ay.concat(az);ao.val=k(ax);az=d(ao,"UDINT",av,4);ay=ay.concat(az);ao.val=aq;az=d(ao,"UDINT",av,4);ay=ay.concat(az)}if(ay.length>0){e=p(ay)}aw={method:"ReadWrite",indexGroup:m.SumRd,indexOffset:ap.length,pwrData:e,reqDescr:an};u(aw).send()};this.sumWriteReq=function(ao){var aH={},av=ao.items,ar=[],am=[],au=[],ap=av.length,aE={},aC=0,an,az,aB,at,aA,aG,ay,ax,aq,aD,e;function aw(){var aI;aA=A[an];if(an==="STRING"){if(az!==undefined){aI=parseInt(az,10)}else{if(typeof O[aB.name].stringLength==="number"){aI=O[aB.name].stringLength}}az=(aj(aI)?aI:aA)}}function aF(){var aL,aQ,aI,aM,aO,aJ,aK=[];function aP(){var aS,aR;if(a>1&&an!=="STRING"&&an!=="EndStruct"){aS=aA<a?aA:a;if(aS>1&&aK.length>0){aO=aK.length%aS;if(aO>0){e=aS-aO;for(aR=1;aR<=e;aR++){aK.push(0)}}}if(aS>aC){aC=aS}}}for(aJ in aB.def){if(aB.def.hasOwnProperty(aJ)){try{aQ=aB.def[aJ].split(".");if(aQ[0]==="ARRAY"){aI=parseInt(aQ[1],10);aM=aQ.length-1;for(aL=0;aL<aI;aL++){an=aQ[2];if(aQ[aM]==="SP"){if(aM>=4){az=aQ.slice(3,-1).join(".")}}else{if(aM>=3){az=aQ.slice(3).join(".")}}if(ay!==null){if(aQ[aM]==="SP"){aE.val=aB.val[ay][aJ+aL]}else{aE.val=aB.val[ay][aJ][aL]}}else{aE.val=aB.val[aJ][aL]}aw();aP();au=d(aE,an,az,aA);aK=aK.concat(au)}}else{if(ay!==null){aE.val=aB.val[ay][aJ]}else{aE.val=aB.val[aJ]}an=aQ[0];az=aQ.slice(1).join(".");aw();aP();au=d(aE,an,az,aA);aK=aK.concat(au)}}catch(aN){l("TAME library error: Could not set values for a structure in SumWriteReq: "+aN);l(aB)}}}if(a>1&&aC>1&&aQ[0]!=="STRING"&&aQ[0]!=="EndStruct"){aO=aK.length%aC;if(aO>0){e=aC-aO;for(ax=1;ax<=e;ax++){aK.push(0)}}}am=am.concat(aK)}ao.readLength=ap*4;for(at=0;at<ap;at++){aB=av[at];if(typeof aB.name==="string"){aB.name=aB.name.toUpperCase()}ar=ag(aB);an=ar[0];az=ar[1];aA=O[aB.name].size;aE.val=y(aB);au=d(aE,"UDINT",az,4);am=am.concat(au);aE.val=k(aB);au=d(aE,"UDINT",az,4);am=am.concat(au);aE.val=aA;au=d(aE,"UDINT",az,4);am=am.concat(au)}for(at=0;at<ap;at++){aB=av[at];if(typeof aB.name==="string"){aB.name=aB.name.toUpperCase()}ar=ag(aB);an=ar[0];az=ar[1];aA=O[aB.name].size;ay=null;switch(an){case"ARRAY":aq=parseInt(O[aB.name].arrayLength,10);if(aq!==aB.val.length){l("TAME library error: Array length in JS differs from the length in the PLC!");l("Length in JS: "+aB.val.length);l("Length in PLC: "+aq);l(aB);return}if(O[aB.name].arrayDataType==="USER"){for(ay=0;ay<aq;ay++){aF()}}else{an=O[aB.name].arrayDataType;if(an==="STRING"){az=O[aB.name].stringLength}else{aA=O[aB.name].itemSize}for(ay=0;ay<aq;ay++){aE.val=aB.val[ay];au=d(aE,an,az,aA);am=am.concat(au)}}break;case"USER":aF();break;default:if(an==="STRING"){az=O[aB.name].stringLength}else{aA=O[aB.name].size}au=d(aB,an,az,aA);am=am.concat(au)}}if(am.length>0){aG=p(am)}aH={method:"ReadWrite",indexGroup:m.SumWr,indexOffset:av.length,pwrData:aG,reqDescr:ao};u(aH).send()};this.readAdsState=function(e){var am={method:"ReadState",reqDescr:e};u(am).send()};this.logSymbols=function(){l(O)};this.logDataTypes=function(){l(al)};this.getSymbolsAsJSON=function(){var an;if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{an=JSON.stringify(O);return an}catch(am){l("TAME library error: Could not convert the Symbol Table to JSON:"+am)}}};this.setSymbolsFromJSON=function(an){if(typeof JSON!=="object"){l("TAME library error: No JSON parser found.")}else{try{O=JSON.parse(an)}catch(am){l("TAME library error: Could not create the Symbol Table from JSON:"+am);return}i=true;l("TAME library info: Symbol Table successfully created from JSON data.")}};this.parseResponse=function(ar){var an,aq,am;if(typeof ar.reqDescr.id==="number"){E[ar.reqDescr.id]=0}if(ar.xmlHttpReq.responseXML===null){l('TAME library error: Request contains no XML data. Object "responseXML" is null.');l('TAME library error: This is the "responseText":');l(ar.xmlHttpReq.responseText)}try{an=ar.xmlHttpReq.responseXML.documentElement}catch(ap){l("TAME library error: No XML data in server response:"+ap);return}try{am=an.getElementsByTagName("faultstring")[0].firstChild.data;try{aq=an.getElementsByTagName("errorcode")[0].firstChild.data}catch(ap){aq="-"}l("TAME library error: Message from server:  "+am+" ("+aq+")");return}catch(ao){aq=0}if(typeof an.normalize==="function"){an.normalize()}if(ar.method==="ReadState"){ah(ar)}else{if(ar.method==="Read"||ar.method==="ReadWrite"){switch(ar.indexGroup){case m.UploadInfo:V(ar);break;case m.Upload:ac(ar);break;case m.SumRd:c(ar);break;case m.SumWr:x(ar);break;default:w(ar)}}}if(typeof ar.reqDescr.oc==="function"){if(typeof ar.reqDescr.ocd==="number"){window.setTimeout(ar.reqDescr.oc,ar.reqDescr.ocd)}else{ar.reqDescr.oc()}}};this.writeBool=function(e){L("Write","BOOL",e)};this.writeByte=function(e){L("Write","BYTE",e)};this.writeUsint=function(e){L("Write","USINT",e)};this.writeSint=function(e){L("Write","SINT",e)};this.writeWord=function(e){L("Write","WORD",e)};this.writeUint=function(e){L("Write","UINT",e)};this.writeInt=function(e){L("Write","INT",e)};this.writeInt1Dp=function(e){L("Write","INT1DP",e)};this.writeDword=function(e){L("Write","DWORD",e)};this.writeUdint=function(e){L("Write","UDINT",e)};this.writeDint=function(e){L("Write","DINT",e)};this.writeReal=function(e){L("Write","REAL",e)};this.writeLreal=function(e){L("Write","LREAL",e)};this.writeString=function(e){L("Write","STRING",e)};this.writeTime=function(e){L("Write","TIME",e)};this.writeTod=function(e){L("Write","TOD",e)};this.writeDate=function(e){L("Write","DATE",e)};this.writeDt=function(e){L("Write","DT",e)};this.readBool=function(e){L("Read","BOOL",e)};this.readByte=function(e){L("Read","BYTE",e)};this.readUsint=function(e){L("Read","USINT",e)};this.readSint=function(e){L("Read","SINT",e)};this.readWord=function(e){L("Read","WORD",e)};this.readUint=function(e){L("Read","UINT",e)};this.readInt=function(e){L("Read","INT",e)};this.readInt1Dp=function(e){L("Read","INT1DP",e)};this.readDword=function(e){L("Read","DWORD",e)};this.readUdint=function(e){L("Read","UDINT",e)};this.readDint=function(e){L("Read","DINT",e)};this.readReal=function(e){L("Read","REAL",e)};this.readLreal=function(e){L("Read","LREAL",e)};this.readString=function(e){L("Read","STRING",e)};this.readTime=function(e){L("Read","TIME",e)};this.readTod=function(e){L("Read","TOD",e)};this.readDate=function(e){L("Read","DATE",e)};this.readDt=function(e){L("Read","DT",e)};this.writeStruct=function(e){aa("Write",e)};this.readStruct=function(e){aa("Read",e)};this.writeArrayOfBool=function(e){H("Write","BOOL",e)};this.writeArrayOfByte=function(e){H("Write","BYTE",e)};this.writeArrayOfUsint=function(e){H("Write","USINT",e)};this.writeArrayOfSint=function(e){H("Write","SINT",e)};this.writeArrayOfWord=function(e){H("Write","WORD",e)};this.writeArrayOfUint=function(e){H("Write","UINT",e)};this.writeArrayOfInt=function(e){H("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){H("Write","INT1DP",e)};this.writeArrayOfDword=function(e){H("Write","DWORD",e)};this.writeArrayOfUdint=function(e){H("Write","UDINT",e)};this.writeArrayOfDint=function(e){H("Write","DINT",e)};this.writeArrayOfReal=function(e){H("Write","REAL",e)};this.writeArrayOfLreal=function(e){H("Write","LREAL",e)};this.writeArrayOfString=function(e){H("Write","STRING",e)};this.writeArrayOfTime=function(e){H("Write","TIME",e)};this.writeArrayOfTod=function(e){H("Write","TOD",e)};this.writeArrayOfDate=function(e){H("Write","DATE",e)};this.writeArrayOfDt=function(e){H("Write","DT",e)};this.writeArrayOfStruct=function(e){H("Write","STRUCT",e)};this.readArrayOfBool=function(e){H("Read","BOOL",e)};this.readArrayOfByte=function(e){H("Read","BYTE",e)};this.readArrayOfUsint=function(e){H("Read","USINT",e)};this.readArrayOfSint=function(e){H("Read","SINT",e)};this.readArrayOfWord=function(e){H("Read","WORD",e)};this.readArrayOfUint=function(e){H("Read","UINT",e)};this.readArrayOfInt=function(e){H("Read","INT",e)};this.readArrayOfInt1Dp=function(e){H("Read","INT1DP",e)};this.readArrayOfDword=function(e){H("Read","DWORD",e)};this.readArrayOfUdint=function(e){H("Read","UDINT",e)};this.readArrayOfDint=function(e){H("Read","DINT",e)};this.readArrayOfReal=function(e){H("Read","REAL",e)};this.readArrayOfLreal=function(e){H("Read","LREAL",e)};this.readArrayOfString=function(e){H("Read","STRING",e)};this.readArrayOfTime=function(e){H("Read","TIME",e)};this.readArrayOfTod=function(e){H("Read","TOD",e)};this.readArrayOfDate=function(e){H("Read","DATE",e)};this.readArrayOfDt=function(e){H("Read","DT",e)};this.readArrayOfStruct=function(e){H("Read","STRUCT",e)};function Z(){var e={method:"Read",sync:true,indexGroup:m.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};u(e).send()}function V(ar){var am,an,at,ap,ao;try{am=ar.xmlHttpReq.responseXML.documentElement;an=Q(am.getElementsByTagName("ppData")[0].firstChild.data);at=an.substr(0,4);b=U(at,"DWORD");at=an.substr(4,4);v=U(at,"DWORD")}catch(aq){l("TAME library error: Parsing of UploadInfo failed:"+aq);return}ao={method:"Read",sync:true,indexGroup:m.Upload,indexOffset:0,reqDescr:{readLength:v}};u(ao).send()}function ac(aE){var am,aw=0,aB=4,ay=8,au=12,aq=30,ap,ar,aD,av,ax,an,aC,at,ao,aA;try{am=aE.xmlHttpReq.responseXML.documentElement;ap=Q(am.getElementsByTagName("ppData")[0].firstChild.data);for(av=0;av<b;av++){ar=ap.substr(aw,4);ax=U(ar,"DWORD");an=ap.substring(aw+aq,(aw+ax)).split(String.fromCharCode(0));name=an[0].toUpperCase();O[name]={typeString:an[1],indexGroup:U(ap.substr(aw+aB,4),"DWORD"),indexOffset:U(ap.substr(aw+ay,4),"DWORD"),size:U(ap.substr(aw+au,4),"DWORD")};aC=an[1].split(" ");if(aC[0]==="ARRAY"){O[name].type=aC[0];at=aC[1].substring(1,aC[1].length-1);at=at.split("..");at=parseInt(at[1],10)-parseInt(at[0],10)+1;O[name].arrayLength=at;ao=aC[3].split("(");if(ao[1]!==undefined){ao[1]=ao[1].substr(0,ao[1].length-1);O[name].fullType=aC[0]+"."+at+"."+ao[0]+"."+ao[1];O[name].stringLength=parseInt(ao[1],10)}else{O[name].fullType=aC[0]+"."+at+"."+ao[0]}O[name].itemSize=O[name].size/at;O[name].arrayDataType="USER";for(aA in A){if(A.hasOwnProperty(aA)){if(ao[0]===aA){O[name].arrayDataType=ao[0]}}}if(O[name].arrayDataType==="USER"){O[name].dataType=ao[0]}}else{ao=aC[0].split("(");if(ao[1]!==undefined){ao[1]=ao[1].substr(0,ao[1].length-1);O[name].fullType=ao[0]+"."+ao[1];O[name].stringLength=parseInt(ao[1],10)}else{O[name].fullType=ao[0]}O[name].type="USER";for(aA in A){if(A.hasOwnProperty(aA)){if(ao[0]===aA){O[name].type=ao[0]}}}if(O[name].type==="USER"){O[name].dataType=ao[0]}}aw+=ax}i=true;l("TAME library info: End of fetching the symbols.");l("TAME library info: Symbol table ready.")}catch(az){l("TAME library error: Parsing of uploaded symbol information failed:"+az);return}}function C(){var ap=X(),aC=[],aA,an,aB,aw,at,az,ao;ap.open("GET",g.symFileUrl,false);ap.setRequestHeader("Content-Type","text/xml");ap.send(null);l("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aA=(new DOMParser()).parseFromString(ap.responseText,"text/xml")}catch(ax){l("TAME library error: Creating a DOM object from TPY failed:"+ax);return}}else{l("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(true){try{aB=aA.getElementsByTagName("Symbols")[0];aC=aB.getElementsByTagName("Symbol");for(var av=0;av<aC.length;av++){an=aC[av].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();O[an]={typeString:aC[av].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(aC[av].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(aC[av].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(aC[av].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};O[an].size=(O[an].bitSize>=8)?O[an].bitSize/8:O[an].bitSize;aw=O[an].typeString.split(" ");if(aw[0]==="ARRAY"){O[an].type=aw[0];at=aw[1].substring(1,aw[1].length-1);at=at.split("..");at=parseInt(at[1],10)-parseInt(at[0],10)+1;O[an].arrayLength=at;az=aw[3].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);O[an].fullType=aw[0]+"."+at+"."+az[0]+"."+az[1];O[an].stringLength=parseInt(az[1],10)}else{O[an].fullType=aw[0]+"."+at+"."+az[0]}O[an].itemSize=O[an].size/at;O[an].arrayDataType="USER";for(ao in A){if(A.hasOwnProperty(ao)){if(az[0]===ao){O[an].arrayDataType=az[0]}}}if(O[an].arrayDataType==="USER"){O[an].dataType=az[0]}}else{az=aw[0].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);O[an].fullType=az[0]+"."+az[1];O[an].stringLength=parseInt(az[1],10)}else{O[an].fullType=az[0]}O[an].type="USER";for(ao in A){if(A.hasOwnProperty(ao)){if(az[0]===ao){O[an].type=az[0]}}}if(O[an].type==="USER"){O[an].dataType=az[0]}}}i=true;l("TAME library info: Symbol table ready.")}catch(ax){l("TAME library error: An error occured while parsing the symbol file:");l(ax)}}var am,ar,ay,au;if(true){try{am=aA.getElementsByTagName("DataTypes")[0];ar=am.getElementsByTagName("DataType");for(var av=0;av<ar.length;av++){an=ar[av].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();an=an.split(" ")[0];if(an!=="ARRAY"){al[an]={bitSize:parseInt(ar[av].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};ay=ar[av].getElementsByTagName("SubItem");for(var aq=0;aq<ay.length;aq++){au=ay[aq].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();al[an].subItems[au]={typeString:ay[aq].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),bitSize:parseInt(ay[aq].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(ay[aq].getElementsByTagName("BitOffs")[0]!==undefined){al[an].subItems[au].bitOffset=parseInt(ay[aq].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}al[an].subItems[au].size=(al[an].subItems[au].bitSize>=8)?al[an].subItems[au].bitSize/8:al[an].subItems[au].bitSize;aw=al[an].subItems[au].typeString.split(" ");if(aw[0]==="ARRAY"){al[an].subItems[au].type=aw[0];at=aw[1].substring(1,aw[1].length-1);at=at.split("..");at=parseInt(at[1],10)-parseInt(at[0],10)+1;al[an].subItems[au].arrayLength=at;az=aw[3].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);al[an].subItems[au].fullType=aw[0]+"."+at+"."+az[0]+"."+az[1];al[an].subItems[au].stringLength=parseInt(az[1],10)}else{al[an].subItems[au].fullType=aw[0]+"."+at+"."+az[0]}al[an].subItems[au].itemSize=al[an].subItems[au].size/at;al[an].subItems[au].arrayDataType="USER";for(ao in A){if(A.hasOwnProperty(ao)){if(az[0]===ao){al[an].subItems[au].arrayDataType=az[0]}}}if(al[an].subItems[au].arrayDataType==="USER"){al[an].subItems[au].dataType=az[0]}}else{az=aw[0].split("(");if(az[1]!==undefined){az[1]=az[1].substr(0,az[1].length-1);al[an].subItems[au].fullType=az[0]+"."+az[1];al[an].subItems[au].stringLength=parseInt(az[1],10)}else{al[an].subItems[au].fullType=az[0]}al[an].subItems[au].type="USER";for(ao in A){if(A.hasOwnProperty(ao)){if(az[0]===ao){al[an].subItems[au].type=az[0]}}}if(al[an].subItems[au].type==="USER"){al[an].subItems[au].dataType=az[0]}}}}}f=true;l("TAME library info: End of reading the data types from the TPY file.")}catch(ax){l("TAME library error: An error occured while creating the data type information:");l(ax)}}}if(g.dontFetchSymbols===true){l("TAME library info: Reading of the UploadInfo deactivated. Symbol Table could not be created.")}else{if(typeof g.symFileUrl=="string"){l("TAME library message: Fetching the TPY file from the webserver.");C()}else{l("TAME library info: Start fetching the symbols from PLC.");try{Z()}catch(ai){l("TAME library error: Could'nt fetch the symbol information from the PLC:"+ai);return}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};