/*!
 * TAME [TwinCAT ADS Made Easy] V3.5 beta
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(g){function m(aq){try{window.console.log(aq)}catch(ar){alert(aq)}}var ab=this,n={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,SumRd:61568,SumWr:61569,SumRdWr:61570},D={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},V=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],h=(typeof g.language==="string")?g.language:"ge",o=(function(){var e={},ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aq;for(aq=0;aq<ar.length;aq++){e[aq]=ar.charAt(aq)}return e}()),r=(function(){var e={},ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",aq;for(aq=0;aq<ar.length;aq++){e[ar.charAt(aq)]=aq}return e}()),a=0,G=[0],R={},k=false,ap={},f=false,B={},b=0,x=0;if(typeof g.serviceUrl!=="string"){m("TAME library error: Service URL is not a string!");return}if(typeof g.amsNetId!=="string"&&(typeof g.configFileUrl!=="string"||g.dontFetchSymbols===true)){m("TAME library error: NetId is not defined and there is no URL for fetching the TPY file or fetching the symbols is deactivated!");return}if(g.amsPort===undefined&&(typeof g.configFileUrl!=="string"||g.dontFetchSymbols===true)){g.amsPort="801";m("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof g.amsPort==="number"){m("TAME library warning: AMS port number is not a string! Trying to convert it.");g.amsPort=g.amsPort.toString(10)}}if(parseInt(g.amsPort,10)<801||parseInt(g.amsPort,10)>891){m("TAME library error: AMS Port Number ("+parseInt(g.amsPort,10)+") is out of range (801-891)!");return}if(g.dataAlign4===true){a=4}else{if(g.alignment===undefined&&(typeof g.configFileUrl!=="string"||g.dontFetchSymbols===true)){a=1}else{if(typeof g.alignment==="string"){a=parseInt(g.alignment,10)}else{if(typeof g.alignment==="number"){a=g.alignment}}}}if(g.syncXmlHttp===true){m('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests are used by default.')}if(typeof g.serviceUser==="string"&&typeof g.servicePassword==="string"){m("TAME library info: Username and password set. Authenticated requests will be used.")}else{g.serviceUser=null;g.servicePassword=null}this.dateNames={weekdShort:TAME.weekdShortNames[h],weekdLong:TAME.weekdLongNames[h],monthsShort:TAME.monthsShortNames[h],monthsLong:TAME.monthsLongNames[h]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;function C(e,at,ar,av,ay){var au=[],ax=0,aw=[],aq=0;if(typeof e==="number"){au[0]=e.toString(10)}else{if(typeof e==="string"){au=e.split(".")}else{m("TAME library error: Can't parse name of object/variable. Name is not a string or number!");m(e);return}}if(ar===undefined){ar=window}ax=au.length-1;while(aq<ax){if(au[aq].charAt(au[aq].length-1)==="]"){aw=au[aq].substring(0,au[aq].length-1).split("[");ar=ar[aw[0]][aw[1]]}else{if(ar[au[aq]]===undefined){ar[au[aq]]=[]}ar=ar[au[aq]]}aq++}if(au[aq].charAt(au[aq].length-1)==="]"){aw=au[aq].substring(0,au[aq].length-1).split("[");ar=ar[aw[0]];if(at!==undefined){if(typeof av==="string"){at=av+at}if(typeof ay==="string"){at=at+ay}ar[aw[1]]=at}return ar[aw[1]]}if(at!==undefined){if(typeof av==="string"){at=av+at}if(typeof ay==="string"){at=at+ay}ar[au[aq]]=at}return ar[au[aq]]}function an(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=ab.maxStringLen){return true}m("TAME library error: User defined string length not valid! length: "+e);m("Max. string length: "+ab.maxStringLen);return false}function A(ar){var aq;if(ar.addr){if(typeof ar.addr==="string"&&ar.addr.charAt(0)==="%"){if(ar.addr.charAt(2)==="X"){aq=n[ar.addr.substr(1,2)]}else{aq=n[ar.addr.substr(1,1)]}}else{m('TAME library error: Wrong address definition, should be a string and start with "%"!');m(ar);return}}else{if(ar.symbolName){if(typeof ar.symbolName==="string"){try{aq=R[ar.symbolName].indexGroup}catch(at){m("TAME library error: Can't get the IndexGroup for this request!");m("TAME library error: Please check the variable name.");m(at);m(ar);return}}else{m("TAME library error: Varible name should be a string!");m(ar);return}}else{m("TAME library error: Neither a name nor an address for the variable/request defined!");m(ar);return}}if(isNaN(aq)){m("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");m(ar)}return aq}function l(ax){var au,ar="",aw=[],at,az,aq,ay,aB,aA;if(ax.addr){if(typeof ax.addr==="string"&&ax.addr.charAt(0)==="%"){if(ax.addr.charAt(2)==="X"){ar=ax.addr.substr(3);aw=ar.split(".");au=parseInt(aw[0],10)*8+parseInt(aw[1],10)}else{au=parseInt(ax.addr.substr(3),10);if(typeof ax.addrOffset==="number"){au+=ax.addrOffset}}}else{m('TAME library error: Wrong address definition, should be a string and start with "%"!');m(ax);return}}else{if(ax.symbolName){if(typeof ax.symbolName==="string"){try{au=R[ax.symbolName].indexOffset;if(typeof ax.symbolNameArrIdx==="number"){au+=R[ax.symbolName].itemSize*(ax.symbolNameArrIdx-R[ax.symbolName].arrStartIdx)}if(typeof ax.addrOffset==="number"){au+=ax.addrOffset}if(typeof ax.offs==="string"){au+=parseInt(ax.offs,10)/8}else{if(typeof ax.offs==="number"){au+=ax.offs/8}}if(ax.dataTypeNames.length>0){aq=ax.dataTypeNames;az=R[ax.symbolName].dataType;for(at=0;at<aq.length;at++){aA=ap[az].subItems[aq[at]];au+=aA.bitOffset/8;if(typeof ax.dataTypeArrIdx[at]==="number"){au+=aA.itemSize*(ax.dataTypeArrIdx[at]-aA.arrStartIdx)}az=ap[az].subItems[aq[at]].dataType}}}catch(av){m("TAME library error: Can't get the IndexOffset for this request!");m("TAME library error: Please check the variable definition (name/offs/subitem).");m(av);m(ax);return}}else{m("TAME library error: Varible name should be a string!");m(ax);return}}else{m("TAME library error: Neither a name nor an address for the variable/request defined!");m(ax);return}}if(isNaN(au)){m("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");m(ax)}return au}function al(az){var aq={},ay,at;if(typeof az.name==="string"){az.name=az.name.toUpperCase();ay=az.name.split(".")}if(ay[0]===""){aq.symbolName="."+ay[1]}else{aq.symbolName=ay[0]+"."+ay[1]}if(aq.symbolName.charAt(aq.symbolName.length-1)==="]"){at=aq.symbolName.substring(0,aq.symbolName.length-1).split("[");aq.symbolName=at[0];aq.symbolNameArrIdx=parseInt(at[1],10)}aq.dataTypeNames=ay.slice(2);var au=[],aw,ax,ar;if(typeof az.type==="string"){au=az.type.split(".");aq.type=au[0];if(au.length>2){au[1]=au.slice(1).join(".")}aq.format=au[1];aq.size=D[az.type]}if(k&&f&&aq.dataTypeNames.length>0){aw=aq.dataTypeNames;ax=R[aq.symbolName].dataType;aq.dataTypeArrIdx=[];ar=0;do{if(aw[ar].charAt(aw[ar].length-1)==="]"){at=aw[ar].substring(0,aw[ar].length-1).split("[");aw[ar]=at[0];aq.dataTypeArrIdx[ar]=parseInt(at[1],10)}if(ap[ax].subItems[aw[ar]].pointer===true){m("TAME library error: PLC variable "+[aw[ar]]+" is a pointer! Can't get the variable value.")}if(ar===aw.length-1){break}ax=ap[ax].subItems[aw[ar]].dataType;ar++}while(ar<aw.length);try{if(az.type===undefined){aq.type=ap[ax].subItems[aw[ar]].type}if(aq.type==="STRING"){aq.stringLength=ap[ax].subItems[aw[ar]].stringLength;aq.format=aq.stringLength}else{if(typeof az.format==="string"){aq.format=az.format}else{if(typeof az.decPlaces==="number"){aq.format=az.decPlaces}else{if(typeof az.dp==="number"){aq.format=az.dp}}}}aq.arrayLength=ap[ax].subItems[aw[ar]].arrayLength;aq.arrayDataType=ap[ax].subItems[aw[ar]].arrayDataType;aq.dataType=ap[ax].subItems[aw[ar]].dataType;aq.itemSize=ap[ax].subItems[aw[ar]].itemSize;if(aq.size===undefined){aq.size=ap[ax].subItems[aw[ar]].size}aq.bitOffset=ap[ax].subItems[aw[ar]].bitOffset;aq.offs=az.offs;if(aq.dataTypeArrIdx[ar]!==undefined&&aq.type==="ARRAY"){aq.type=ap[ax].subItems[aw[ar]].arrayDataType;aq.size=ap[ax].subItems[aw[ar]].itemSize}}catch(av){m("TAME library error: A problem occured while reading a data type from the data type table!");m(av);m(az)}}else{if(k){try{if(az.type===undefined){aq.type=R[aq.symbolName].type}if(aq.type==="STRING"){aq.stringLength=R[aq.symbolName].stringLength;aq.format=aq.stringLength}else{if(typeof az.format==="string"){aq.format=az.format}else{if(typeof az.decPlaces==="number"){aq.format=az.decPlaces}else{if(typeof az.dp==="number"){aq.format=az.dp}}}}aq.arrayLength=R[aq.symbolName].arrayLength;aq.arrayDataType=R[aq.symbolName].arrayDataType;aq.dataType=R[aq.symbolName].dataType;aq.itemSize=R[aq.symbolName].itemSize;if(aq.size===undefined){aq.size=R[aq.symbolName].size}aq.bitOffset=R[aq.symbolName].bitOffset;aq.offs=az.offs;if(aq.symbolNameArrIdx!==undefined&&aq.type==="ARRAY"){aq.type=R[aq.symbolName].arrayDataType;aq.size=R[aq.symbolName].itemSize}}catch(av){m("TAME library error: A problem occured while reading a data type from the symbol table!");m(av);m(az)}}else{m("TAME library error: Could not get the type of the item!");m(az)}}return aq}function aa(){var ar;if(window.XMLHttpRequest){ar=new window.XMLHttpRequest()}else{try{ar=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(at){try{ar=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(aq){ar=null;m("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return ar}function w(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){m(e)}}e.send=function(){var aq,ar;if(typeof this.reqDescr.id==="number"&&G[this.reqDescr.id]>0){m("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");G[this.reqDescr.id]++;if(G[this.reqDescr.id]<=ab.maxDropReq){return}G[this.reqDescr.id]=0}if(e.sync===true){ar=false}else{if(this.reqDescr.sync===true){ar=false}else{if(this.reqDescr.sync===false){ar=true}else{if(g.syncXmlHttp===true){ar=false}else{ar=true}}}}this.xmlHttpReq=aa();aq="<?xml version='1.0' encoding='utf-8'?>";aq+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";aq+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";aq+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";aq+="<soap:Body><q1:";aq+=this.method;aq+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";aq+=g.amsNetId;aq+="</netId><nPort xsi:type='xsd:int'>";aq+=g.amsPort;aq+="</nPort>";if(this.indexGroup!==undefined){aq+="<indexGroup xsi:type='xsd:unsignedInt'>";aq+=this.indexGroup;aq+="</indexGroup>"}if(this.indexOffset!==undefined){aq+="<indexOffset xsi:type='xsd:unsignedInt'>";aq+=this.indexOffset;aq+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){aq+="<cbRdLen xsi:type='xsd:int'>";aq+=this.reqDescr.readLength;aq+="</cbRdLen>"}if(this.pData&&this.pData.length>0){aq+="<pData xsi:type='xsd:base64Binary'>";aq+=this.pData;aq+="</pData>"}if(this.pwrData&&this.pwrData.length>0){aq+="<pwrData xsi:type='xsd:base64Binary'>";aq+=this.pwrData;aq+="</pwrData>"}aq+="</q1:";aq+=this.method;aq+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",g.serviceUrl,ar,g.serviceUser,g.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(ar===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){ab.parseResponse(e)}};this.xmlHttpReq.send(aq)}else{this.xmlHttpReq.send(aq);ab.parseResponse(e)}if(typeof this.reqDescr.id==="number"){G[this.reqDescr.id]=1}}};return e}function W(at,ar,aq,e){var au;if(typeof at.val==="string"){if(ar==="REAL"||ar==="LREAL"){au=parseFloat(at.val)}else{au=parseInt(at.val,10)}}else{if(typeof at.val==="number"){au=at.val}else{m("TAME library error: Wrong variable type for a numeric variable in write request!");m("TAME library error: Variable type should be number or string, but is "+typeof at.val);m(at);au=0}}if(isNaN(au)){au=0;m("TAME library error: Value of a numeric variable in write request is not a number.");m(at)}if(ab.useCheckBounds===true){if(ar==="LREAL"){if(!isFinite(au)){m("TAME library warning: Limit for LREAL value exceeded!");m("Upper limit: "+Number.MAX_VALUE);m("Lower limit: "+Number.MIN_VALUE);m("value: "+au);m(at)}}else{if(ar==="REAL"){if(au>0){if(au<1.175495e-38){m("TAME library warning: Lower limit for positive REAL value exceeded!");m("limit: 1.175495e-38");m("value: "+au);m(at);au=1.175495e-38}else{if(au>3.402823e+38){m("TAME library warning: Upper limit for positive REAL value exceeded!");m("limit: 3.402823e+38");m("value: "+au);m(at);au=3.402823e+38}}}else{if(au<0){if(au>-1.175495e-38){m("TAME library warning: Upper limit for negative REAL value exceeded!");m("limit: -1.175495e-38");m("value: "+au);m(at);au=-1.175495e-38}else{if(au<-3.402823e+38){m("TAME library warning: Lower limit for negative REAL value exceeded!");m("limit: -3.402823e+38");m("value: "+au);m(at);au=-3.402823e+38}}}}}else{if(au<aq){m("TAME library warning: Lower limit for numeric value exceeded!");m("type: "+ar);m("limit: "+aq);m("value: "+au);m(at);au=aq}else{if(au>e){m("TAME library warning: Upper limit for numeric value exceeded!");m("type: "+ar);m("limit: "+e);m("value: "+au);m(at);au=e}}}}}return au}function aj(at){var e=[],au,aq,ar;if(typeof at.type==="string"){e=at.type.split(".");if(e.length>2){e[1]=e.slice(1).join(".")}}else{m("TAME library error: Could not get the type of the item!");m(at)}return e}function i(aq){var at={},e,ar;ar=ap[aq].subItems;for(e in ar){if(ar[e].type==="USER"){m("TAME library error: Automatic creating of nested structures is not supported (yet)!");at[e]=i(ar[e].dataType)}else{if(ar.hasOwnProperty(e)){at[e]=ar[e].fullType}}}return at}function M(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ah(au,aq){var e=[],at=au.toString(16),ar;while(at.length<aq*2){at="0"+at}for(ar=0;ar<aq;ar++){e[(aq-1)-ar]=((M(at.charCodeAt(ar*2))*16)+M(at.charCodeAt((ar*2)+1)))}return e}function t(aq){var au=0,ax=0,av,e,at,aw,ar;e=Math.abs(aq);if(aq!==0){for(ar=128;ar>-127;ar--){at=e/Math.pow(2,ar);if(at>=2){break}aw=ar;av=at}aw+=127;av=av.toString(2);for(ar=2;ar<25;ar++){au<<=1;if(av.charAt(ar)==="1"){au+=1}}if(av.charAt(25)==="1"){au+=1}ax=aw;ax<<=23;ax+=au;if(aq<0){ax+=2147483648}}return ax}function F(aw){var ar=0,ay=0,at={part1:0,part2:0},az,av,aq,e,ax,au;az=Math.abs(aw);if(aw!==0){for(au=1024;au>=-1023;au--){av=az/Math.pow(2,au);if(av>=2){break}aq=au;ax=av}aq+=1023;ax=ax.toString(2);for(au=2;au<22;au++){ar<<=1;if(ax.charAt(au)==="1"){ar+=1}}if(ax.charAt(au)==="1"){e=true}au++;for(au;au<54;au++){ay<<=1;if(ax.charAt(au)==="1"){ay+=1}}at.part1=aq;at.part1<<=20;at.part1+=ar;if(aw<0){at.part1+=2147483648}at.part2=ay;if(e===true){at.part2+=2147483648}}return at}function N(ar,aq){var e;switch(aq){case"#d":case"#dd":e=ar*86400000;break;case"#h":case"#hh":e=ar*3600000;break;case"#m":case"#mm":e=ar*60000;break;case"#s":case"#ss":e=ar*1000;break;case"#ms":case"#msmsms":e=ar;break;default:e=ar;break}return e}function E(ax,az){var e=az.split("#"),aw=e.length,ay=/:|\.|-|_/,ar=0,aq=0,au,at,av,aA;for(at=1;at<aw;at++){if(ay.test(e[at])===true){aA=true}}if(aA!==true){m("TAME library error: No separator ( : . - _ ) for TOD string found!");m("String: "+ax);m("Format: "+az);return 0}av=ax.split(ay);for(at=1;at<aw;at++){switch(e[at]){case"h":case"hh":au=parseInt(av[aq],10)*3600000;aq++;break;case"m":case"mm":au=parseInt(av[aq],10)*60000;aq++;break;case"s":case"ss":au=parseInt(av[aq],10)*1000;aq++;break;case"ms":case"msmsms":au=parseInt(av[aq],10);aq++;break;default:au=0}ar+=au}return ar}function q(aw){var av=o,at=0,aq="",au,ar,e;while(at<aw.length){au=aw[at++];ar=aw[at++];e=aw[at++];aq=aq+av[au>>2]+av[((au&3)<<4)|(ar>>4)]+(isNaN(ar)?"=":av[(((ar&15)<<2)|(e>>6))])+((isNaN(ar)||isNaN(e))?"=":av[e&63])}return aq}function d(aw,au,av,at){var ay=[],e,ax,aq,ar;if(aw.val===undefined){switch(au){case"STRING":aw.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":aw.val=new Date();break;default:aw.val=0;break}m("TAME library warning: Value of a variable in write request is not defined!");m(aw)}switch(au){case"BOOL":if(aw.val){ay[0]=1}else{ay[0]=0}break;case"BYTE":case"USINT":e=W(aw,au,0,255);ay=ah(e,at);break;case"SINT":e=W(aw,au,-128,127);if(e<0){e=e+256}ay=ah(e,at);break;case"WORD":case"UINT":e=W(aw,au,0,65535);ay=ah(e,at);break;case"INT":case"INT16":e=W(aw,au,-32768,32767);if(e<0){e=e+65536}ay=ah(e,at);break;case"INT1DP":aw.val=Math.round(aw.val*10);e=W(aw,au,-32768,32767);if(e<0){e=e+65536}ay=ah(e,at);break;case"DWORD":case"UDINT":e=W(aw,au,0,4294967295);ay=ah(e,at);break;case"DINT":e=W(aw,au,-2147483648,2147483647);if(e<0){e=e+4294967296}ay=ah(e,at);break;case"REAL":e=W(aw,au);e=t(e);ay=ah(e,at);break;case"LREAL":e=W(aw,au);e=F(e);ay=ah(e.part2,4);ay=ay.concat(ah(e.part1,4));break;case"DATE":if(typeof aw.val==="object"){aw.val.setHours(0);aw.val.setMinutes(0);aw.val.setSeconds(0);e=aw.val.getTime()/1000-aw.val.getTimezoneOffset()*60}else{m("TAME library error: Value of a DATE variable in write request is not a date object!");m(aw)}ay=ah(e,at);break;case"DT":case"DATE_AND_TIME":if(typeof aw.val==="object"){e=aw.val.getTime()/1000-aw.val.getTimezoneOffset()*60}else{m("TAME library error: Value of a DT variable in write request is not a date object!");m(aw)}ay=ah(e,at);break;case"TOD":case"TIME_OF_DAY":if(typeof aw.val==="object"){aw.val.setYear(1970);aw.val.setMonth(0);aw.val.setDate(1);e=aw.val.getTime()-aw.val.getTimezoneOffset()*60000}else{if(typeof aw.val==="string"){if(av===""||av===undefined){av="#hh#:#mm";m("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");m(aw)}e=E(aw.val,av)}else{m("TAME library error: TOD value in write request is wether a date object nor a string!");m(aw)}}ay=ah(e,at);break;case"STRING":ax=(av===undefined)?D.STRING:parseInt(av,10);if(an(ax)){aq=ax<aw.val.length?ax:aw.val.length;for(ar=0;ar<aq;ar++){ay[ar]=aw.val.charCodeAt(ar)}for(ar;ar<ax;ar++){ay[ar]=0}ay[ar]=0}break;case"TIME":e=parseInt(aw.val,10);if(isNaN(e)){m("TAME library warning: Value of a TIME variable in write request is not defined!");m(aw);e=0}e=N(e,av);if(e<0){e=0;m("TAME library warning: Lower limit for TIME variable in write request exceeded!)");m("value: "+aw.val+av);m(aw)}else{if(e>4294967295){e=4294967295;m("TAME library warning: Upper limit for TIME variable in write request exceeded!)");m("value: "+aw.val+av);m(aw)}}ay=ah(e,at);break;case"EndStruct":break;default:m("TAME library error: Unknown data type in write request : "+au);break}return ay}function u(aq){var e=aq.toString(16);if((e.length%2)!==0){e="0"+e}return e}function j(aq,e){e=(isNaN(e))?0:e;var ar=aq.toString(10);while(ar.length<e){ar="0"+ar}return ar}function ao(aw,av){var e=av.split("#"),au=e.length,aq="",at,ar;for(ar=1;ar<au;ar++){switch(e[ar]){case"D":at=aw.getDate();break;case"DD":at=aw.getDate();at=j(at,2);break;case"WD":at=aw.getDay();break;case"WKD":at=ab.dateNames.weekdShort[aw.getDay()];break;case"WEEKDAY":at=ab.dateNames.weekdLong[aw.getDay()];break;case"M":at=aw.getMonth()+1;break;case"MM":at=aw.getMonth()+1;at=j(at,2);break;case"MON":at=ab.dateNames.monthsShort[aw.getMonth()];break;case"MONTH":at=ab.dateNames.monthsLong[aw.getMonth()];break;case"YY":at=aw.getYear();while(at>100){at-=100}break;case"YYYY":at=aw.getFullYear();break;case"h":at=aw.getHours();break;case"hh":at=aw.getHours();at=j(at,2);break;case"m":at=aw.getMinutes();break;case"mm":at=aw.getMinutes();at=j(at,2);break;case"s":at=aw.getSeconds();break;case"ss":at=aw.getSeconds();at=j(at,2);break;case"ms":at=aw.getMilliseconds();break;case"msmsms":at=aw.getMilliseconds();at=j(at,3);break;default:at=e[ar];break}aq=aq+at}return aq}function L(aw,av){var e=av.split("#"),au=e.length,aq="",at,ar;for(ar=1;ar<au;ar++){switch(e[ar]){case"d":if(au<=2){at=aw/86400000}else{at=Math.floor(aw/86400000);aw=aw%86400000}break;case"dd":if(au<=2){at=aw/86400000}else{at=Math.floor(aw/86400000);aw=aw%86400000}at=j(at,2);break;case"h":if(au<=2){at=aw/3600000}else{at=Math.floor(aw/3600000);aw=aw%3600000}break;case"hh":if(au<=2){at=aw/3600000}else{at=Math.floor(aw/3600000);aw=aw%3600000}at=j(at,2);break;case"m":if(au<=2){at=aw/60000}else{at=Math.floor(aw/60000);aw=aw%60000}break;case"mm":if(au<=2){at=aw/60000}else{at=Math.floor(aw/60000);aw=aw%60000}at=j(at,2);break;case"s":if(au<=2){at=aw/1000}else{at=Math.floor(aw/1000);aw=aw%1000}break;case"ss":if(au<=2){at=aw/1000}else{at=Math.floor(aw/1000);aw=aw%1000}at=j(at,2);break;case"ms":at=aw;break;case"msmsms":at=aw;at=j(at,3);break;default:at=e[ar];break}aq=aq+at}return aq}function U(aq){var e=u(aq.charCodeAt(0));return parseInt(e,16)}function ai(e){var aq=U(e);if(aq>127){aq=aq-256}return aq}function Q(aq){var e=u(aq.charCodeAt(1));e+=u(aq.charCodeAt(0));return parseInt(e,16)}function P(e){var aq=Q(e);if(aq>32767){aq=aq-65536}return aq}function I(aq){var e=u(aq.charCodeAt(3));e+=u(aq.charCodeAt(2));e+=u(aq.charCodeAt(1));e+=u(aq.charCodeAt(0));return parseInt(e,16)}function S(e){var aq=I(e);if(aq>2147483647){aq=aq-4294967296}return aq}function Z(e,ar){var aq=I(e);if(ar===undefined){return aq}return(L(aq,ar))}function p(e,ar){var aq=new Date(I(e));aq=new Date(aq.getTime()+aq.getTimezoneOffset()*60000);if(ar===undefined){return aq}return(ao(aq,ar))}function ag(aq,ar){var e=new Date(I(aq)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(ar===undefined){return e}return(ao(e,ar))}function s(ar){var au=1,aw=0.5,aq=I(ar),e,av,at;if(aq===0){return 0}e=((aq>>>31)===1)?"-":"+";aq<<=1;av=(aq>>>24)-127;aq<<=8;for(at=1;at<=23;at++){au+=aq<0?aw:0;aq<<=1;aw/=2}return parseFloat(e+(au*Math.pow(2,av)))}function H(ar){var aq=I(ar.substring(4,8)),av=I(ar.substring(0,4)),au=12,at=1,ax=0.5,e,aw;if(aq===0&&av===0){return 0}e=((aq>>>31)===1)?"-":"+";aq<<=1;aw=(aq>>>21)-1023;aq<<=11;while(au<32){at+=aq<0?ax:0;aq<<=1;ax/=2;au++}if((av>>>31)===1){at+=ax;av<<=1;ax/=2}while(au<64){at+=av<0?ax:0;av<<=1;ax/=2;au++}return parseFloat(e+(at*Math.pow(2,aw)))}function ae(e){return e.split(String.fromCharCode(0))[0]}function T(at){var au=r,aw=0,e="",av,ar,aq,aA,az,ay,ax;at=at.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aA=au[at.charAt(aw++)];az=au[at.charAt(aw++)];ay=au[at.charAt(aw++)];ax=au[at.charAt(aw++)];av=(aA<<2)|(az>>4);ar=((az&15)<<4)|(ay>>2);aq=((ay&3)<<6)|ax;e+=String.fromCharCode(av);if(ay!==64){e+=String.fromCharCode(ar)}if(ax!==64){e+=String.fromCharCode(aq)}}while(aw<at.length);return e}function X(aq,e,at){var ar;switch(e){case"BOOL":ar=(aq.charCodeAt(0)!="0");break;case"BYTE":case"USINT":ar=U(aq);break;case"SINT":ar=ai(aq);break;case"WORD":case"UINT":ar=Q(aq);break;case"INT":case"INT16":ar=P(aq);break;case"INT1DP":ar=((P(aq))/10).toFixed(1);break;case"DWORD":case"UDINT":ar=I(aq);break;case"DINT":ar=S(aq);break;case"REAL":ar=s(aq);if(at!==undefined){ar=ar.toFixed(parseInt(at,10))}break;case"LREAL":ar=H(aq);if(at!==undefined){ar=ar.toFixed(parseInt(at,10))}break;case"STRING":ar=ae(aq);break;case"TOD":case"TIME_OF_DAY":ar=p(aq,at);break;case"TIME":ar=Z(aq,at);break;case"DT":case"DATE":case"DATE_AND_TIME":ar=ag(aq,at);break;case"EndStruct":break;default:m("TAME library error: Unknown data type at parsing read request: "+e);break}return ar}function y(aJ){var aq,aB=aJ.reqDescr.items,az=[],aC=0,aG,at,au,aI,ax,aE,ay,aH,ar,aD,aA,av,aw;try{aq=aJ.xmlHttpReq.responseXML.documentElement;at=T(aq.getElementsByTagName("ppData")[0].firstChild.data);for(aA=0,av=aB.length;aA<av;aA++){aG=aB[aA];az=aj(aG);ar=az[0];aD=az[1];aE=D[ar];switch(ar){case"STRING":if(aD!==undefined){ax=parseInt(aD,10)}aE=(an(ax)?ax:aE)+1;break;case"EndStruct":aE=aG.val;break}ay=aE<a?aE:a;if(aJ.reqDescr.seq!==true){aw=l(aJ.reqDescr);aC=aG.addr-aw}else{if(aJ.reqDescr.calcAlignment===true&&ay>1&&ar!=="EndStruct"&&ar!=="STRING"&&aC>0){aH=aC%ay;if(aH>0){aC+=ay-aH}}}au=at.substr(aC,aE);aI=X(au,ar,aD);if(ar!=="EndStruct"){C(aG.jvar,aI,aJ.reqDescr.dataObj,aG.prefix,aG.suffix)}if(aJ.reqDescr.seq===true){aC+=aE}}}catch(aF){m("TAME library error: Parsing of Read Request failed:"+aF);m(aG);return}}function c(aQ){var aq,aE=aQ.reqDescr.items,aB=[],aI=0,at=0,aG=window,aN=0,aM,av,aw,aP,aK,au,aJ,aC,az,ax,aF,aH,aA,ay,aD;function ar(){var aR,e;if(au==="STRING"){if(aJ!==undefined){aR=parseInt(aJ,10)}else{if(typeof aD.stringLength==="number"){aR=aD.stringLength}}aK=(an(aR)?aR:aK)+1}e=aw.substr(at,aK);aP=X(e,au,aJ);C(aF,aP,aG,aM.prefix,aM.suffix);at+=aK}function aO(){var aS,aR,aW,aV,aT,aU;function e(){var aY,aX;if(a>1&&au!=="STRING"&&au!=="EndStruct"){aY=aK<a?aK:a;if(aY>1&&at>0){aX=at%aY;if(aX>0){at+=aY-aX}}if(aY>aN){aN=aY}}}if(typeof aM.def==="string"){aM.def=C(aM.def)}else{if(f===true&&aM.def===undefined){aM.def=i(aD.dataType)}else{if(typeof aM.def!=="object"){m("TAME library error: No structure defininition found!")}}}for(aU in aM.def){if(aM.def.hasOwnProperty(aU)){aR=aM.def[aU].split(".");if(aR[0]==="ARRAY"){aW=parseInt(aR[1],10);aV=aR.length-1;for(aS=0;aS<aW;aS++){au=aR[2];if(aR[aV]==="SP"){aF=aU+aS;if(aV>=4){aJ=aR.slice(3,-1).join(".")}}else{aF=aU+"."+aS;if(aV>=3){aJ=aR.slice(3).join(".")}}if(aH!==null){aF=aH+"."+aF}aK=D[au];e();ar()}}else{if(aH!==null){aF=aH+"."+aU}else{aF=aU}au=aR[0];if(aR.length>2){aR[1]=aR.slice(1).join(".")}aJ=aR[1];aK=D[au];e();ar()}}}if(a>1&&aN>1&&au!=="STRING"&&au!=="EndStruct"){if(aN>a){aN=a}aT=at%aN;if(aT>0){at+=aN-aT}}}try{aq=aQ.xmlHttpReq.responseXML.documentElement;av=T(aq.getElementsByTagName("ppRdData")[0].firstChild.data);for(aC=0,az=aE.length;aC<az;aC++){aw=av.substr(aI,4);ax=X(aw,"DWORD");if(ax!==0){m("TAME library error: ADS sub command error while processing a SumReadRequest!");m("Error code: "+ax);m(aE[aC])}aI+=4}for(aC=0;aC<az;aC++){aM=aE[aC];aD=al(aM);au=aD.type;aJ=aD.format;ay=aD.size;aH=null;aw=av.substr(aI,ay);switch(au){case"ARRAY":aG=C(aM.jvar);at=0;aA=aD.arrayLength;if(aD.arrayDataType==="USER"){for(aH=0;aH<aA;aH++){aO()}}else{au=aD.arrayDataType;aK=D[au];for(aH=0;aH<aA;aH++){aF=aH;ar()}}break;case"USER":aG=C(aM.jvar);at=0;aO();break;default:aG=window;aP=X(aw,au,aJ);C(aM.jvar,aP,aG,aM.prefix,aM.suffix)}aI+=ay}}catch(aL){m("TAME library error: Parsing of SumReadRequest failed:"+aL);m(aM);return}}function z(aI){var aq,aA=aI.reqDescr.items,ay=[],aC=0,ar=0,aB=window,aG,au,av,aH,aE,at,aD,az,ax,aw;try{aq=aI.xmlHttpReq.responseXML.documentElement;au=T(aq.getElementsByTagName("ppRdData")[0].firstChild.data);for(az=0,ax=aA.length;az<ax;az++){av=au.substr(aC,4);aw=X(av,"DWORD");if(aw!==0){m("TAME library error: ADS sub command error while processing a SumReadRequest!");m("Error code: "+aw);m(aA[az])}aC+=4}}catch(aF){m("TAME library error: Parsing of SumWriteRequest failed:"+aF);m(aG);return}}function ak(at){var aq;try{aq=at.xmlHttpReq.responseXML.documentElement;ab.adsState=parseInt(aq.getElementsByTagName("pAdsState")[0].firstChild.data,10);ab.adsStateTxt=V[ab.adsState];ab.deviceState=parseInt(aq.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(ar){m("TAME library error: Parsing of ADS Read State Request failed:"+ar);return}}function O(aw,av,at){var ar={},au,e,aq;aq=al(at);e=D[av];switch(av){case"STRING":if(an(at.strlen)){av+="."+at.strlen;e=at.strlen}else{if(typeof aq.stringLength==="number"){e=aq.stringLength;av+="."+e}else{m("TAME library error: Could not get the length of the string for this request!");m(at)}}e++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof at.format==="string"){av+="."+at.format}break;case"REAL":case"LREAL":if(typeof at.decPlaces==="number"){av+="."+at.decPlaces}else{if(typeof at.dp==="number"){av+="."+at.dp}}break}ar={addr:at.addr,symbolName:aq.symbolName,dataTypeNames:aq.dataTypeNames,dataTypeArrIdx:aq.dataTypeArrIdx,symbolNameArrIdx:aq.symbolNameArrIdx,id:at.id,oc:at.oc,ocd:at.ocd,readLength:e,debug:at.debug,sync:at.sync,offs:at.offs,seq:true,items:[{val:at.val,jvar:at.jvar,type:av,prefix:at.prefix,suffix:at.suffix}]};if(aw==="Write"){ab.writeReq(ar)}else{ab.readReq(ar)}}function J(at,au,ar){var av={},aH={},aB,aq,aJ=0,aK=0,aI=0,aL,e=[],aN,ax,aA=0,aC,ay,aM=0,aD=0,aP,az,aO,aF,aE;aE=al(ar);if(at==="Write"&&typeof ar.val==="object"){aH=ar.val}else{if(typeof ar.jvar==="string"){aH=C(ar.jvar)}else{m("TAME library error: No data object for this "+at+"-Request defined!")}}if(typeof ar.arrlen==="number"){aB=ar.arrlen}else{if(aE.arrayLength!==undefined){aB=aE.arrayLength}else{m("TAME library error: Can't get the array length for this request!");m(ar)}}if(typeof ar.item==="number"&&!isNaN(ar.item)&&at==="Write"){aO=true;if(ar.item<0||ar.item>aB-1){m('TAME library error: Wrong value for "item"!');m("item: "+ar.item);m("Last array index: "+(aB-1))}}function aw(){var aQ;if(typeof ar.def==="string"){ar.def=C(ar.def)}else{if(f===true&&ar.def===undefined){ar.def=i(aE.dataType)}else{if(typeof ar.def!=="object"){m("TAME library error: No structure definition found!")}}}for(aQ in ar.def){if(ar.def.hasOwnProperty(aQ)){e=ar.def[aQ].split(".");if(e[0]==="ARRAY"){aN=parseInt(e[1],10);e.shift();e.shift()}else{aN=1}for(aK=0;aK<aN;aK++){if(e[0]==="STRING"){if(typeof e[1]==="string"){aC=parseInt(e[1],10)}ay=(an(aC)?aC:D[e[0]])+1}else{ay=D[e[0]]}if(a>1&&ay>1&&e[0]!=="STRING"&&aA>0){aP=aA%ay;if(aP>0){aA+=ay-aP}}aA+=ay}if(a>1&&ay>aM&&e[0]!=="STRING"){aM=ay}}}if(a>1&&aM>1&&e[0]!=="STRING"){if(aM>a){aM=a}aP=aA%aM;if(aP>0){aD=aM-aP;aA+=aD}}if(aO){aq=aA*ar.item;aB=1}av={addr:ar.addr,symbolName:aE.symbolName,dataTypeNames:aE.dataTypeNames,addrOffset:aq,id:ar.id,oc:ar.oc,ocd:ar.ocd,debug:ar.debug,readLength:aA*aB,seq:true,calcAlignment:true,dataObj:aH,sync:ar.sync,offs:ar.offs,items:[]};for(aK=0;aK<aB;aK++){for(aQ in ar.def){if(ar.def.hasOwnProperty(aQ)){e=ar.def[aQ].split(".");if(e[0]==="ARRAY"){aN=parseInt(e[1],10);ax=e.length-1;for(aI=0;aI<aN;aI++){if(e[ax]==="SP"){av.items[aJ]={jvar:aK+"."+aQ+aI};if(ax===4){av.items[aJ].type=e[2]+"."+e[3]}else{av.items[aJ].type=e[2]}}else{av.items[aJ]={jvar:aK+"."+aQ+"."+aI};if(ax===3){av.items[aJ].type=e[2]+"."+e[3]}else{av.items[aJ].type=e[2]}}if(at==="Write"){if(aO){if(e[ax]==="SP"){av.items[aJ].val=aH[ar.item][aQ+aI]}else{av.items[aJ].val=aH[ar.item][aQ][aI]}}else{if(e[ax]==="SP"){av.items[aJ].val=aH[aK][aQ+aI]}else{av.items[aJ].val=aH[aK][aQ][aI]}}}aJ++}}else{av.items[aJ]={jvar:aK+"."+aQ,type:ar.def[aQ]};if(at==="Write"){if(aO){av.items[aJ].val=aH[ar.item][aQ]}else{av.items[aJ].val=aH[aK][aQ]}}aJ++}}}if(a>1){av.items[aJ]={type:"EndStruct",val:aD};aJ++}}}function aG(){aL=D[au];switch(au){case"STRING":if(an(ar.strlen)){au+="."+ar.strlen;aL=ar.strlen}else{if(typeof aE.stringLength==="number"){aL=aE.stringLength;au+="."+aL}else{m("TAME library error: Could not get the length of the string for this request!");m(ar)}}aL++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof ar.format==="string"){au+="."+ar.format}break;case"REAL":case"LREAL":if(typeof ar.decPlaces==="number"){au+="."+ar.decPlaces}else{if(typeof ar.dp==="number"){au+="."+ar.dp}}break}if(aO){aq=ar.item*aL;aB=1}av={addr:ar.addr,symbolName:aE.symbolName,dataTypeNames:aE.dataTypeNames,dataTypeArrIdx:aE.dataTypeArrIdx,symbolNameArrIdx:aE.symbolNameArrIdx,addrOffset:aq,id:ar.id,oc:ar.oc,ocd:ar.ocd,readLength:aL*aB,debug:ar.debug,seq:true,dataObj:aH,items:[]};for(aK=0;aK<aB;aK++){av.items[aK]={jvar:aK,type:au};if(at==="Write"){if(aO){av.items[aK].val=aH[ar.item]}else{av.items[aK].val=aH[aK]}}}}if(au==="STRUCT"){aw()}else{aG()}if(at==="Write"){ab.writeReq(av)}else{ab.readReq(av)}}function ad(e,az){var aw={},aq={},aA=[],au=0,ay,at,av,ax,ar;ar=al(az);if(e==="Write"&&typeof az.val==="object"){aq=az.val}else{if(typeof az.jvar==="string"){aq=C(az.jvar)}else{m("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof az.def==="string"){az.def=C(az.def)}else{if(f===true&&az.def===undefined){az.def=i(ar.dataType)}else{if(typeof az.def!=="object"){m("TAME library error: No structure defininition found!")}}}aw={addr:az.addr,symbolName:ar.symbolName,dataTypeNames:ar.dataTypeNames,dataTypeArrIdx:ar.dataTypeArrIdx,symbolNameArrIdx:ar.symbolNameArrIdx,id:az.id,oc:az.oc,ocd:az.ocd,debug:az.debug,seq:true,calcAlignment:true,dataObj:aq,sync:az.sync,offs:az.offs,items:[]};for(av in az.def){if(az.def.hasOwnProperty(av)){aA=az.def[av].split(".");if(aA[0]==="ARRAY"){at=parseInt(aA[1],10);ay=aA.length-1;for(ax=0;ax<at;ax++){if(aA[ay]==="SP"){aw.items[au]={jvar:av+ax};if(ay===4){aw.items[au].type=aA[2]+"."+aA[3]}else{aw.items[au].type=aA[2]}}else{aw.items[au]={jvar:av+"."+ax};if(ay===3){aw.items[au].type=aA[2]+"."+aA[3]}else{aw.items[au].type=aA[2]}}if(e==="Write"){if(aA[ay]==="SP"){aw.items[au].val=aq[av+ax]}else{aw.items[au].val=aq[av][ax]}}au++}}else{aw.items[au]={jvar:av,type:az.def[av]};if(e==="Write"){aw.items[au].val=aq[av]}au++}}}if(e==="Write"){ab.writeReq(aw)}else{ab.readReq(aw)}}this.writeReq=function(at){var av=at.items,aC={},e=[],ay=[],aF=[],ax,aB,ar,aw,aq,aD,az,aE,au,aA;if(typeof at.name==="string"){at.name=at.name.toUpperCase()}for(aA=0,ar=av.length;aA<ar;aA++){aE=av[aA];ay=aj(aE);ax=ay[0];aB=ay[1];if(isNaN(D[ax])){m("TAME library error: Could not get the length of the data type: "+ax);m("TAME library error: Probably wrong type definition. Please check the manual.");m(at);return}aw=(D[ax]<a)?D[ax]:a;if(at.calcAlignment===true&&aw>1&&ax!=="STRING"&&ax!=="EndStruct"&&e.length>0){az=e.length%aw;if(az>0){aD=aw-az;for(au=1;au<=aD;au++){e.push(0)}}}if(ax==="EndStruct"){for(au=1;au<=aE.val;au++){e.push(0)}}else{aF=d(aE,ax,aB,D[ax]);e=e.concat(aF)}}if(e&&e.length>0){e=q(e)}aC={method:"Write",indexGroup:A(at),indexOffset:l(at),pData:e,reqDescr:at};w(aC).send()};this.readReq=function(ar){var aA={},at=ar.items,av=[],aB,az,au,e,aw,ax,aC,ay,aq;if(typeof ar.readLength!=="number"){ar.readLength=0;for(ay=0,e=at.length;ay<e;ay++){aB=at[ay];av=aj(aB);au=av[0];az=av[1];if(isNaN(D[au])){m("TAME library error: Could not get the length of the data type: "+au);m("TAME library error: Probably wrong type definition. Please check the manual.");m(ar);return}if(au==="STRING"){if(typeof az==="string"){aC=parseInt(az,10)}ax=(an(aC)?aC:D[au])+1}else{ax=D[au]}if(ar.seq===true){if(ar.calcAlignment===true&&ax>1&&au!=="EndStruct"&&au!=="STRING"&&ar.readLength>0){aw=ar.readLength%ax;if(aw>0){ar.readLength+=ax-aw}}ar.readLength+=ax}else{aq=l(ar);ar.readLength=ax+aB.addr-aq}}}aA={method:"Read",indexGroup:A(ar),indexOffset:l(ar),reqDescr:ar};w(aA).send()};this.sumReadReq=function(at){var aB={},av=at.items,ay=[],aD=[],aE=[],ar=av.length,au={},ax,aA,aC,az,aw,e,aq;at.readLength=ar*4;for(az=0;az<ar;az++){aC=av[az];aq=al(aC);aw=aq.size;at.readLength+=aw;au.val=A(aq);aE=d(au,"UDINT",aA,4);aD=aD.concat(aE);au.val=l(aq);aE=d(au,"UDINT",aA,4);aD=aD.concat(aE);au.val=aw;aE=d(au,"UDINT",aA,4);aD=aD.concat(aE)}if(aD.length>0){e=q(aD)}aB={method:"ReadWrite",indexGroup:n.SumRd,indexOffset:av.length,pwrData:e,reqDescr:at};w(aB).send()};this.sumWriteReq=function(at){var aM={},aA=at.items,aw=[],aq=[],ay=[],au=aA.length,aJ={},aH=0,ar,aE,aG,ax,aF,aL,aD,aC,av,aI,e,az;function aB(){var aN;aF=D[ar];if(ar==="STRING"){if(aE!==undefined){aN=parseInt(aE,10)}else{if(typeof az.stringLength==="number"){aN=az.stringLength}}aE=(an(aN)?aN:aF)}}function aK(){var aQ,aV,aN,aR,aT,aO,aP=[];function aU(){var aX,aW;if(a>1&&ar!=="STRING"&&ar!=="EndStruct"){aX=aF<a?aF:a;if(aX>1&&aP.length>0){aT=aP.length%aX;if(aT>0){e=aX-aT;for(aW=1;aW<=e;aW++){aP.push(0)}}}if(aX>aH){aH=aX}}}if(typeof aG.def==="string"){aG.def=C(aG.def)}else{if(f===true&&aG.def===undefined){aG.def=i(az.dataType)}else{if(typeof aG.def!=="object"){m("TAME library error: No structure defininition found!")}}}for(aO in aG.def){if(aG.def.hasOwnProperty(aO)){try{aV=aG.def[aO].split(".");if(aV[0]==="ARRAY"){aN=parseInt(aV[1],10);aR=aV.length-1;for(aQ=0;aQ<aN;aQ++){ar=aV[2];if(aV[aR]==="SP"){if(aR>=4){aE=aV.slice(3,-1).join(".")}}else{if(aR>=3){aE=aV.slice(3).join(".")}}if(aD!==null){if(aV[aR]==="SP"){aJ.val=aG.val[aD][aO+aQ]}else{aJ.val=aG.val[aD][aO][aQ]}}else{aJ.val=aG.val[aO][aQ]}aB();aU();ay=d(aJ,ar,aE,aF);aP=aP.concat(ay)}}else{if(aD!==null){aJ.val=aG.val[aD][aO]}else{aJ.val=aG.val[aO]}ar=aV[0];if(aV.length>2){aV[1]=aV.slice(1).join(".")}aE=aV[1];aB();aU();ay=d(aJ,ar,aE,aF);aP=aP.concat(ay)}}catch(aS){m("TAME library error: Could not set values for a structure in SumWriteReq: "+aS);m(aG)}}}if(a>1&&aH>1&&aV[0]!=="STRING"&&aV[0]!=="EndStruct"){aT=aP.length%aH;if(aT>0){e=aH-aT;for(aC=1;aC<=e;aC++){aP.push(0)}}}aq=aq.concat(aP)}at.readLength=au*4;for(ax=0;ax<au;ax++){aG=aA[ax];az=al(aG);ar=az.type;aE=az.format;aF=az.size;aJ.val=A(az);ay=d(aJ,"UDINT",aE,4);aq=aq.concat(ay);aJ.val=l(az);ay=d(aJ,"UDINT",aE,4);aq=aq.concat(ay);aJ.val=aF;ay=d(aJ,"UDINT",aE,4);aq=aq.concat(ay)}for(ax=0;ax<au;ax++){aG=aA[ax];az=al(aG);ar=az.type;aE=az.format;aF=az.size;aD=null;switch(ar){case"ARRAY":av=parseInt(az.arrayLength,10);if(av!==aG.val.length){m("TAME library error: Array length in JS differs from the length in the PLC!");m("Length in JS: "+aG.val.length);m("Length in PLC: "+av);m(aG);return}if(az.arrayDataType==="USER"){for(aD=0;aD<av;aD++){aK()}}else{ar=az.arrayDataType;if(ar==="STRING"){aE=az.stringLength}else{aF=az.itemSize}for(aD=0;aD<av;aD++){aJ.val=aG.val[aD];ay=d(aJ,ar,aE,aF);aq=aq.concat(ay)}}break;case"USER":aK();break;default:if(ar==="STRING"){aE=az.stringLength}else{aF=az.size}ay=d(aG,ar,aE,aF);aq=aq.concat(ay)}}if(aq.length>0){aL=q(aq)}aM={method:"ReadWrite",indexGroup:n.SumWr,indexOffset:aA.length,pwrData:aL,reqDescr:at};w(aM).send()};this.readAdsState=function(e){var aq={method:"ReadState",reqDescr:e};w(aq).send()};this.logSymbols=function(){m(R)};this.logDataTypes=function(){m(ap)};this.getSymbolsAsJSON=function(){var ar;if(typeof JSON!=="object"){m("TAME library error: No JSON parser found.")}else{try{ar=JSON.stringify(R);return ar}catch(aq){m("TAME library error: Could not convert the Symbol Table to JSON:"+aq)}}};this.setSymbolsFromJSON=function(ar){if(typeof JSON!=="object"){m("TAME library error: No JSON parser found.")}else{try{R=JSON.parse(ar)}catch(aq){m("TAME library error: Could not create the Symbol Table from JSON:"+aq);return}k=true;m("TAME library info: Symbol Table successfully created from JSON data.")}};this.getDataTypesAsJSON=function(){var ar;if(typeof JSON!=="object"){m("TAME library error: No JSON parser found.")}else{try{ar=JSON.stringify(ap);return ar}catch(aq){m("TAME library error: Could not convert the Data Type Table to JSON:"+aq)}}};this.setDataTypesFromJSON=function(ar){if(typeof JSON!=="object"){m("TAME library error: No JSON parser found.")}else{try{ap=JSON.parse(ar)}catch(aq){m("TAME library error: Could not create the Data Type Table from JSON:"+aq);return}f=true;m("TAME library info: Data Type Table successfully created from JSON data.")}};this.parseResponse=function(aw){var ar,av,aq;if(typeof aw.reqDescr.id==="number"){G[aw.reqDescr.id]=0}if(aw.xmlHttpReq.responseXML===null){m('TAME library error: Request contains no XML data. Object "responseXML" is null.');m('TAME library error: This is the "responseText":');m(aw.xmlHttpReq.responseText)}try{ar=aw.xmlHttpReq.responseXML.documentElement}catch(au){m("TAME library error: No XML data in server response:"+au);return}try{aq=ar.getElementsByTagName("faultstring")[0].firstChild.data;try{av=ar.getElementsByTagName("errorcode")[0].firstChild.data}catch(au){av="-"}m("TAME library error: Message from server:  "+aq+" ("+av+")");return}catch(at){av=0}if(typeof ar.normalize==="function"){ar.normalize()}if(aw.method==="ReadState"){ak(aw)}else{if(aw.method==="Read"||aw.method==="ReadWrite"){switch(aw.indexGroup){case n.UploadInfo:Y(aw);break;case n.Upload:af(aw);break;case n.SumRd:c(aw);break;case n.SumWr:z(aw);break;default:y(aw)}}}if(typeof aw.reqDescr.oc==="function"){if(typeof aw.reqDescr.ocd==="number"){window.setTimeout(aw.reqDescr.oc,aw.reqDescr.ocd)}else{aw.reqDescr.oc()}}};this.writeBool=function(e){O("Write","BOOL",e)};this.writeByte=function(e){O("Write","BYTE",e)};this.writeUsint=function(e){O("Write","USINT",e)};this.writeSint=function(e){O("Write","SINT",e)};this.writeWord=function(e){O("Write","WORD",e)};this.writeUint=function(e){O("Write","UINT",e)};this.writeInt=function(e){O("Write","INT",e)};this.writeInt1Dp=function(e){O("Write","INT1DP",e)};this.writeDword=function(e){O("Write","DWORD",e)};this.writeUdint=function(e){O("Write","UDINT",e)};this.writeDint=function(e){O("Write","DINT",e)};this.writeReal=function(e){O("Write","REAL",e)};this.writeLreal=function(e){O("Write","LREAL",e)};this.writeString=function(e){O("Write","STRING",e)};this.writeTime=function(e){O("Write","TIME",e)};this.writeTod=function(e){O("Write","TOD",e)};this.writeDate=function(e){O("Write","DATE",e)};this.writeDt=function(e){O("Write","DT",e)};this.readBool=function(e){O("Read","BOOL",e)};this.readByte=function(e){O("Read","BYTE",e)};this.readUsint=function(e){O("Read","USINT",e)};this.readSint=function(e){O("Read","SINT",e)};this.readWord=function(e){O("Read","WORD",e)};this.readUint=function(e){O("Read","UINT",e)};this.readInt=function(e){O("Read","INT",e)};this.readInt1Dp=function(e){O("Read","INT1DP",e)};this.readDword=function(e){O("Read","DWORD",e)};this.readUdint=function(e){O("Read","UDINT",e)};this.readDint=function(e){O("Read","DINT",e)};this.readReal=function(e){O("Read","REAL",e)};this.readLreal=function(e){O("Read","LREAL",e)};this.readString=function(e){O("Read","STRING",e)};this.readTime=function(e){O("Read","TIME",e)};this.readTod=function(e){O("Read","TOD",e)};this.readDate=function(e){O("Read","DATE",e)};this.readDt=function(e){O("Read","DT",e)};this.writeStruct=function(e){ad("Write",e)};this.readStruct=function(e){ad("Read",e)};this.writeArrayOfBool=function(e){J("Write","BOOL",e)};this.writeArrayOfByte=function(e){J("Write","BYTE",e)};this.writeArrayOfUsint=function(e){J("Write","USINT",e)};this.writeArrayOfSint=function(e){J("Write","SINT",e)};this.writeArrayOfWord=function(e){J("Write","WORD",e)};this.writeArrayOfUint=function(e){J("Write","UINT",e)};this.writeArrayOfInt=function(e){J("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){J("Write","INT1DP",e)};this.writeArrayOfDword=function(e){J("Write","DWORD",e)};this.writeArrayOfUdint=function(e){J("Write","UDINT",e)};this.writeArrayOfDint=function(e){J("Write","DINT",e)};this.writeArrayOfReal=function(e){J("Write","REAL",e)};this.writeArrayOfLreal=function(e){J("Write","LREAL",e)};this.writeArrayOfString=function(e){J("Write","STRING",e)};this.writeArrayOfTime=function(e){J("Write","TIME",e)};this.writeArrayOfTod=function(e){J("Write","TOD",e)};this.writeArrayOfDate=function(e){J("Write","DATE",e)};this.writeArrayOfDt=function(e){J("Write","DT",e)};this.writeArrayOfStruct=function(e){J("Write","STRUCT",e)};this.readArrayOfBool=function(e){J("Read","BOOL",e)};this.readArrayOfByte=function(e){J("Read","BYTE",e)};this.readArrayOfUsint=function(e){J("Read","USINT",e)};this.readArrayOfSint=function(e){J("Read","SINT",e)};this.readArrayOfWord=function(e){J("Read","WORD",e)};this.readArrayOfUint=function(e){J("Read","UINT",e)};this.readArrayOfInt=function(e){J("Read","INT",e)};this.readArrayOfInt1Dp=function(e){J("Read","INT1DP",e)};this.readArrayOfDword=function(e){J("Read","DWORD",e)};this.readArrayOfUdint=function(e){J("Read","UDINT",e)};this.readArrayOfDint=function(e){J("Read","DINT",e)};this.readArrayOfReal=function(e){J("Read","REAL",e)};this.readArrayOfLreal=function(e){J("Read","LREAL",e)};this.readArrayOfString=function(e){J("Read","STRING",e)};this.readArrayOfTime=function(e){J("Read","TIME",e)};this.readArrayOfTod=function(e){J("Read","TOD",e)};this.readArrayOfDate=function(e){J("Read","DATE",e)};this.readArrayOfDt=function(e){J("Read","DT",e)};this.readArrayOfStruct=function(e){J("Read","STRUCT",e)};function ac(){var e={method:"Read",sync:true,indexGroup:n.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};w(e).send()}function Y(aw){var aq,ar,ax,au,at;try{aq=aw.xmlHttpReq.responseXML.documentElement;ar=T(aq.getElementsByTagName("ppData")[0].firstChild.data);ax=ar.substr(0,4);b=X(ax,"DWORD");ax=ar.substr(4,4);x=X(ax,"DWORD")}catch(av){m("TAME library error: Parsing of UploadInfo failed:"+av);return}at={method:"Read",sync:true,indexGroup:n.Upload,indexOffset:0,reqDescr:{readLength:x}};w(at).send()}function af(aI){var aq,aA=0,aF=4,aC=8,ay=12,av=30,au,aw,aH,az,aB,ar,aG,ax,at,aE;try{aq=aI.xmlHttpReq.responseXML.documentElement;au=T(aq.getElementsByTagName("ppData")[0].firstChild.data);for(az=0;az<b;az++){aw=au.substr(aA,4);aB=X(aw,"DWORD");ar=au.substring(aA+av,(aA+aB)).split(String.fromCharCode(0));name=ar[0].toUpperCase();R[name]={typeString:ar[1],indexGroup:X(au.substr(aA+aF,4),"DWORD"),indexOffset:X(au.substr(aA+aC,4),"DWORD"),size:X(au.substr(aA+ay,4),"DWORD")};aG=ar[1].split(" ");if(aG[0]==="ARRAY"){R[name].type=aG[0];ax=aG[1].substring(1,aG[1].length-1);ax=ax.split("..");R[name].arrStartIdx=parseInt(ax[0],10);ax=parseInt(ax[1],10)-parseInt(ax[0],10)+1;R[name].arrayLength=ax;at=aG[3].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[name].fullType=aG[0]+"."+ax+"."+at[0]+"."+at[1];R[name].stringLength=parseInt(at[1],10)}else{R[name].fullType=aG[0]+"."+ax+"."+at[0]}R[name].itemSize=R[name].size/ax;R[name].arrayDataType="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(at[0]===aE){R[name].arrayDataType=at[0]}}}if(R[name].arrayDataType==="USER"){R[name].dataType=at[0]}}else{at=aG[0].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[name].fullType=at[0]+"."+at[1];R[name].stringLength=parseInt(at[1],10)}else{R[name].fullType=at[0]}R[name].type="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(at[0]===aE){R[name].type=at[0]}}}if(R[name].type==="USER"){R[name].dataType=at[0]}}aA+=aB}k=true;m("TAME library info: End of fetching the symbols.");m("TAME library info: Symbol table ready.")}catch(aD){m("TAME library error: Parsing of uploaded symbol information failed:"+aD);return}}function K(){var ay=aa(),ax=[],aC,aI,az,aG,av,aq,aE,aw;ay.open("GET",g.configFileUrl,false);ay.setRequestHeader("Content-Type","text/xml");ay.send(null);m("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aC=(new DOMParser()).parseFromString(ay.responseText,"text/xml")}catch(aD){m("TAME library error: Creating a DOM object from TPY failed:"+aD);return}}else{m("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(typeof g.amsNetId!=="string"||typeof g.amsPort!=="string"||a===0){m("TAME library info: Start reading the service information from the TPY file.");try{B={netId:aC.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:aC.getElementsByTagName("Port")[0].childNodes[0].nodeValue};aw=aC.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(aw==="2"){B.alignment=parseInt(aC.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(aw==="3"){B.alignment=8}else{m("TAME library error: Could not determine the TwinCAT version.")}}m("TAME library info: End of reading the service information from the TPY file.")}catch(aD){m("TAME library error: An error occured while reading service information from the TPY file:");m(aD)}}else{m("TAME library info: NetId, port and alignment manually set. Skip reading the service information from the TPY file.")}if(g.forceUploadUsage!==true){m("TAME library info: Start reading the symbols from the TPY file.");try{az=aC.getElementsByTagName("Symbols")[0];ax=az.getElementsByTagName("Symbol");for(var aB=0;aB<ax.length;aB++){aI=ax[aB].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();R[aI]={typeString:ax[aB].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(ax[aB].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(ax[aB].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(ax[aB].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};R[aI].size=(R[aI].bitSize>=8)?R[aI].bitSize/8:R[aI].bitSize;aG=R[aI].typeString.split(" ");if(aG[0]==="ARRAY"){R[aI].type=aG[0];av=aG[1].substring(1,aG[1].length-1);av=av.split("..");R[aI].arrStartIdx=parseInt(av[0],10);av=parseInt(av[1],10)-parseInt(av[0],10)+1;R[aI].arrayLength=av;aq=aG[3].split("(");if(aq[1]!==undefined){aq[1]=aq[1].substr(0,aq[1].length-1);R[aI].fullType=aG[0]+"."+av+"."+aq[0]+"."+aq[1];R[aI].stringLength=parseInt(aq[1],10)}else{R[aI].fullType=aG[0]+"."+av+"."+aq[0]}R[aI].itemSize=R[aI].size/av;R[aI].arrayDataType="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(aq[0]===aE){R[aI].arrayDataType=aq[0]}}}if(R[aI].arrayDataType==="USER"){R[aI].dataType=aq[0]}}else{aq=aG[0].split("(");if(aq[1]!==undefined){aq[1]=aq[1].substr(0,aq[1].length-1);R[aI].fullType=aq[0]+"."+aq[1];R[aI].stringLength=parseInt(aq[1],10)}else{R[aI].fullType=aq[0]}R[aI].type="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(aq[0]===aE){R[aI].type=aq[0]}}}if(R[aI].type==="USER"){R[aI].dataType=aq[0]}}}k=true;m("TAME library info: End of reading the symbols from the TPY file.");m("TAME library info: Symbol table ready.")}catch(aD){m("TAME library error: An error occured while parsing the symbol file:");m(aD)}}else{m("TAME library info: Reading the symbols from the TPY file is deactivated.")}var au,aF,ar,at,aH;if(true){m("TAME library info: Start reading the data types from the TPY file.");try{au=aC.getElementsByTagName("DataTypes")[0];aF=au.getElementsByTagName("DataType");for(var aB=0;aB<aF.length;aB++){aH=aF[aB].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aI=aH.split(" ")[0];if(aI==="ARRAY"){ap[aH]={bitSize:parseInt(aF[aB].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};ap[aH].size=ap[aH].bitSize/8}}for(var aB=0;aB<aF.length;aB++){aH=aF[aB].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aI=aH.split(" ")[0];if(aI!=="ARRAY"){ap[aI]={bitSize:parseInt(aF[aB].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};ap[aI].size=ap[aI].bitSize/8;ar=aF[aB].getElementsByTagName("SubItem");for(var aA=0;aA<ar.length;aA++){at=ar[aA].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ap[aI].subItems[at]={typeString:ar[aA].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:ar[aA].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(ar[aA].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(ar[aA].getElementsByTagName("BitOffs")[0]!==undefined){ap[aI].subItems[at].bitOffset=parseInt(ar[aA].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}ap[aI].subItems[at].size=(ap[aI].subItems[at].bitSize>=8)?ap[aI].subItems[at].bitSize/8:ap[aI].subItems[at].bitSize;aG=ap[aI].subItems[at].typeString.split(" ");if(aG[0]==="ARRAY"){ap[aI].subItems[at].type=aG[0];av=aG[1].substring(1,aG[1].length-1);av=av.split("..");ap[aI].subItems[at].arrStartIdx=parseInt(av[0],10);av=parseInt(av[1],10)-parseInt(av[0],10)+1;ap[aI].subItems[at].arrayLength=av;aq=aG[3].split("(");if(aq[1]!==undefined){aq[1]=aq[1].substr(0,aq[1].length-1);ap[aI].subItems[at].fullType=aG[0]+"."+av+"."+aq[0]+"."+aq[1];ap[aI].subItems[at].stringLength=parseInt(aq[1],10)}else{ap[aI].subItems[at].fullType=aG[0]+"."+av+"."+aq[0]}ap[aI].subItems[at].bitSize=ap[ap[aI].subItems[at].typeString].bitSize;ap[aI].subItems[at].size=ap[ap[aI].subItems[at].typeString].size;ap[aI].subItems[at].itemSize=ap[aI].subItems[at].size/av;ap[aI].subItems[at].arrayDataType="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(aq[0]===aE){ap[aI].subItems[at].arrayDataType=aq[0]}}}if(ap[aI].subItems[at].arrayDataType==="USER"){ap[aI].subItems[at].dataType=aq[0]}}else{aq=aG[0].split("(");if(aq[1]!==undefined){aq[1]=aq[1].substr(0,aq[1].length-1);ap[aI].subItems[at].fullType=aq[0]+"."+aq[1];ap[aI].subItems[at].stringLength=parseInt(aq[1],10)}else{ap[aI].subItems[at].fullType=aq[0]}ap[aI].subItems[at].type="USER";for(aE in D){if(D.hasOwnProperty(aE)){if(aq[0]===aE){ap[aI].subItems[at].type=aq[0]}}}if(ap[aI].subItems[at].type==="USER"){ap[aI].subItems[at].dataType=aq[0]}}}}}f=true;m("TAME library info: End of reading the data types from the TPY file.");m("TAME library info: Data type table ready.")}catch(aD){m("TAME library error: An error occured while creating the data type information:");m("Type: "+aH);m("SubItem: "+at);m(aD)}}}function v(){if(typeof g.amsNetId!=="string"){g.amsNetId=B.netId;m("TAME library info: No NetId definition found. NetId from TPY file is used.")}if(typeof g.amsPort!=="string"){g.amsPort=B.port;m("TAME library info: No AMS port definition found. Port number from TPY file is used.")}if(a===0){if(B.alignment!==undefined){a=B.alignment;m("TAME library info: No alignment parameter found. Alignment from TPY file is used.")}else{a=1;m("TAME library warning: Can't get a value for the data aligment. Default value for alignment is used (1). This works only with TC2 and x86 processors.")}}if(a!==1&&a!==4&&a!==8){m("TAME library warning: The value for the alignment should be 1, 4 or 8.")}m("TAME library info: Target information: NetId: "+g.amsNetId+", AMS port: "+g.amsPort+" , alignment: "+a)}if(g.dontFetchSymbols===true){m("TAME library info: Reading of the UploadInfo and the TPY file deactivated. Symbol Table could not be created.")}else{if(typeof g.configFileUrl=="string"){m("TAME library info: Fetching the TPY file from the webserver.");K()}v();if(typeof g.configFileUrl!="string"||g.forceUploadUsage===true){m("TAME library info: Start fetching the symbols from PLC.");try{ac()}catch(am){m("TAME library error: Could'nt fetch the symbol information from the PLC:"+am);return}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};