/*!
 * TAME [TwinCAT ADS Made Easy] V3.6 beta
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={version:"3.6 beta",weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(f){function k(at){try{window.console.log(at)}catch(au){alert(at)}}var ac=this,al="TAME V3.6 beta",l={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,HandleByName:61443,ValueByHandle:61445,ReleaseHandle:61446,SumRd:61568,SumWr:61569,SumRdWr:61570},C={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},V=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],g=(typeof f.language==="string")?f.language:"ge",m=(function(){var e={},au="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at;for(at=0;at<au.length;at++){e[at]=au.charAt(at)}return e}()),p=(function(){var e={},au="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",at;for(at=0;at<au.length;at++){e[au.charAt(at)]=at}return e}()),a=0,F=[0],R={},ar={},A={},b=0,w=0,O={},s=[];k("TAME library version: "+TAME.version);if(typeof f.serviceUrl!=="string"){k("TAME library error: Service URL is not a string!");return}if(typeof f.amsNetId!=="string"&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){k("TAME library error: NetId is not defined and there is no URL for fetching the TPY file or fetching the symbols is deactivated!");return}if(f.amsPort===undefined&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){f.amsPort="801";k("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof f.amsPort==="number"){k("TAME library warning: AMS port number is not a string! Trying to convert it.");f.amsPort=f.amsPort.toString(10)}}if(parseInt(f.amsPort,10)<801||parseInt(f.amsPort,10)>891){k("TAME library error: AMS Port Number ("+parseInt(f.amsPort,10)+") is out of range (801-891)!");return}if(f.dataAlign4===true){a=4}else{if(f.alignment===undefined&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){a=1}else{if(typeof f.alignment==="string"){a=parseInt(f.alignment,10)}else{if(typeof f.alignment==="number"){a=f.alignment}}}}if(f.syncXmlHttp===true){k('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests will be used by default.')}if(typeof f.serviceUser==="string"&&typeof f.servicePassword==="string"){k("TAME library info: Username and password set. Authenticated requests will be used.")}else{f.serviceUser=null;f.servicePassword=null}if(f.useHandles===true){k('TAME library info: The "useHandles" parameter was set. Handles will be used for all requests.')}this.dateNames={weekdShort:TAME.weekdShortNames[g],weekdLong:TAME.weekdLongNames[g],monthsShort:TAME.monthsShortNames[g],monthsLong:TAME.monthsLongNames[g]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;this.symTableReady=false;this.dataTypeTableReady=false;this.handleCacheReady=false;function B(e,av,au,ax,aA){var aw=[],az=0,ay=[],at=0;if(typeof e==="number"){aw[0]=e.toString(10)}else{if(typeof e==="string"){aw=e.split(".")}else{k("TAME library error: Can't parse name of object/variable. Name is not a string or number!");k(e);return}}if(au===undefined){au=window}az=aw.length-1;while(at<az){if(aw[at].charAt(aw[at].length-1)==="]"){ay=aw[at].substring(0,aw[at].length-1).split("[");au=au[ay[0]][ay[1]]}else{if(au[aw[at]]===undefined){au[aw[at]]=[]}au=au[aw[at]]}at++}if(aw[at].charAt(aw[at].length-1)==="]"){ay=aw[at].substring(0,aw[at].length-1).split("[");au=au[ay[0]];if(av!==undefined){if(typeof ax==="string"){av=ax+av}if(typeof aA==="string"){av=av+aA}au[ay[1]]=av}return au[ay[1]]}if(av!==undefined){if(typeof ax==="string"){av=ax+av}if(typeof aA==="string"){av=av+aA}au[aw[at]]=av}return au[aw[at]]}function ap(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=ac.maxStringLen){return true}k("TAME library error: User defined string length not valid! length: "+e);k("Max. string length: "+ac.maxStringLen);return false}function z(au){var at;if(au.addr){if(typeof au.addr==="string"&&au.addr.charAt(0)==="%"){if(au.addr.charAt(2)==="X"){at=l[au.addr.substr(1,2)]}else{at=l[au.addr.substr(1,1)]}}else{k('TAME library error: Wrong address definition, should be a string and start with "%"!');k(au);return}}else{if(au.useHandle===true||f.useHandles===true){at=l.ValueByHandle}else{if(au.symbolName){if(typeof au.symbolName==="string"){try{at=R[au.symbolName].indexGroup}catch(av){k("TAME library error: Can't get the IndexGroup for this request!");k("TAME library error: Please check the variable name.");k(av);k(au);return}}else{k("TAME library error: Varible name should be a string!");k(au);return}}else{k("TAME library error: No name, address or handle for the variable/request defined!");k(au);return}}}if(isNaN(at)){k("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");k(au)}return at}function j(az){var aw,au="",ay=[],av,aB,at,aA,aD,aC;if(az.addr){if(typeof az.addr==="string"&&az.addr.charAt(0)==="%"){if(az.addr.charAt(2)==="X"){au=az.addr.substr(3);ay=au.split(".");aw=parseInt(ay[0],10)*8+parseInt(ay[1],10)}else{aw=parseInt(az.addr.substr(3),10);if(typeof az.addrOffset==="number"){aw+=az.addrOffset}}}else{k('TAME library error: Wrong address definition, should be a string and start with "%"!');k(az);return}}else{if(az.useHandle===true||f.useHandles===true){if(ac.handleCacheReady===true){aw=O[az.fullSymbolName];if(isNaN(aw)){k("TAME library error: Could not get the handle for this symbol name: "+az.fullSymbolName);k(az);return}}else{k("TAME library error: Could not get the handle for this request. Handle cache is not ready.");k(az);return}}else{if(az.symbolName){if(typeof az.symbolName==="string"){try{aw=R[az.symbolName].indexOffset;if(typeof az.symbolNameArrIdx==="number"){aw+=R[az.symbolName].itemSize*(az.symbolNameArrIdx-R[az.symbolName].arrStartIdx)}if(typeof az.addrOffset==="number"){aw+=az.addrOffset}if(typeof az.offs==="string"){aw+=parseInt(az.offs,10)/8}else{if(typeof az.offs==="number"){aw+=az.offs/8}}if(az.dataTypeNames.length>0){at=az.dataTypeNames;aB=R[az.symbolName].dataType;for(av=0;av<at.length;av++){aC=ar[aB].subItems[at[av]];aw+=aC.bitOffset/8;if(typeof az.dataTypeArrIdx[av]==="number"){aw+=aC.itemSize*(az.dataTypeArrIdx[av]-aC.arrStartIdx)}aB=ar[aB].subItems[at[av]].dataType}}}catch(ax){k("TAME library error: Can't get the IndexOffset for this request!");k("TAME library error: Please check the variable definition (name/offs/subitem).");k(ax);k(az);return}}else{k("TAME library error: Varible name should be a string!");k(az);return}}else{k("TAME library error: Neither a name nor an address for the variable/request defined!");k(az);return}}}if(isNaN(aw)){k("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");k("IndexOffset: "+aw);k(az)}return aw}function an(aB){var at={},aA,av;if(typeof aB.name==="string"){aB.name=aB.name.toUpperCase();aA=aB.name.split(".")}else{return at}at.fullSymbolName=aB.name;if(aA[0]===""){at.symbolName="."+aA[1]}else{at.symbolName=aA[0]+"."+aA[1]}if(at.symbolName.charAt(at.symbolName.length-1)==="]"){av=at.symbolName.substring(0,at.symbolName.length-1).split("[");at.symbolName=av[0];at.symbolNameArrIdx=parseInt(av[1],10)}at.dataTypeNames=aA.slice(2);var aw=[],ay,az,au;if(ac.symTableReady&&ac.dataTypeTableReady&&at.dataTypeNames.length>0){ay=at.dataTypeNames;az=R[at.symbolName].dataType;at.dataTypeArrIdx=[];au=0;do{if(ay[au].charAt(ay[au].length-1)==="]"){av=ay[au].substring(0,ay[au].length-1).split("[");ay[au]=av[0];at.dataTypeArrIdx[au]=parseInt(av[1],10)}if(ar[az].subItems[ay[au]].pointer===true){k("TAME library error: PLC variable "+[ay[au]]+" is a pointer! Can't get the variable value.")}if(au===ay.length-1){break}az=ar[az].subItems[ay[au]].dataType;au++}while(au<ay.length);try{if(aB.type===undefined){at.type=ar[az].subItems[ay[au]].type}at.arrayLength=ar[az].subItems[ay[au]].arrayLength;at.arrayDataType=ar[az].subItems[ay[au]].arrayDataType;at.dataType=ar[az].subItems[ay[au]].dataType;at.itemSize=ar[az].subItems[ay[au]].itemSize;if(at.size===undefined){at.size=ar[az].subItems[ay[au]].size}at.bitOffset=ar[az].subItems[ay[au]].bitOffset;at.offs=aB.offs;if(at.type==="STRING"||at.arrayDataType==="STRING"){at.stringLength=ar[az].subItems[ay[au]].stringLength;at.format=at.stringLength}else{if(typeof aB.format==="string"){at.format=aB.format}else{if(typeof aB.decPlaces==="number"){at.format=aB.decPlaces}else{if(typeof aB.dp==="number"){at.format=aB.dp}}}}if(at.dataTypeArrIdx[au]!==undefined&&at.type==="ARRAY"){at.type=ar[az].subItems[ay[au]].arrayDataType;at.size=ar[az].subItems[ay[au]].itemSize}}catch(ax){k("TAME library error: A problem occured while reading a data type from the data type table!");k(ax);k(aB)}}else{if(ac.symTableReady){try{if(aB.type===undefined){at.type=R[at.symbolName].type}at.arrayLength=R[at.symbolName].arrayLength;at.arrayDataType=R[at.symbolName].arrayDataType;at.dataType=R[at.symbolName].dataType;at.itemSize=R[at.symbolName].itemSize;if(at.size===undefined){at.size=R[at.symbolName].size}at.bitOffset=R[at.symbolName].bitOffset;at.offs=aB.offs;if(at.type==="STRING"||at.arrayDataType==="STRING"){at.stringLength=R[at.symbolName].stringLength;at.format=at.stringLength}else{if(typeof aB.format==="string"){at.format=aB.format}else{if(typeof aB.decPlaces==="number"){at.format=aB.decPlaces}else{if(typeof aB.dp==="number"){at.format=aB.dp}}}}if(at.symbolNameArrIdx!==undefined&&at.type==="ARRAY"){at.type=R[at.symbolName].arrayDataType;at.size=R[at.symbolName].itemSize}}catch(ax){k("TAME library error: A problem occured while reading a data type from the symbol table!");k(ax);k(aB)}}}if(typeof aB.type=="string"){aw=aB.type.split(".");at.type=aw[0];if(aw.length>2){aw[1]=aw.slice(1).join(".")}if(at.type==="STRING"){aw[1]=parseInt(aw[1],10);if(ap(aw[1])){at.format=aw[1]}else{at.format=C.STRING;k("TAME library warning: Length of string variable not defined: "+aB.name);k("TAME library warning: A length of 80 characters (TwinCAT default) will be used.")}at.stringLength=at.format;at.size=at.format++}else{if(at.type==="ARRAY"){}else{if(at.type==="USER"){}else{at.format=aw[1];at.size=C[at.type]}}}if(typeof aB.format==="string"){at.format=aB.format}else{if(typeof aB.decPlaces==="number"){at.format=aB.decPlaces}else{if(typeof aB.dp==="number"){at.format=aB.dp}}}}if(typeof at.type!="string"){k("TAME library error: Could not get the type of the item!");k(aB)}return at}function ab(){var au;if(window.XMLHttpRequest){au=new window.XMLHttpRequest()}else{try{au=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(av){try{au=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(at){au=null;k("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return au}function v(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){k(e)}}e.send=function(){var at,au;if(typeof this.reqDescr.id==="number"&&F[this.reqDescr.id]>0){k("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");F[this.reqDescr.id]++;if(F[this.reqDescr.id]<=ac.maxDropReq){return}F[this.reqDescr.id]=0}if(e.sync===true){au=false}else{if(this.reqDescr.sync===true){au=false}else{if(this.reqDescr.sync===false){au=true}else{if(f.syncXmlHttp===true){au=false}else{au=true}}}}this.xmlHttpReq=ab();at="<?xml version='1.0' encoding='utf-8'?>";at+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";at+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";at+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";at+="<soap:Body><q1:";at+=this.method;at+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";at+=f.amsNetId;at+="</netId><nPort xsi:type='xsd:int'>";at+=f.amsPort;at+="</nPort>";if(this.indexGroup!==undefined){at+="<indexGroup xsi:type='xsd:unsignedInt'>";at+=this.indexGroup;at+="</indexGroup>"}if(this.indexOffset!==undefined){at+="<indexOffset xsi:type='xsd:unsignedInt'>";at+=this.indexOffset;at+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){at+="<cbRdLen xsi:type='xsd:int'>";at+=this.reqDescr.readLength;at+="</cbRdLen>"}if(this.pData&&this.pData.length>0){at+="<pData xsi:type='xsd:base64Binary'>";at+=this.pData;at+="</pData>"}if(this.pwrData&&this.pwrData.length>0){at+="<pwrData xsi:type='xsd:base64Binary'>";at+=this.pwrData;at+="</pwrData>"}at+="</q1:";at+=this.method;at+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",f.serviceUrl,au,f.serviceUser,f.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(au===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){ac.parseResponse(e)}};this.xmlHttpReq.send(at)}else{this.xmlHttpReq.send(at);ac.parseResponse(e)}if(typeof this.reqDescr.id==="number"){F[this.reqDescr.id]=1}}};return e}function W(av,au,at,e){var aw;if(typeof av.val==="string"){if(au==="REAL"||au==="LREAL"){aw=parseFloat(av.val)}else{aw=parseInt(av.val,10)}}else{if(typeof av.val==="number"){aw=av.val}else{k("TAME library error: Wrong variable type for a numeric variable in write request!");k("TAME library error: Variable type should be number or string, but is "+typeof av.val);k(av);aw=0}}if(isNaN(aw)){aw=0;k("TAME library error: Value of a numeric variable in write request is not a number.");k(av)}if(ac.useCheckBounds===true){if(au==="LREAL"){if(!isFinite(aw)){k("TAME library warning: Limit for LREAL value exceeded!");k("Upper limit: "+Number.MAX_VALUE);k("Lower limit: "+Number.MIN_VALUE);k("value: "+aw);k(av)}}else{if(au==="REAL"){if(aw>0){if(aw<1.175495e-38){k("TAME library warning: Lower limit for positive REAL value exceeded!");k("limit: 1.175495e-38");k("value: "+aw);k(av);aw=1.175495e-38}else{if(aw>3.402823e+38){k("TAME library warning: Upper limit for positive REAL value exceeded!");k("limit: 3.402823e+38");k("value: "+aw);k(av);aw=3.402823e+38}}}else{if(aw<0){if(aw>-1.175495e-38){k("TAME library warning: Upper limit for negative REAL value exceeded!");k("limit: -1.175495e-38");k("value: "+aw);k(av);aw=-1.175495e-38}else{if(aw<-3.402823e+38){k("TAME library warning: Lower limit for negative REAL value exceeded!");k("limit: -3.402823e+38");k("value: "+aw);k(av);aw=-3.402823e+38}}}}}else{if(aw<at){k("TAME library warning: Lower limit for numeric value exceeded!");k("type: "+au);k("limit: "+at);k("value: "+aw);k(av);aw=at}else{if(aw>e){k("TAME library warning: Upper limit for numeric value exceeded!");k("type: "+au);k("limit: "+e);k("value: "+aw);k(av);aw=e}}}}}return aw}function ak(av){var e=[],aw,at,au;if(typeof av.type==="string"){e=av.type.split(".");if(e.length>2){e[1]=e.slice(1).join(".")}}else{k("TAME library error: Could not get the type of the item (function getTypeAndFormat())!");k(av)}return e}function h(at){var av={},e,au;au=ar[at].subItems;for(e in au){if(au[e].type==="USER"){k("TAME library error: Automatic creating of nested structures is not supported (yet)!");av[e]=h(au[e].dataType)}else{if(au.hasOwnProperty(e)){av[e]=au[e].fullType}}}return av}function L(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ai(aw,at){var e=[],av=aw.toString(16),au;while(av.length<at*2){av="0"+av}for(au=0;au<at;au++){e[(at-1)-au]=((L(av.charCodeAt(au*2))*16)+L(av.charCodeAt((au*2)+1)))}return e}function r(at){var aw=0,az=0,ax,e,av,ay,au;e=Math.abs(at);if(at!==0){for(au=128;au>-127;au--){av=e/Math.pow(2,au);if(av>=2){break}ay=au;ax=av}ay+=127;ax=ax.toString(2);for(au=2;au<25;au++){aw<<=1;if(ax.charAt(au)==="1"){aw+=1}}if(ax.charAt(25)==="1"){aw+=1}az=ay;az<<=23;az+=aw;if(at<0){az+=2147483648}}return az}function E(ay){var au=0,aA=0,av={part1:0,part2:0},aB,ax,at,e,az,aw;aB=Math.abs(ay);if(ay!==0){for(aw=1024;aw>=-1023;aw--){ax=aB/Math.pow(2,aw);if(ax>=2){break}at=aw;az=ax}at+=1023;az=az.toString(2);for(aw=2;aw<22;aw++){au<<=1;if(az.charAt(aw)==="1"){au+=1}}if(az.charAt(aw)==="1"){e=true}aw++;for(aw;aw<54;aw++){aA<<=1;if(az.charAt(aw)==="1"){aA+=1}}av.part1=at;av.part1<<=20;av.part1+=au;if(ay<0){av.part1+=2147483648}av.part2=aA;if(e===true){av.part2+=2147483648}}return av}function M(au,at){var e;switch(at){case"#d":case"#dd":e=au*86400000;break;case"#h":case"#hh":e=au*3600000;break;case"#m":case"#mm":e=au*60000;break;case"#s":case"#ss":e=au*1000;break;case"#ms":case"#msmsms":e=au;break;default:e=au;break}return e}function D(az,aB){var e=aB.split("#"),ay=e.length,aA=/:|\.|-|_/,au=0,at=0,aw,av,ax,aC;for(av=1;av<ay;av++){if(aA.test(e[av])===true){aC=true}}if(aC!==true){k("TAME library error: No separator ( : . - _ ) for TOD string found!");k("String: "+az);k("Format: "+aB);return 0}ax=az.split(aA);for(av=1;av<ay;av++){switch(e[av]){case"h":case"hh":aw=parseInt(ax[at],10)*3600000;at++;break;case"m":case"mm":aw=parseInt(ax[at],10)*60000;at++;break;case"s":case"ss":aw=parseInt(ax[at],10)*1000;at++;break;case"ms":case"msmsms":aw=parseInt(ax[at],10);at++;break;default:aw=0}au+=aw}return au}function o(ay){var ax=m,av=0,at="",aw,au,e;while(av<ay.length){aw=ay[av++];au=ay[av++];e=ay[av++];at=at+ax[aw>>2]+ax[((aw&3)<<4)|(au>>4)]+(isNaN(au)?"=":ax[(((au&15)<<2)|(e>>6))])+((isNaN(au)||isNaN(e))?"=":ax[e&63])}return at}function d(ay,aw,ax,av){var aA=[],e,az,at,au;if(ay.val===undefined){switch(aw){case"STRING":ay.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":ay.val=new Date();break;default:ay.val=0;break}k("TAME library warning: Value of a variable in write request is not defined!");k(ay)}switch(aw){case"BOOL":if(ay.val){aA[0]=1}else{aA[0]=0}break;case"BYTE":case"USINT":e=W(ay,aw,0,255);aA=ai(e,av);break;case"SINT":e=W(ay,aw,-128,127);if(e<0){e=e+256}aA=ai(e,av);break;case"WORD":case"UINT":e=W(ay,aw,0,65535);aA=ai(e,av);break;case"INT":case"INT16":e=W(ay,aw,-32768,32767);if(e<0){e=e+65536}aA=ai(e,av);break;case"INT1DP":ay.val=Math.round(ay.val*10);e=W(ay,aw,-32768,32767);if(e<0){e=e+65536}aA=ai(e,av);break;case"DWORD":case"UDINT":e=W(ay,aw,0,4294967295);aA=ai(e,av);break;case"DINT":e=W(ay,aw,-2147483648,2147483647);if(e<0){e=e+4294967296}aA=ai(e,av);break;case"REAL":e=W(ay,aw);e=r(e);aA=ai(e,av);break;case"LREAL":e=W(ay,aw);e=E(e);aA=ai(e.part2,4);aA=aA.concat(ai(e.part1,4));break;case"DATE":if(typeof ay.val==="object"){ay.val.setHours(0);ay.val.setMinutes(0);ay.val.setSeconds(0);e=ay.val.getTime()/1000-ay.val.getTimezoneOffset()*60}else{k("TAME library error: Value of a DATE variable in write request is not a date object!");k(ay)}aA=ai(e,av);break;case"DT":case"DATE_AND_TIME":if(typeof ay.val==="object"){e=ay.val.getTime()/1000-ay.val.getTimezoneOffset()*60}else{k("TAME library error: Value of a DT variable in write request is not a date object!");k(ay)}aA=ai(e,av);break;case"TOD":case"TIME_OF_DAY":if(typeof ay.val==="object"){ay.val.setYear(1970);ay.val.setMonth(0);ay.val.setDate(1);e=ay.val.getTime()-ay.val.getTimezoneOffset()*60000}else{if(typeof ay.val==="string"){if(ax===""||ax===undefined){ax="#hh#:#mm";k("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");k(ay)}e=D(ay.val,ax)}else{k("TAME library error: TOD value in write request is wether a date object nor a string!");k(ay)}}aA=ai(e,av);break;case"STRING":az=(ax===undefined)?C.STRING:parseInt(ax,10);if(ap(az)){at=az<ay.val.length?az:ay.val.length;for(au=0;au<at;au++){aA[au]=ay.val.charCodeAt(au)}for(au;au<az;au++){aA[au]=0}aA[au]=0}break;case"TIME":e=parseInt(ay.val,10);if(isNaN(e)){k("TAME library warning: Value of a TIME variable in write request is not defined!");k(ay);e=0}e=M(e,ax);if(e<0){e=0;k("TAME library warning: Lower limit for TIME variable in write request exceeded!)");k("value: "+ay.val+ax);k(ay)}else{if(e>4294967295){e=4294967295;k("TAME library warning: Upper limit for TIME variable in write request exceeded!)");k("value: "+ay.val+ax);k(ay)}}aA=ai(e,av);break;case"EndStruct":break;default:k("TAME library error: Unknown data type in write request : "+aw);break}return aA}function t(at){var e=at.toString(16);if((e.length%2)!==0){e="0"+e}return e}function i(at,e){e=(isNaN(e))?0:e;var au=at.toString(10);while(au.length<e){au="0"+au}return au}function aq(ay,ax){var e=ax.split("#"),aw=e.length,at="",av,au;for(au=1;au<aw;au++){switch(e[au]){case"D":av=ay.getDate();break;case"DD":av=ay.getDate();av=i(av,2);break;case"WD":av=ay.getDay();break;case"WKD":av=ac.dateNames.weekdShort[ay.getDay()];break;case"WEEKDAY":av=ac.dateNames.weekdLong[ay.getDay()];break;case"M":av=ay.getMonth()+1;break;case"MM":av=ay.getMonth()+1;av=i(av,2);break;case"MON":av=ac.dateNames.monthsShort[ay.getMonth()];break;case"MONTH":av=ac.dateNames.monthsLong[ay.getMonth()];break;case"YY":av=ay.getYear();while(av>100){av-=100}break;case"YYYY":av=ay.getFullYear();break;case"h":av=ay.getHours();break;case"hh":av=ay.getHours();av=i(av,2);break;case"m":av=ay.getMinutes();break;case"mm":av=ay.getMinutes();av=i(av,2);break;case"s":av=ay.getSeconds();break;case"ss":av=ay.getSeconds();av=i(av,2);break;case"ms":av=ay.getMilliseconds();break;case"msmsms":av=ay.getMilliseconds();av=i(av,3);break;default:av=e[au];break}at=at+av}return at}function K(ay,ax){var e=ax.split("#"),aw=e.length,at="",av,au;for(au=1;au<aw;au++){switch(e[au]){case"d":if(aw<=2){av=ay/86400000}else{av=Math.floor(ay/86400000);ay=ay%86400000}break;case"dd":if(aw<=2){av=ay/86400000}else{av=Math.floor(ay/86400000);ay=ay%86400000}av=i(av,2);break;case"h":if(aw<=2){av=ay/3600000}else{av=Math.floor(ay/3600000);ay=ay%3600000}break;case"hh":if(aw<=2){av=ay/3600000}else{av=Math.floor(ay/3600000);ay=ay%3600000}av=i(av,2);break;case"m":if(aw<=2){av=ay/60000}else{av=Math.floor(ay/60000);ay=ay%60000}break;case"mm":if(aw<=2){av=ay/60000}else{av=Math.floor(ay/60000);ay=ay%60000}av=i(av,2);break;case"s":if(aw<=2){av=ay/1000}else{av=Math.floor(ay/1000);ay=ay%1000}break;case"ss":if(aw<=2){av=ay/1000}else{av=Math.floor(ay/1000);ay=ay%1000}av=i(av,2);break;case"ms":av=ay;break;case"msmsms":av=ay;av=i(av,3);break;default:av=e[au];break}at=at+av}return at}function U(at){var e=t(at.charCodeAt(0));return parseInt(e,16)}function aj(e){var at=U(e);if(at>127){at=at-256}return at}function Q(at){var e=t(at.charCodeAt(1));e+=t(at.charCodeAt(0));return parseInt(e,16)}function P(e){var at=Q(e);if(at>32767){at=at-65536}return at}function H(at){var e=t(at.charCodeAt(3));e+=t(at.charCodeAt(2));e+=t(at.charCodeAt(1));e+=t(at.charCodeAt(0));return parseInt(e,16)}function S(e){var at=H(e);if(at>2147483647){at=at-4294967296}return at}function aa(e,au){var at=H(e);if(au===undefined){return at}return(K(at,au))}function n(e,au){var at=new Date(H(e));at=new Date(at.getTime()+at.getTimezoneOffset()*60000);if(au===undefined){return at}return(aq(at,au))}function ah(at,au){var e=new Date(H(at)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(au===undefined){return e}return(aq(e,au))}function q(au){var aw=1,ay=0.5,at=H(au),e,ax,av;if(at===0){return 0}e=((at>>>31)===1)?"-":"+";at<<=1;ax=(at>>>24)-127;at<<=8;for(av=1;av<=23;av++){aw+=at<0?ay:0;at<<=1;ay/=2}return parseFloat(e+(aw*Math.pow(2,ax)))}function G(au){var at=H(au.substring(4,8)),ax=H(au.substring(0,4)),aw=12,av=1,az=0.5,e,ay;if(at===0&&ax===0){return 0}e=((at>>>31)===1)?"-":"+";at<<=1;ay=(at>>>21)-1023;at<<=11;while(aw<32){av+=at<0?az:0;at<<=1;az/=2;aw++}if((ax>>>31)===1){av+=az;ax<<=1;az/=2}while(aw<64){av+=ax<0?az:0;ax<<=1;az/=2;aw++}return parseFloat(e+(av*Math.pow(2,ay)))}function af(e){return e.split(String.fromCharCode(0))[0]}function T(av){var aw=p,ay=0,e="",ax,au,at,aC,aB,aA,az;av=av.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aC=aw[av.charAt(ay++)];aB=aw[av.charAt(ay++)];aA=aw[av.charAt(ay++)];az=aw[av.charAt(ay++)];ax=(aC<<2)|(aB>>4);au=((aB&15)<<4)|(aA>>2);at=((aA&3)<<6)|az;e+=String.fromCharCode(ax);if(aA!==64){e+=String.fromCharCode(au)}if(az!==64){e+=String.fromCharCode(at)}}while(ay<av.length);return e}function Y(at,e,av){var au;switch(e){case"BOOL":au=(at.charCodeAt(0)!="0");break;case"BYTE":case"USINT":au=U(at);break;case"SINT":au=aj(at);break;case"WORD":case"UINT":au=Q(at);break;case"INT":case"INT16":au=P(at);break;case"INT1DP":au=((P(at))/10).toFixed(1);break;case"DWORD":case"UDINT":au=H(at);break;case"DINT":au=S(at);break;case"REAL":au=q(at);if(av!==undefined){au=au.toFixed(parseInt(av,10))}break;case"LREAL":au=G(at);if(av!==undefined){au=au.toFixed(parseInt(av,10))}break;case"STRING":au=af(at);break;case"TOD":case"TIME_OF_DAY":au=n(at,av);break;case"TIME":au=aa(at,av);break;case"DT":case"DATE":case"DATE_AND_TIME":au=ah(at,av);break;case"EndStruct":break;default:k("TAME library error: Unknown data type at parsing read request: "+e);break}return au}function x(aL){var at,aD=aL.reqDescr.items,aB=[],aE=0,aI,av,aw,aK,az,aG,aA,aJ,au,aF,aC,ax,ay;try{at=aL.xmlHttpReq.responseXML.documentElement;av=T(at.getElementsByTagName("ppData")[0].firstChild.data);for(aC=0,ax=aD.length;aC<ax;aC++){aI=aD[aC];aB=ak(aI);au=aB[0];aF=aB[1];aG=C[au];switch(au){case"STRING":if(aF!==undefined){az=parseInt(aF,10)}aG=(ap(az)?az:aG)+1;break;case"EndStruct":aG=aI.val;break}aA=aG<a?aG:a;if(aL.reqDescr.seq!==true){ay=j(aL.reqDescr);aE=aI.addr-ay}else{if(aL.reqDescr.calcAlignment===true&&aA>1&&au!=="EndStruct"&&au!=="STRING"&&aE>0){aJ=aE%aA;if(aJ>0){aE+=aA-aJ}}}aw=av.substr(aE,aG);aK=Y(aw,au,aF);if(au!=="EndStruct"){B(aI.jvar,aK,aL.reqDescr.dataObj,aI.prefix,aI.suffix)}if(aL.reqDescr.seq===true){aE+=aG}}}catch(aH){k("TAME library error: Parsing of Read Request failed:"+aH);k(aI);return}}function c(aS){var at,aG=aS.reqDescr.items,aD=[],aK=0,av=0,aI=window,aP=0,aO,ax,ay,aR,aM,aw,aL,aE,aB,az,aH,aJ,aC,aA,aF;function au(){var aT,e;if(aw==="STRING"){if(aL!==undefined){aT=parseInt(aL,10)}else{if(typeof aF.stringLength==="number"){aT=aF.stringLength}}aM=(ap(aT)?aT:aM)+1}e=ay.substr(av,aM);aR=Y(e,aw,aL);B(aH,aR,aI,aO.prefix,aO.suffix);av+=aM}function aQ(){var aU,aT,aY,aX,aV,aW;function e(){var a0,aZ;if(a>1&&aw!=="STRING"&&aw!=="EndStruct"){a0=aM<a?aM:a;if(a0>1&&av>0){aZ=av%a0;if(aZ>0){av+=a0-aZ}}if(a0>aP){aP=a0}}}if(typeof aO.def==="string"){aO.def=B(aO.def)}else{if(ac.dataTypeTableReady===true&&aO.def===undefined){aO.def=h(aF.dataType)}else{if(typeof aO.def!=="object"){k("TAME library error: No structure defininition found!")}}}for(aW in aO.def){if(aO.def.hasOwnProperty(aW)){aT=aO.def[aW].split(".");if(aT[0]==="ARRAY"){aY=parseInt(aT[1],10);aX=aT.length-1;for(aU=0;aU<aY;aU++){aw=aT[2];if(aT[aX]==="SP"){aH=aW+aU;if(aX>=4){aL=aT.slice(3,-1).join(".")}}else{aH=aW+"."+aU;if(aX>=3){aL=aT.slice(3).join(".")}}if(aJ!==null){aH=aJ+"."+aH}aM=C[aw];e();au()}}else{if(aJ!==null){aH=aJ+"."+aW}else{aH=aW}aw=aT[0];if(aT.length>2){aT[1]=aT.slice(1).join(".")}aL=aT[1];aM=C[aw];e();au()}}}if(a>1&&aP>1&&aw!=="STRING"&&aw!=="EndStruct"){if(aP>a){aP=a}aV=av%aP;if(aV>0){av+=aP-aV}}}try{at=aS.xmlHttpReq.responseXML.documentElement;ax=T(at.getElementsByTagName("ppRdData")[0].firstChild.data);for(aE=0,aB=aG.length;aE<aB;aE++){ay=ax.substr(aK,4);az=Y(ay,"DWORD");if(az!==0){k("TAME library error: ADS sub command error while processing a SumReadRequest!");k("Error code: "+az);k(aG[aE])}aK+=4}for(aE=0;aE<aB;aE++){aO=aG[aE];aF=an(aO);aw=aF.type;aL=aF.format;aA=aF.size;aJ=null;ay=ax.substr(aK,aA);switch(aw){case"ARRAY":aI=B(aO.jvar);av=0;aC=aF.arrayLength;if(aF.arrayDataType==="USER"){for(aJ=0;aJ<aC;aJ++){aQ()}}else{aw=aF.arrayDataType;aM=C[aw];for(aJ=0;aJ<aC;aJ++){aH=aJ;au()}}break;case"USER":aI=B(aO.jvar);av=0;aQ();break;default:aI=window;aR=Y(ay,aw,aL);B(aO.jvar,aR,aI,aO.prefix,aO.suffix)}aK+=aA}}catch(aN){k("TAME library error: Parsing of SumReadRequest failed:"+aN);k(aO);return}}function y(aM){var at,aD=aM.reqDescr.items,aB=[],aF=0,au=0,aE=window,aJ,aw,ax,aL,aH,av,aG,aC,az,ay,aA,aK;try{at=aM.xmlHttpReq.responseXML.documentElement;aw=T(at.getElementsByTagName("ppRdData")[0].firstChild.data);for(aC=0,az=aD.length;aC<az;aC++){ax=aw.substr(aF,4);ay=Y(ax,"DWORD");if(ay===0){if(aM.reqDescr.isRelHdlReq===true){aK=aD[aC].toUpperCase();delete O[aK];aA=s.indexOf(aK);delete s[aA]}}else{k("TAME library error: ADS sub command error while processing a SumReadRequest!");k("Error code: "+ay);k(aD[aC])}aF+=4}if(aM.reqDescr.isRelHdlReq===true){for(aC=s.length-1;aC>=0;aC--){if(s[aC]===undefined){s.splice(aC,1)}}if(s.length===0){ac.handleCacheReady=false;k("TAME library info: All handles released.")}}}catch(aI){k("TAME library error: Parsing of SumWriteRequest failed:"+aI);k(aJ);return}}function am(av){var at;try{at=av.xmlHttpReq.responseXML.documentElement;ac.adsState=parseInt(at.getElementsByTagName("pAdsState")[0].firstChild.data,10);ac.adsStateTxt=V[ac.adsState];ac.deviceState=parseInt(at.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(au){k("TAME library error: Parsing of ADS Read State Request failed:"+au);return}}function X(aC){var av,aw=s,at=0,e=0,ax,au,ay,aB,az,aA,aD;av=aC.xmlHttpReq.responseXML.documentElement;ax=T(av.getElementsByTagName("ppRdData")[0].firstChild.data);for(aB=0,az=aw.length;aB<az;aB++){au=ax.substr(at,4);aA=Y(au,"DWORD");at+=4;au=ax.substr(at,4);aD=Y(au,"DWORD");at+=4;if(aA!==0){k("TAME library error: Error while reading a handle from the PLC!");k("Error code: "+aA);k("Handle: "+aw[aB]);throw"Handle request aborted!"}}for(aB=0;aB<az;aB++){au=ax.substr(at,4);ay=Y(au,"DWORD");at+=4;O[aw[aB]]=ay}ac.handleCacheReady=true;k("TAME library info: Handle cache ready.")}function N(ay,ax,av){var au={},aw,e,at;av.type=ax;at=an(av);e=C[ax];switch(ax){case"STRING":if(ap(av.strlen)){ax+="."+av.strlen;e=av.strlen}else{if(typeof at.stringLength==="number"){e=at.stringLength;ax+="."+e}else{k("TAME library error: Could not get the length of the string for this request!");k(av)}}e++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof av.format==="string"){ax+="."+av.format}break;case"REAL":case"LREAL":if(typeof av.decPlaces==="number"){ax+="."+av.decPlaces}else{if(typeof av.dp==="number"){ax+="."+av.dp}}break}au={addr:av.addr,symbolName:at.symbolName,dataTypeNames:at.dataTypeNames,dataTypeArrIdx:at.dataTypeArrIdx,symbolNameArrIdx:at.symbolNameArrIdx,fullSymbolName:av.name,useHandle:av.handle,id:av.id,oc:av.oc,ocd:av.ocd,readLength:e,debug:av.debug,sync:av.sync,offs:av.offs,seq:true,items:[{val:av.val,jvar:av.jvar,type:ax,prefix:av.prefix,suffix:av.suffix}]};if(ay==="Write"){ac.writeReq(au)}else{ac.readReq(au)}}function I(av,aw,au){var ax={},aJ={},aD,at,aL=0,aM=0,aK=0,aN,e=[],aP,az,aC=0,aE,aA,aO=0,aF=0,aR,aB,aQ,aH,aG;aG=an(au);if(av==="Write"&&typeof au.val==="object"){aJ=au.val}else{if(typeof au.jvar==="string"){aJ=B(au.jvar)}else{k("TAME library error: No data object for this "+av+"-Request defined!")}}if(typeof au.arrlen==="number"){aD=au.arrlen}else{if(aG.arrayLength!==undefined){aD=aG.arrayLength}else{k("TAME library error: Can't get the array length for this request!");k(au)}}if(typeof au.item==="number"&&!isNaN(au.item)&&av==="Write"){aQ=true;if(au.item<0||au.item>aD-1){k('TAME library error: Wrong value for "item"!');k("item: "+au.item);k("Last array index: "+(aD-1))}}function ay(){var aS;if(typeof au.def==="string"){au.def=B(au.def)}else{if(ac.dataTypeTableReady===true&&au.def===undefined){au.def=h(aG.dataType)}else{if(typeof au.def!=="object"){k("TAME library error: No structure definition found!")}}}for(aS in au.def){if(au.def.hasOwnProperty(aS)){e=au.def[aS].split(".");if(e[0]==="ARRAY"){aP=parseInt(e[1],10);e.shift();e.shift()}else{aP=1}for(aM=0;aM<aP;aM++){if(e[0]==="STRING"){if(typeof e[1]==="string"){aE=parseInt(e[1],10)}aA=(ap(aE)?aE:C[e[0]])+1}else{aA=C[e[0]]}if(a>1&&aA>1&&e[0]!=="STRING"&&aC>0){aR=aC%aA;if(aR>0){aC+=aA-aR}}aC+=aA}if(a>1&&aA>aO&&e[0]!=="STRING"){aO=aA}}}if(a>1&&aO>1&&e[0]!=="STRING"){if(aO>a){aO=a}aR=aC%aO;if(aR>0){aF=aO-aR;aC+=aF}}if(aQ){at=aC*au.item;aD=1}ax={addr:au.addr,symbolName:aG.symbolName,dataTypeNames:aG.dataTypeNames,fullSymbolName:au.name,addrOffset:at,useHandle:au.handle,id:au.id,oc:au.oc,ocd:au.ocd,debug:au.debug,readLength:aC*aD,seq:true,calcAlignment:true,dataObj:aJ,sync:au.sync,offs:au.offs,items:[]};for(aM=0;aM<aD;aM++){for(aS in au.def){if(au.def.hasOwnProperty(aS)){e=au.def[aS].split(".");if(e[0]==="ARRAY"){aP=parseInt(e[1],10);az=e.length-1;for(aK=0;aK<aP;aK++){if(e[az]==="SP"){ax.items[aL]={jvar:aM+"."+aS+aK};if(az===4){ax.items[aL].type=e[2]+"."+e[3]}else{ax.items[aL].type=e[2]}}else{ax.items[aL]={jvar:aM+"."+aS+"."+aK};if(az===3){ax.items[aL].type=e[2]+"."+e[3]}else{ax.items[aL].type=e[2]}}if(av==="Write"){if(aQ){if(e[az]==="SP"){ax.items[aL].val=aJ[au.item][aS+aK]}else{ax.items[aL].val=aJ[au.item][aS][aK]}}else{if(e[az]==="SP"){ax.items[aL].val=aJ[aM][aS+aK]}else{ax.items[aL].val=aJ[aM][aS][aK]}}}aL++}}else{ax.items[aL]={jvar:aM+"."+aS,type:au.def[aS]};if(av==="Write"){if(aQ){ax.items[aL].val=aJ[au.item][aS]}else{ax.items[aL].val=aJ[aM][aS]}}aL++}}}if(a>1){ax.items[aL]={type:"EndStruct",val:aF};aL++}}}function aI(){aN=C[aw];switch(aw){case"STRING":if(ap(au.strlen)){aw+="."+au.strlen;aN=au.strlen}else{if(typeof aG.stringLength==="number"){aN=aG.stringLength;aw+="."+aN}else{k("TAME library error: Could not get the length of the string for this request!");k(au)}}aN++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof au.format==="string"){aw+="."+au.format}break;case"REAL":case"LREAL":if(typeof au.decPlaces==="number"){aw+="."+au.decPlaces}else{if(typeof au.dp==="number"){aw+="."+au.dp}}break}if(aQ){at=au.item*aN;aD=1}ax={addr:au.addr,symbolName:aG.symbolName,dataTypeNames:aG.dataTypeNames,dataTypeArrIdx:aG.dataTypeArrIdx,symbolNameArrIdx:aG.symbolNameArrIdx,fullSymbolName:au.name,useHandle:au.handle,addrOffset:at,id:au.id,oc:au.oc,ocd:au.ocd,readLength:aN*aD,debug:au.debug,seq:true,dataObj:aJ,items:[]};for(aM=0;aM<aD;aM++){ax.items[aM]={jvar:aM,type:aw};if(av==="Write"){if(aQ){ax.items[aM].val=aJ[au.item]}else{ax.items[aM].val=aJ[aM]}}}}if(aw==="STRUCT"){ay()}else{aI()}if(av==="Write"){ac.writeReq(ax)}else{ac.readReq(ax)}}function ae(e,aB){var ay={},at={},aC=[],aw=0,aA,av,ax,az,au;au=an(aB);if(e==="Write"&&typeof aB.val==="object"){at=aB.val}else{if(typeof aB.jvar==="string"){at=B(aB.jvar)}else{k("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof aB.def==="string"){aB.def=B(aB.def)}else{if(ac.dataTypeTableReady===true&&aB.def===undefined){aB.def=h(au.dataType)}else{if(typeof aB.def!=="object"){k("TAME library error: No structure defininition found!")}}}ay={addr:aB.addr,symbolName:au.symbolName,dataTypeNames:au.dataTypeNames,dataTypeArrIdx:au.dataTypeArrIdx,symbolNameArrIdx:au.symbolNameArrIdx,fullSymbolName:aB.name,useHandle:aB.handle,id:aB.id,oc:aB.oc,ocd:aB.ocd,debug:aB.debug,seq:true,calcAlignment:true,dataObj:at,sync:aB.sync,offs:aB.offs,items:[]};for(ax in aB.def){if(aB.def.hasOwnProperty(ax)){aC=aB.def[ax].split(".");if(aC[0]==="ARRAY"){av=parseInt(aC[1],10);aA=aC.length-1;for(az=0;az<av;az++){if(aC[aA]==="SP"){ay.items[aw]={jvar:ax+az};if(aA===4){ay.items[aw].type=aC[2]+"."+aC[3]}else{ay.items[aw].type=aC[2]}}else{ay.items[aw]={jvar:ax+"."+az};if(aA===3){ay.items[aw].type=aC[2]+"."+aC[3]}else{ay.items[aw].type=aC[2]}}if(e==="Write"){if(aC[aA]==="SP"){ay.items[aw].val=at[ax+az]}else{ay.items[aw].val=at[ax][az]}}aw++}}else{ay.items[aw]={jvar:ax,type:aB.def[ax]};if(e==="Write"){ay.items[aw].val=at[ax]}aw++}}}if(e==="Write"){ac.writeReq(ay)}else{ac.readReq(ay)}}this.writeReq=function(av){var ax=av.items,aE={},e=[],aA=[],aH=[],az,aD,au,ay,at,aF,aB,aG,aw,aC;if(typeof av.name==="string"){av.name=av.name.toUpperCase()}for(aC=0,au=ax.length;aC<au;aC++){aG=ax[aC];aA=ak(aG);az=aA[0];aD=aA[1];if(isNaN(C[az])){k("TAME library error: Could not get the length of the data type: "+az);k("TAME library error: Probably wrong type definition. Please check the manual.");k(av);return}ay=(C[az]<a)?C[az]:a;if(av.calcAlignment===true&&ay>1&&az!=="STRING"&&az!=="EndStruct"&&e.length>0){aB=e.length%ay;if(aB>0){aF=ay-aB;for(aw=1;aw<=aF;aw++){e.push(0)}}}if(az==="EndStruct"){for(aw=1;aw<=aG.val;aw++){e.push(0)}}else{aH=d(aG,az,aD,C[az]);e=e.concat(aH)}}if(e&&e.length>0){e=o(e)}aE={method:"Write",indexGroup:z(av),indexOffset:j(av),pData:e,reqDescr:av};v(aE).send()};this.readReq=function(au){var aC={},av=au.items,ax=[],aD,aB,aw,e,ay,az,aE,aA,at;if(typeof au.readLength!=="number"){au.readLength=0;for(aA=0,e=av.length;aA<e;aA++){aD=av[aA];ax=ak(aD);aw=ax[0];aB=ax[1];if(isNaN(C[aw])){k("TAME library error: Could not get the length of the data type: "+aw);k("TAME library error: Probably wrong type definition. Please check the manual.");k(au);return}if(aw==="STRING"){if(typeof aB==="string"){aE=parseInt(aB,10)}az=(ap(aE)?aE:C[aw])+1}else{az=C[aw]}if(au.seq===true){if(au.calcAlignment===true&&az>1&&aw!=="EndStruct"&&aw!=="STRING"&&au.readLength>0){ay=au.readLength%az;if(ay>0){au.readLength+=az-ay}}au.readLength+=az}else{at=j(au);au.readLength=az+aD.addr-at}}}aC={method:"Read",indexGroup:z(au),indexOffset:j(au),reqDescr:au};v(aC).send()};this.sumReadReq=function(av){var aD={},ax=av.items,aA=[],aF=[],aG=[],au=ax.length,aw={},az,aC,aE,aB,ay,e,at;av.readLength=au*4;for(aB=0;aB<au;aB++){aE=ax[aB];at=an(aE);ay=at.size;av.readLength+=ay;aw.val=z(at);aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG);aw.val=j(at);aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG);aw.val=ay;aG=d(aw,"UDINT",aC,4);aF=aF.concat(aG)}if(aF.length>0){e=o(aF)}aD={method:"ReadWrite",indexGroup:l.SumRd,indexOffset:ax.length,pwrData:e,reqDescr:av};v(aD).send()};this.sumWriteReq=function(av){var aO={},aC=av.items,ay=[],at=[],aA=[],aw=aC.length,aL={},aJ=0,au,aG,aI,az,aH,aN,aF,aE,ax,aK,e,aB;function aD(){var aP;aH=C[au];if(au==="STRING"){if(aG!==undefined){aP=parseInt(aG,10)}else{if(typeof aB.stringLength==="number"){aP=aB.stringLength}}aG=(ap(aP)?aP:aH)}}function aM(){var aS,aX,aP,aT,aV,aQ,aR=[];function aW(){var aZ,aY;if(a>1&&au!=="STRING"&&au!=="EndStruct"){aZ=aH<a?aH:a;if(aZ>1&&aR.length>0){aV=aR.length%aZ;if(aV>0){e=aZ-aV;for(aY=1;aY<=e;aY++){aR.push(0)}}}if(aZ>aJ){aJ=aZ}}}if(typeof aI.def==="string"){aI.def=B(aI.def)}else{if(ac.dataTypeTableReady===true&&aI.def===undefined){aI.def=h(aB.dataType)}else{if(typeof aI.def!=="object"){k("TAME library error: No structure defininition found!")}}}for(aQ in aI.def){if(aI.def.hasOwnProperty(aQ)){try{aX=aI.def[aQ].split(".");if(aX[0]==="ARRAY"){aP=parseInt(aX[1],10);aT=aX.length-1;for(aS=0;aS<aP;aS++){au=aX[2];if(aX[aT]==="SP"){if(aT>=4){aG=aX.slice(3,-1).join(".")}}else{if(aT>=3){aG=aX.slice(3).join(".")}}if(aF!==null){if(aX[aT]==="SP"){aL.val=aI.val[aF][aQ+aS]}else{aL.val=aI.val[aF][aQ][aS]}}else{aL.val=aI.val[aQ][aS]}aD();aW();aA=d(aL,au,aG,aH);aR=aR.concat(aA)}}else{if(aF!==null){aL.val=aI.val[aF][aQ]}else{aL.val=aI.val[aQ]}au=aX[0];if(aX.length>2){aX[1]=aX.slice(1).join(".")}aG=aX[1];aD();aW();aA=d(aL,au,aG,aH);aR=aR.concat(aA)}}catch(aU){k("TAME library error: Could not set values for a structure in SumWriteReq: "+aU);k(aI)}}}if(a>1&&aJ>1&&aX[0]!=="STRING"&&aX[0]!=="EndStruct"){aV=aR.length%aJ;if(aV>0){e=aJ-aV;for(aE=1;aE<=e;aE++){aR.push(0)}}}at=at.concat(aR)}av.readLength=aw*4;for(az=0;az<aw;az++){aI=aC[az];aB=an(aI);au=aB.type;aG=aB.format;aH=aB.size;aL.val=z(aB);aA=d(aL,"UDINT",aG,4);at=at.concat(aA);aL.val=j(aB);aA=d(aL,"UDINT",aG,4);at=at.concat(aA);aL.val=aH;aA=d(aL,"UDINT",aG,4);at=at.concat(aA)}for(az=0;az<aw;az++){aI=aC[az];aB=an(aI);au=aB.type;aG=aB.format;aH=aB.size;aF=null;switch(au){case"ARRAY":ax=parseInt(aB.arrayLength,10);if(ax!==aI.val.length){k("TAME library error: Array length in JS differs from the length in the PLC!");k("Length in JS: "+aI.val.length);k("Length in PLC: "+ax);k(aI);return}if(aB.arrayDataType==="USER"){for(aF=0;aF<ax;aF++){aM()}}else{au=aB.arrayDataType;if(au==="STRING"){aG=aB.stringLength}else{aH=aB.itemSize}for(aF=0;aF<ax;aF++){aL.val=aI.val[aF];aA=d(aL,au,aG,aH);at=at.concat(aA)}}break;case"USER":aM();break;default:if(au==="STRING"){aG=aB.stringLength}else{aH=aB.size}aA=d(aI,au,aG,aH);at=at.concat(aA)}}if(at.length>0){aN=o(at)}aO={method:"ReadWrite",indexGroup:l.SumWr,indexOffset:aC.length,pwrData:aN,reqDescr:av};v(aO).send()};this.readAdsState=function(e){var at={method:"ReadState",reqDescr:e};v(at).send()};this.logHandleCache=function(){k(O)};this.logSymbols=function(){k(R)};this.logDataTypes=function(){k(ar)};this.getSymbolsAsJSON=function(){var au;if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{au=JSON.stringify(R);return au}catch(at){k("TAME library error: Could not convert the Symbol Table to JSON:"+at)}}};this.setSymbolsFromJSON=function(au){if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{R=JSON.parse(au)}catch(at){k("TAME library error: Could not create the Symbol Table from JSON:"+at);return}ac.symTableReady=true;k("TAME library info: Symbol Table successfully created from JSON data.")}};this.getDataTypesAsJSON=function(){var au;if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{au=JSON.stringify(ar);return au}catch(at){k("TAME library error: Could not convert the Data Type Table to JSON:"+at)}}};this.setDataTypesFromJSON=function(au){if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{ar=JSON.parse(au)}catch(at){k("TAME library error: Could not create the Data Type Table from JSON:"+at);return}ac.dataTypeTableReady=true;k("TAME library info: Data Type Table successfully created from JSON data.")}};this.parseResponse=function(ay){var au,ax,at;if(typeof ay.reqDescr.id==="number"){F[ay.reqDescr.id]=0}if(ay.xmlHttpReq.responseXML===null){k('TAME library error: Request contains no XML data. Object "responseXML" is null.');k('TAME library error: This is the "responseText":');k(ay.xmlHttpReq.responseText)}try{au=ay.xmlHttpReq.responseXML.documentElement}catch(aw){k("TAME library error: No XML data in server response:"+aw);return}try{at=au.getElementsByTagName("faultstring")[0].firstChild.data;try{ax=au.getElementsByTagName("errorcode")[0].firstChild.data}catch(aw){ax="-"}k("TAME library error: Message from server:  "+at+" ("+ax+")");return}catch(av){ax=0}if(typeof au.normalize==="function"){au.normalize()}if(ay.method==="ReadState"){am(ay)}else{if(ay.method==="Read"||ay.method==="ReadWrite"){switch(ay.indexGroup){case l.UploadInfo:Z(ay);break;case l.Upload:ag(ay);break;case l.SumRd:c(ay);break;case l.SumWr:y(ay);break;case l.SumRdWr:X(ay);break;default:x(ay)}}}if(typeof ay.reqDescr.oc==="function"){if(typeof ay.reqDescr.ocd==="number"){window.setTimeout(ay.reqDescr.oc,ay.reqDescr.ocd)}else{ay.reqDescr.oc()}}};this.getHandles=function(au){var aA={},aB=[],ax=au.symbols.length,aC,az,aw,e,ay,at,av;au.readLength=ax*12;for(az=0;az<ax;az++){aC=ai(l.HandleByName,4);aB=aB.concat(aC);aC=ai(0,4);aB=aB.concat(aC);aC=ai(4,4);aB=aB.concat(aC);aC=ai(au.symbols[az].length,4);aB=aB.concat(aC)}for(az=0;az<ax;az++){at=au.symbols[az].toUpperCase();s[az]=at;aC=[];for(av=0;av<at.length;av++){aC[av]=at.charCodeAt(av)}aB=aB.concat(aC)}if(aB.length>0){e=o(aB)}aA={method:"ReadWrite",indexGroup:l.SumRdWr,indexOffset:ax,pwrData:e,reqDescr:au};v(aA).send()};this.releaseHandles=function(at){var ay={},az=[],aA=[],av=0,aw=[],au=0,ax,e;if(at===undefined){at={}}else{if(at.symbols!==undefined){av=at.symbols.length;for(ax=0;ax<av;ax++){aw[ax]=at.symbols[ax].toUpperCase()}}else{av=s.length;aw=s}}at.readLength=av*4;for(ax=0;ax<av;ax++){aA=ai(l.ReleaseHandle,4);az=az.concat(aA);aA=ai(0,4);az=az.concat(aA);aA=ai(4,4);az=az.concat(aA)}for(ax=0;ax<av;ax++){if(typeof O[aw[ax]]==="number"){aA=ai(O[aw[ax]],4);az=az.concat(aA)}else{k("TAME library error: Handle for symbol name "+aw[ax]+" does not exist in handle cache!");throw"Releasing Handles aborted!"}}if(az.length>0){e=o(az)}at.items=aw;at.isRelHdlReq=true;ay={method:"ReadWrite",indexGroup:l.SumWr,indexOffset:av,pwrData:e,reqDescr:at};v(ay).send()};this.writeBool=function(e){N("Write","BOOL",e)};this.writeByte=function(e){N("Write","BYTE",e)};this.writeUsint=function(e){N("Write","USINT",e)};this.writeSint=function(e){N("Write","SINT",e)};this.writeWord=function(e){N("Write","WORD",e)};this.writeUint=function(e){N("Write","UINT",e)};this.writeInt=function(e){N("Write","INT",e)};this.writeInt1Dp=function(e){N("Write","INT1DP",e)};this.writeDword=function(e){N("Write","DWORD",e)};this.writeUdint=function(e){N("Write","UDINT",e)};this.writeDint=function(e){N("Write","DINT",e)};this.writeReal=function(e){N("Write","REAL",e)};this.writeLreal=function(e){N("Write","LREAL",e)};this.writeString=function(e){N("Write","STRING",e)};this.writeTime=function(e){N("Write","TIME",e)};this.writeTod=function(e){N("Write","TOD",e)};this.writeDate=function(e){N("Write","DATE",e)};this.writeDt=function(e){N("Write","DT",e)};this.readBool=function(e){N("Read","BOOL",e)};this.readByte=function(e){N("Read","BYTE",e)};this.readUsint=function(e){N("Read","USINT",e)};this.readSint=function(e){N("Read","SINT",e)};this.readWord=function(e){N("Read","WORD",e)};this.readUint=function(e){N("Read","UINT",e)};this.readInt=function(e){N("Read","INT",e)};this.readInt1Dp=function(e){N("Read","INT1DP",e)};this.readDword=function(e){N("Read","DWORD",e)};this.readUdint=function(e){N("Read","UDINT",e)};this.readDint=function(e){N("Read","DINT",e)};this.readReal=function(e){N("Read","REAL",e)};this.readLreal=function(e){N("Read","LREAL",e)};this.readString=function(e){N("Read","STRING",e)};this.readTime=function(e){N("Read","TIME",e)};this.readTod=function(e){N("Read","TOD",e)};this.readDate=function(e){N("Read","DATE",e)};this.readDt=function(e){N("Read","DT",e)};this.writeStruct=function(e){ae("Write",e)};this.readStruct=function(e){ae("Read",e)};this.writeArrayOfBool=function(e){I("Write","BOOL",e)};this.writeArrayOfByte=function(e){I("Write","BYTE",e)};this.writeArrayOfUsint=function(e){I("Write","USINT",e)};this.writeArrayOfSint=function(e){I("Write","SINT",e)};this.writeArrayOfWord=function(e){I("Write","WORD",e)};this.writeArrayOfUint=function(e){I("Write","UINT",e)};this.writeArrayOfInt=function(e){I("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){I("Write","INT1DP",e)};this.writeArrayOfDword=function(e){I("Write","DWORD",e)};this.writeArrayOfUdint=function(e){I("Write","UDINT",e)};this.writeArrayOfDint=function(e){I("Write","DINT",e)};this.writeArrayOfReal=function(e){I("Write","REAL",e)};this.writeArrayOfLreal=function(e){I("Write","LREAL",e)};this.writeArrayOfString=function(e){I("Write","STRING",e)};this.writeArrayOfTime=function(e){I("Write","TIME",e)};this.writeArrayOfTod=function(e){I("Write","TOD",e)};this.writeArrayOfDate=function(e){I("Write","DATE",e)};this.writeArrayOfDt=function(e){I("Write","DT",e)};this.writeArrayOfStruct=function(e){I("Write","STRUCT",e)};this.readArrayOfBool=function(e){I("Read","BOOL",e)};this.readArrayOfByte=function(e){I("Read","BYTE",e)};this.readArrayOfUsint=function(e){I("Read","USINT",e)};this.readArrayOfSint=function(e){I("Read","SINT",e)};this.readArrayOfWord=function(e){I("Read","WORD",e)};this.readArrayOfUint=function(e){I("Read","UINT",e)};this.readArrayOfInt=function(e){I("Read","INT",e)};this.readArrayOfInt1Dp=function(e){I("Read","INT1DP",e)};this.readArrayOfDword=function(e){I("Read","DWORD",e)};this.readArrayOfUdint=function(e){I("Read","UDINT",e)};this.readArrayOfDint=function(e){I("Read","DINT",e)};this.readArrayOfReal=function(e){I("Read","REAL",e)};this.readArrayOfLreal=function(e){I("Read","LREAL",e)};this.readArrayOfString=function(e){I("Read","STRING",e)};this.readArrayOfTime=function(e){I("Read","TIME",e)};this.readArrayOfTod=function(e){I("Read","TOD",e)};this.readArrayOfDate=function(e){I("Read","DATE",e)};this.readArrayOfDt=function(e){I("Read","DT",e)};this.readArrayOfStruct=function(e){I("Read","STRUCT",e)};function ad(){var e={method:"Read",sync:true,indexGroup:l.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};v(e).send()}function Z(ay){var at,au,az,aw,av;try{at=ay.xmlHttpReq.responseXML.documentElement;au=T(at.getElementsByTagName("ppData")[0].firstChild.data);az=au.substr(0,4);b=Y(az,"DWORD");az=au.substr(4,4);w=Y(az,"DWORD")}catch(ax){k("TAME library error: Parsing of UploadInfo failed:"+ax);return}av={method:"Read",sync:true,indexGroup:l.Upload,indexOffset:0,reqDescr:{readLength:w}};v(av).send()}function ag(aK){var at,aC=0,aH=4,aE=8,aA=12,ax=30,aw,ay,aJ,aB,aD,au,aI,az,av,aG;try{at=aK.xmlHttpReq.responseXML.documentElement;aw=T(at.getElementsByTagName("ppData")[0].firstChild.data);for(aB=0;aB<b;aB++){ay=aw.substr(aC,4);aD=Y(ay,"DWORD");au=aw.substring(aC+ax,(aC+aD)).split(String.fromCharCode(0));name=au[0].toUpperCase();R[name]={typeString:au[1],indexGroup:Y(aw.substr(aC+aH,4),"DWORD"),indexOffset:Y(aw.substr(aC+aE,4),"DWORD"),size:Y(aw.substr(aC+aA,4),"DWORD")};aI=au[1].split(" ");if(aI[0]==="ARRAY"){R[name].type=aI[0];az=aI[1].substring(1,aI[1].length-1);az=az.split("..");R[name].arrStartIdx=parseInt(az[0],10);az=parseInt(az[1],10)-parseInt(az[0],10)+1;R[name].arrayLength=az;av=aI[3].split("(");if(av[1]!==undefined){av[1]=av[1].substr(0,av[1].length-1);R[name].fullType=aI[0]+"."+az+"."+av[0]+"."+av[1];R[name].stringLength=parseInt(av[1],10)}else{R[name].fullType=aI[0]+"."+az+"."+av[0]}R[name].itemSize=R[name].size/az;R[name].arrayDataType="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(av[0]===aG){R[name].arrayDataType=av[0]}}}if(R[name].arrayDataType==="USER"){R[name].dataType=av[0]}}else{av=aI[0].split("(");if(av[1]!==undefined){av[1]=av[1].substr(0,av[1].length-1);R[name].fullType=av[0]+"."+av[1];R[name].stringLength=parseInt(av[1],10)}else{R[name].fullType=av[0]}R[name].type="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(av[0]===aG){R[name].type=av[0]}}}if(R[name].type==="USER"){R[name].dataType=av[0]}}aC+=aD}ac.symTableReady=true;k("TAME library info: End of fetching the symbols.");k("TAME library info: Symbol table ready.")}catch(aF){k("TAME library error: Parsing of uploaded symbol information failed:"+aF);return}}function J(){var aA=ab(),az=[],aE,aK,aB,aI,ax,at,aG,ay;aA.open("GET",f.configFileUrl,false);aA.setRequestHeader("Content-Type","text/xml");aA.send(null);k("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aE=(new DOMParser()).parseFromString(aA.responseText,"text/xml")}catch(aF){k("TAME library error: Creating a DOM object from TPY failed:"+aF);return}}else{k("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(typeof f.amsNetId!=="string"||typeof f.amsPort!=="string"||a===0){k("TAME library info: Start reading the service information from the TPY file.");try{A={netId:aE.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:aE.getElementsByTagName("Port")[0].childNodes[0].nodeValue};ay=aE.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(ay==="2"){A.alignment=parseInt(aE.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(ay==="3"){A.alignment=8}else{k("TAME library error: Could not determine the TwinCAT version.")}}k("TAME library info: End of reading the service information from the TPY file.")}catch(aF){k("TAME library error: An error occured while reading service information from the TPY file:");k(aF)}}else{k("TAME library info: NetId, port and alignment manually set. Skip reading the service information from the TPY file.")}if(f.forceUploadUsage!==true){k("TAME library info: Start reading the symbols from the TPY file.");try{aB=aE.getElementsByTagName("Symbols")[0];az=aB.getElementsByTagName("Symbol");for(var aD=0;aD<az.length;aD++){aK=az[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();R[aK]={typeString:az[aD].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(az[aD].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(az[aD].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(az[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};R[aK].size=(R[aK].bitSize>=8)?R[aK].bitSize/8:R[aK].bitSize;aI=R[aK].typeString.split(" ");if(aI[0]==="ARRAY"){R[aK].type=aI[0];ax=aI[1].substring(1,aI[1].length-1);ax=ax.split("..");R[aK].arrStartIdx=parseInt(ax[0],10);ax=parseInt(ax[1],10)-parseInt(ax[0],10)+1;R[aK].arrayLength=ax;at=aI[3].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[aK].fullType=aI[0]+"."+ax+"."+at[0]+"."+at[1];R[aK].stringLength=parseInt(at[1],10)}else{R[aK].fullType=aI[0]+"."+ax+"."+at[0]}R[aK].itemSize=R[aK].size/ax;R[aK].arrayDataType="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(at[0]===aG){R[aK].arrayDataType=at[0]}}}if(R[aK].arrayDataType==="USER"){R[aK].dataType=at[0]}}else{at=aI[0].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[aK].fullType=at[0]+"."+at[1];R[aK].stringLength=parseInt(at[1],10)}else{R[aK].fullType=at[0]}R[aK].type="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(at[0]===aG){R[aK].type=at[0]}}}if(R[aK].type==="USER"){R[aK].dataType=at[0]}}}ac.symTableReady=true;k("TAME library info: End of reading the symbols from the TPY file.");k("TAME library info: Symbol table ready.")}catch(aF){k("TAME library error: An error occured while parsing the symbol file:");k(aF)}}else{k("TAME library info: Reading the symbols from the TPY file is deactivated.")}var aw,aH,au,av,aJ;if(true){k("TAME library info: Start reading the data types from the TPY file.");try{aw=aE.getElementsByTagName("DataTypes")[0];aH=aw.getElementsByTagName("DataType");for(var aD=0;aD<aH.length;aD++){aJ=aH[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aK=aJ.split(" ")[0];if(aK==="ARRAY"){ar[aJ]={bitSize:parseInt(aH[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};ar[aJ].size=ar[aJ].bitSize/8}}for(var aD=0;aD<aH.length;aD++){aJ=aH[aD].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aK=aJ.split(" ")[0];if(aK!=="ARRAY"){ar[aK]={bitSize:parseInt(aH[aD].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};ar[aK].size=ar[aK].bitSize/8;au=aH[aD].getElementsByTagName("SubItem");for(var aC=0;aC<au.length;aC++){av=au[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ar[aK].subItems[av]={typeString:au[aC].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:au[aC].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(au[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(au[aC].getElementsByTagName("BitOffs")[0]!==undefined){ar[aK].subItems[av].bitOffset=parseInt(au[aC].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}ar[aK].subItems[av].size=(ar[aK].subItems[av].bitSize>=8)?ar[aK].subItems[av].bitSize/8:ar[aK].subItems[av].bitSize;aI=ar[aK].subItems[av].typeString.split(" ");if(aI[0]==="ARRAY"){ar[aK].subItems[av].type=aI[0];ax=aI[1].substring(1,aI[1].length-1);ax=ax.split("..");ar[aK].subItems[av].arrStartIdx=parseInt(ax[0],10);ax=parseInt(ax[1],10)-parseInt(ax[0],10)+1;ar[aK].subItems[av].arrayLength=ax;at=aI[3].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);ar[aK].subItems[av].fullType=aI[0]+"."+ax+"."+at[0]+"."+at[1];ar[aK].subItems[av].stringLength=parseInt(at[1],10)}else{ar[aK].subItems[av].fullType=aI[0]+"."+ax+"."+at[0]}ar[aK].subItems[av].bitSize=ar[ar[aK].subItems[av].typeString].bitSize;ar[aK].subItems[av].size=ar[ar[aK].subItems[av].typeString].size;ar[aK].subItems[av].itemSize=ar[aK].subItems[av].size/ax;ar[aK].subItems[av].arrayDataType="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(at[0]===aG){ar[aK].subItems[av].arrayDataType=at[0]}}}if(ar[aK].subItems[av].arrayDataType==="USER"){ar[aK].subItems[av].dataType=at[0]}}else{at=aI[0].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);ar[aK].subItems[av].fullType=at[0]+"."+at[1];ar[aK].subItems[av].stringLength=parseInt(at[1],10)}else{ar[aK].subItems[av].fullType=at[0]}ar[aK].subItems[av].type="USER";for(aG in C){if(C.hasOwnProperty(aG)){if(at[0]===aG){ar[aK].subItems[av].type=at[0]}}}if(ar[aK].subItems[av].type==="USER"){ar[aK].subItems[av].dataType=at[0]}}}}}ac.dataTypeTableReady=true;k("TAME library info: End of reading the data types from the TPY file.");k("TAME library info: Data type table ready.")}catch(aF){k("TAME library error: An error occured while creating the data type information:");k("Type: "+aJ);k("SubItem: "+av);k(aF)}}}function u(){if(typeof f.amsNetId!=="string"){f.amsNetId=A.netId;k("TAME library info: No NetId definition found. NetId from TPY file is used.")}if(typeof f.amsPort!=="string"){f.amsPort=A.port;k("TAME library info: No AMS port definition found. Port number from TPY file is used.")}if(a===0){if(A.alignment!==undefined){a=A.alignment;k("TAME library info: No alignment parameter found. Alignment from TPY file is used.")}else{a=1;k("TAME library warning: Can't get a value for the data aligment. Default value for alignment is used (1). This works only with TC2 and x86 processors.")}}if(a!==1&&a!==4&&a!==8){k("TAME library warning: The value for the alignment should be 1, 4 or 8.")}k("TAME library info: Target information: NetId: "+f.amsNetId+", AMS port: "+f.amsPort+" , alignment: "+a)}if(f.dontFetchSymbols===true){k("TAME library warning: Reading of the UploadInfo and the TPY file deactivated. Symbol Table could not be created.");if(a!==1&&a!==4&&a!==8){k("TAME library warning: The value for the alignment should be 1, 4 or 8.")}k("TAME library info: Target information: NetId: "+f.amsNetId+", AMS port: "+f.amsPort+" , alignment: "+a)}else{if(typeof f.configFileUrl=="string"){k("TAME library info: Fetching the TPY file from the webserver.");J()}u();if(typeof f.configFileUrl!="string"||f.forceUploadUsage===true){k("TAME library info: Start fetching the symbols from PLC.");try{ad()}catch(ao){k("TAME library error: Could'nt fetch the symbol information from the PLC:"+ao);return}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};